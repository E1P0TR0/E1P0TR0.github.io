<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hackthebox Writeup Timelapse" /><meta property="og:locale" content="en" /><meta name="description" content="Máquina Windows donde enumeramos por el protocolo SMB (Server Message Block) un archivo backup .zip protegido por contraseña, al romperlo por Brute Force obtenemos otro archivo .pfx (Personal Information Exchange) protegido por contraseña que rompemos fácilmente. Del archivo extraemos con OpenSSL certificados digitales del protocolo SSL/TLS (Secure Socket Layer/Transport Layer Security) de un usuario para luego entrar con evil-winrm y completar la escalada. Ahora para obtener privilegios con la herramienta WinPEAS enumeramos un archivo .txt con un historial de comandos que nos permite extraer credenciales de un usuario que pertenece a un grupo del servicio LAPS, el cuál le concede acceso a un archivo en texto claro con las credenciales del administrador del sistema." /><meta property="og:description" content="Máquina Windows donde enumeramos por el protocolo SMB (Server Message Block) un archivo backup .zip protegido por contraseña, al romperlo por Brute Force obtenemos otro archivo .pfx (Personal Information Exchange) protegido por contraseña que rompemos fácilmente. Del archivo extraemos con OpenSSL certificados digitales del protocolo SSL/TLS (Secure Socket Layer/Transport Layer Security) de un usuario para luego entrar con evil-winrm y completar la escalada. Ahora para obtener privilegios con la herramienta WinPEAS enumeramos un archivo .txt con un historial de comandos que nos permite extraer credenciales de un usuario que pertenece a un grupo del servicio LAPS, el cuál le concede acceso a un archivo en texto claro con las credenciales del administrador del sistema." /><link rel="canonical" href="https://e1p0tr0.github.io/posts/HTBTimelapse/" /><meta property="og:url" content="https://e1p0tr0.github.io/posts/HTBTimelapse/" /><meta property="og:site_name" content="Marss" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-04-11T03:34:47-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hackthebox Writeup Timelapse" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-04-11T03:34:47-05:00","datePublished":"2022-04-11T03:34:47-05:00","description":"Máquina Windows donde enumeramos por el protocolo SMB (Server Message Block) un archivo backup .zip protegido por contraseña, al romperlo por Brute Force obtenemos otro archivo .pfx (Personal Information Exchange) protegido por contraseña que rompemos fácilmente. Del archivo extraemos con OpenSSL certificados digitales del protocolo SSL/TLS (Secure Socket Layer/Transport Layer Security) de un usuario para luego entrar con evil-winrm y completar la escalada. Ahora para obtener privilegios con la herramienta WinPEAS enumeramos un archivo .txt con un historial de comandos que nos permite extraer credenciales de un usuario que pertenece a un grupo del servicio LAPS, el cuál le concede acceso a un archivo en texto claro con las credenciales del administrador del sistema.","headline":"Hackthebox Writeup Timelapse","mainEntityOfPage":{"@type":"WebPage","@id":"https://e1p0tr0.github.io/posts/HTBTimelapse/"},"url":"https://e1p0tr0.github.io/posts/HTBTimelapse/"}</script><title>Hackthebox Writeup Timelapse | Marss</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Marss"><meta name="application-name" content="Marss"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar/avatar.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Marss</a></div><div class="site-subtitle font-italic">Freelance Professional [eJPTv2]</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/E1P0TR0" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['marsello.guillen','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hackthebox Writeup Timelapse</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox Writeup Timelapse</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">Marsello Guillén</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1649666087" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-04-11 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1161 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><p>Máquina Windows donde enumeramos por el protocolo <strong>SMB (Server Message Block)</strong> un archivo backup .zip protegido por contraseña, al romperlo por <strong>Brute Force</strong> obtenemos otro archivo <strong>.pfx (Personal Information Exchange)</strong> protegido por contraseña que rompemos fácilmente. Del archivo extraemos con <strong>OpenSSL</strong> certificados digitales del protocolo <strong>SSL/TLS (Secure Socket Layer/Transport Layer Security)</strong> de un usuario para luego entrar con <strong>evil-winrm</strong> y completar la escalada. Ahora para obtener privilegios con la herramienta <strong>WinPEAS</strong> enumeramos un archivo .txt con un historial de comandos que nos permite extraer credenciales de un usuario que pertenece a un grupo del servicio <strong>LAPS</strong>, el cuál le concede acceso a un archivo en texto claro con las credenciales del administrador del sistema.</p><hr /><p><img data-src="/assets/img/htb/writeups/timelapse/logo.png" alt="Timelapse" data-proofer-ignore></p><div class="table-wrapper"><table><thead><tr><th style="text-align: center">OS<th style="text-align: center">IP<th style="text-align: center">Release Date<th style="text-align: center">Difficulty<th style="text-align: center">Points<tbody><tr><td style="text-align: center">Windows<td style="text-align: center">10.10.11.152<td style="text-align: center">26 Mar 2022<td style="text-align: center">Easy<td style="text-align: center">20</table></div><p>Antes de empezar es importante verificar que estamos conectados a la <strong>VPN</strong> de <em>HackTheBox</em> y tenemos conexión con la máquina, para ello usamos el comando <code class="language-plaintext highlighter-rouge">ping</code>:</p><p><img data-src="/assets/img/htb/writeups/timelapse/ping.png" alt="Ping" class="shadow" data-proofer-ignore></p><blockquote class="prompt-tip"><div><p>Observamos que enviamos un paquete <code class="language-plaintext highlighter-rouge">_1 packets transmitted_</code> y lo recibimos <code class="language-plaintext highlighter-rouge">_1 received_</code>, por ende tenemos una conexión exitosa.</p></div></blockquote><h2 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Empezamos enumerando los puertos TCP que están abiertos en la máquina víctima, para ello usamos la herramienta <code class="language-plaintext highlighter-rouge">nmap</code>:</p><p><img data-src="/assets/img/htb/writeups/timelapse/open_ports_tcp.png" alt="Nmap" class="shadow" data-proofer-ignore></p><blockquote class="prompt-info"><div><p>Explicación de parámetros :</p></div></blockquote><blockquote><p>-p- : Escanear todos los puertos, del 1 al 65,535</p><p>--open : Escanear solo puertos abiertos</p><p>-sS : Solo enviar paquetes de tipo SYN (inicio de conexión), incrementa velocidad del escaneo</p><p>--min-rate &lt;number&gt; : Enviar una taza (&lt;number&gt;) de paquetes por segundo como mínimo</p><p>-n : No buscar nombres de dominio asociadas a la IP en cuestión (rDNS)</p><p>-oG &lt;file&gt; : Guardar output en un archivo (&lt;file&gt;) de formato <em>grepable</em></p><p>Agregado :</p><p>2&gt; /dev/null : Redirigir <em>stderr</em> (mensajes de error) al archivo /dev/null (“Agujero Negro”)</p></blockquote><p>Como estamos en una instancia <code class="language-plaintext highlighter-rouge">Windows</code> observamos varios puertos abiertos, para tener un poco más de información realizamos un escaneo a cada uno en específico:</p><p><img data-src="/assets/img/htb/writeups/timelapse/target_tcp.png" alt="Target" class="shadow" data-proofer-ignore></p><blockquote class="prompt-info"><div><p>Explicación de parámetros :</p></div></blockquote><blockquote><p>-p&lt;port_1,port_2,...&gt; : Indicamos que puertos queremos escanear</p><p>-sC : Ejecutar en los puertos scripts por defecto de nmap</p><p>-sV : Activar detección de versiones de los servicios que corren por los puertos</p><p>-oN &lt;file&gt; : Guardar el output del escaneo en un archivo con formato Nmap</p></blockquote><p>A primera vista y observando los puertos podemos deducir que estamos frente a un servicio <code class="language-plaintext highlighter-rouge">Active Directory</code>, viendo el puerto <code class="language-plaintext highlighter-rouge">445</code> <em>(SMB)</em> podemos tirar de la herramienta <code class="language-plaintext highlighter-rouge">crackmapexec</code> para confirmarlo:</p><p><img data-src="/assets/img/htb/writeups/timelapse/validate_ac.png" alt="Crackmapexec" class="shadow" data-proofer-ignore></p><blockquote><p>Observamos en la información del equipo por el protocolo <strong>SMB</strong> que el Hostname es <code class="language-plaintext highlighter-rouge">DC01</code> (Domain Controller), el cúal es un concepto asociado a <code class="language-plaintext highlighter-rouge">Active Directory</code></p></blockquote><p><img data-src="/assets/img/htb/writeups/timelapse/dc_and_ad.png" alt="DC_Concept" class="shadow" data-proofer-ignore></p><p>Ya que el puerto <code class="language-plaintext highlighter-rouge">445</code> (SMB) está abierto, usamos la herramienta <code class="language-plaintext highlighter-rouge">smbmap</code> para listar recursos compartidos Samba y descargar un archivo <code class="language-plaintext highlighter-rouge">.zip</code> con interesante nombre:</p><p><img data-src="/assets/img/htb/writeups/timelapse/extract_zip.png" alt="Extract_Zip" class="shadow" data-proofer-ignore></p><blockquote class="prompt-tip"><div><p>Ojito: También observamos un archivo <code class="language-plaintext highlighter-rouge">.msi</code> y documentos <code class="language-plaintext highlighter-rouge">.docx</code> con la palabra <code class="language-plaintext highlighter-rouge">LAPS</code>, el cúal es un concepto muy importante que lo veremos más adelante . . .</p></div></blockquote><h2 id="foothold"><span class="mr-2">Foothold</span><a href="#foothold" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Al intentar extraer el archivo <code class="language-plaintext highlighter-rouge">.zip</code> notamos que está protegido con contraseña, para ello usamos <code class="language-plaintext highlighter-rouge">zip2john</code> para generar un hash del archivo protegido y luego crackearlo con <code class="language-plaintext highlighter-rouge">john</code>:</p><p><img data-src="/assets/img/htb/writeups/timelapse/cracked_zip.png" alt="Cracked_Zip" class="shadow" data-proofer-ignore></p><p>Después de extraer el archivo <code class="language-plaintext highlighter-rouge">zip</code> nos encontramos con un archivo <code class="language-plaintext highlighter-rouge">legacyy_dev_auth.pfx</code>, para conocer un poco de la extensión investigamos un poco:</p><p><img data-src="/assets/img/htb/writeups/timelapse/meaning_pfx.png" alt="Meaning_Pfx" class="shadow" data-proofer-ignore></p><p>Con el conocimiento de que el archivo contiene certificados digitales <strong>(SSL, Private keys)</strong> para procesos de autenticación <em>(el nombre del archivo tiene muchas pistas)</em>, ahora solo toca buscar una manera de extraer esos certificados.</p><p>Para ello, usamos la herramienta <code class="language-plaintext highlighter-rouge">openssl</code> que está ligada a realizar funciones de criptografía con cifrado SSL <strong>(Secure Sock Layer)</strong>:</p><p><img data-src="/assets/img/htb/writeups/timelapse/invalid_pass.png" alt="Invalid\password" class="shadow" data-proofer-ignore></p><p>Gracias la investigación de este nuevo concepto, sabemos que el archivo contiene una <code class="language-plaintext highlighter-rouge">private key</code> y por ello una protección por contraseña.</p><p>A pesar de ello, aplicamos el mismo método que usamos con el archivo <code class="language-plaintext highlighter-rouge">.zip</code>, usamos <code class="language-plaintext highlighter-rouge">pfx2john</code> para generar un hash del archivo protegido y luego crackearlo con <code class="language-plaintext highlighter-rouge">john</code>:</p><p><img data-src="/assets/img/htb/writeups/timelapse/cracked_pfx.png" alt="Cracked_Pfx" class="shadow" data-proofer-ignore></p><p>Ahora solo queda extraer los cetificados con <code class="language-plaintext highlighter-rouge">openssl</code>:</p><p><img data-src="/assets/img/htb/writeups/timelapse/extract_pfx.png" alt="Extract_Pfx" class="shadow" data-proofer-ignore></p><blockquote class="prompt-info"><div><p>Explicación de parámetros :</p></div></blockquote><blockquote><p>pkcs12 : Especificar el formato de la data con la cúal trabajaremos</p><p>-in &lt;file&gt; : Especificar el archivo (&lt;file&gt;) del cuál queremos extraer el certificado y la llave privada</p><p>-nocerts : No extraer certificados</p><p>-clcerts : Extraer solo certificados de cliente</p><p>-nokeys : No extraer llaves privadas</p><p>-out &lt;file&gt; : Especificar archivo de salida (&lt;file&gt;)</p></blockquote><p>Para más información del proceso pueden visitar la siguiente página de <strong>IBM</strong>: <a href="https://www.ibm.com/docs/en/arl/9.7?topic=certification-extracting-certificate-keys-from-pfx-file#r_extratsslcert__keypwd">https://www.ibm.com/docs/en/arl/9.7?topic=configurations-ssl-certification</a></p><p>Disponemos de un certificado y una llave privada, pero aún no sabemos a quién pertenece.</p><blockquote class="prompt-tip"><div><p>Ojito : Desde que descubrimos el archivo .zip tuvimos varias pistas en la descripción de sus nombres: <code class="language-plaintext highlighter-rouge">winrm</code>_backup.zip -&gt; <code class="language-plaintext highlighter-rouge">legacyy</code>_dev_auth.pfx</p></div></blockquote><p>Aparte de eso, al mirar el certificado extraído observamos en el campo <strong>Subject</strong> como CN <em>(Common Name)</em> y como Issuer <em>(Emisor)</em> a <code class="language-plaintext highlighter-rouge">legacyy</code>.</p><p>Ahora sí, para asegurarnos del todo investigamos en internet y encontramos con el tipo de certificado <code class="language-plaintext highlighter-rouge">X.509</code> que proporciona un campo de extensión para añadir campos adicionales al certificado:</p><p><img data-src="/assets/img/htb/writeups/timelapse/certificate_info.png" alt="Certificate_Info" class="shadow" data-proofer-ignore></p><p>Para más información sobre <a href="https://docs.oracle.com/cd/E24191_01/common/tutorials/authz_cert_attributes.html">Atributos del Certificado</a></p><p>Con toda la información segura y las pistas, ahora podemos usar la herramienta <code class="language-plaintext highlighter-rouge">evil-winrm</code> para entrar como el usuario <code class="language-plaintext highlighter-rouge">legacyy</code> usando el certificado y la llave privada para la autenticación y pa-dentro:</p><p><img data-src="/assets/img/htb/writeups/timelapse/foothold.png" alt="Foothold" class="shadow" data-proofer-ignore></p><blockquote class="prompt-info"><div><p>Explicación de parámetros:</p></div></blockquote><blockquote><p>-i &lt;ip&gt; : Ip o nombre de host remoto para la conexión</p><p>-S : Aplicar protocolo SSL (Secure Socket Layer)</p><p>-u &lt;user&gt; : Asignar usuario para la autenticación</p><p>-c &lt;certificate&gt; : Asignar certificado de llave pública</p><p>-k &lt;private key&gt; : Asignar certificado de llave privada</p></blockquote><h2 id="privilege-scalation"><span class="mr-2">Privilege Scalation</span><a href="#privilege-scalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Estamos dentro del sistema como usuerio <code class="language-plaintext highlighter-rouge">legacyy</code>, ahora usamos la herramienta conocida <a href="https://github.com/carlospolop/PEASS-ng">winPEAS</a> que nos ayuda a enumerar diversas rutas para poder escalar privilegios. Al ejecutarla encontramos la ruta del <code class="language-plaintext highlighter-rouge">.txt</code> que guarda el <strong><em>historial de Powershell</em></strong>:</p><p><img data-src="/assets/img/htb/writeups/timelapse/ps_history.png" alt="PS_History" class="shadow" data-proofer-ignore></p><blockquote class="prompt-warning"><div><p>Importante! : Para que les permita subir el archivo de nuestra máquina local a la víctima es importante que nos ubiquemos en un <a href="https://github.com/api0cradle/UltimateAppLockerByPassList/blob/master/Generic-AppLockerbypasses.md">Writeable path</a> <strong>(rutas por defecto con permisos de escritura para usuarios normales)</strong></p></div></blockquote><p>Al abrir el archivo encontramos cierta ejecución de comandos con el propósito de iniciar una sesión de cierto usuario para poder ejecutar algún comando:</p><p><img data-src="/assets/img/htb/writeups/timelapse/host_history.png" alt="Host_Hisyory" class="shadow" data-proofer-ignore></p><blockquote class="prompt-tip"><div><p>Para no tirar siempre de WinPEAS, puedes investigar sobre otras posibles rutas para escalar privilegios en el repositorio <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md">PayloadsAllTheThings</a></p></div></blockquote><blockquote class="prompt-info"><div><p>Aquí puedes tener mayor información sobre la <a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/deep-dives/add-credentials-to-powershell-functions?view=powershell-7.2">Creación del objeto de credenciales</a> para la sesión</p></div></blockquote><p>Ahora que tenemos credenciales del usuario <code class="language-plaintext highlighter-rouge">svc_deploy</code> solo queda logearnos de nuevo con <code class="language-plaintext highlighter-rouge">evil-winrm</code>:</p><p><img data-src="/assets/img/htb/writeups/timelapse/svc_login.png" alt="SVC_Login" data-proofer-ignore></p><p>Empezamos con una enumeración básica del usuario actual y encontramos que pertenece al grupo <code class="language-plaintext highlighter-rouge">LAPS_Readers</code>:</p><p><img data-src="/assets/img/htb/writeups/timelapse/laps_group.png" alt="Laps_Group" class="shadow" data-proofer-ignore></p><p>¿ Recuerdan los archivos de la enumeración por <strong>SMB</strong> ?, con está información ya estamos completamente seguros que se está aplicando <code class="language-plaintext highlighter-rouge">LAPS</code> <strong>(Local Administrator Password Solution)</strong></p><p>Investigando en internet sobre esta solución encontramos una vulnerabilidad que permite <em>visualizar las contraseñas en texto claro de <strong>administradores locales del dominio</strong></em>:</p><p><img data-src="/assets/img/htb/writeups/timelapse/laps_vuln.png" alt="Laps_Vuln" class="shadow" data-proofer-ignore></p><blockquote class="prompt-info"><div><p>Puede visitar la siguiente página con más vulnerabilidades LAPS: <a href="https://www.attivonetworks.com/blogs/laps-vulnerability-assessment/">https://www.attivonetworks.com/blogs/laps-vulnerability-assessment</a></p></div></blockquote><p>Asociando estos conceptos con el grupo al que pertenece nuestro usuario actual, estamos listos para explotar esta vulnerabilidad.</p><p>Primero verificamos que <code class="language-plaintext highlighter-rouge">LAPS</code> se encuentre en el sistema para luego ejecutar una linea de comandos extraída de <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Active%20Directory%20Attack.md#reading-laps-password">PayloadsAllTheThings</a>, y ya que pertenecemos al grupo <code class="language-plaintext highlighter-rouge">LAPS_Readers</code>, está claro que podremos visualizar las credenciales en texto claro:</p><p><img data-src="/assets/img/htb/writeups/timelapse/admin_pass.png" alt="Admin_Pass" class="shadow" data-proofer-ignore></p><p>Con las credenciales del usuario <code class="language-plaintext highlighter-rouge">Administrator</code> solo queda volvernos a logear por <code class="language-plaintext highlighter-rouge">evil-winrm</code> y pa-dentro:</p><p><img data-src="/assets/img/htb/writeups/timelapse/priv_scalation.png" alt="Priv_Scalation" class="shadow" data-proofer-ignore></p><hr /></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/htb/'>HTB</a>, <a href='/categories/writeups/'>Writeups</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >HTB</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >Windows</a> <a href="/tags/easy/" class="post-tag no-text-decoration" >Easy</a> <a href="/tags/active-directory/" class="post-tag no-text-decoration" >Active Directory</a> <a href="/tags/smb/" class="post-tag no-text-decoration" >SMB</a> <a href="/tags/brute-force/" class="post-tag no-text-decoration" >Brute Force</a> <a href="/tags/ssl-tls/" class="post-tag no-text-decoration" >SSL/TLS</a> <a href="/tags/winpeas/" class="post-tag no-text-decoration" >WinPEAS</a> <a href="/tags/laps/" class="post-tag no-text-decoration" >LAPS</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox Writeup Timelapse - Marss&amp;url=https://e1p0tr0.github.io/posts/HTBTimelapse/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox Writeup Timelapse - Marss&amp;u=https://e1p0tr0.github.io/posts/HTBTimelapse/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://e1p0tr0.github.io/posts/HTBTimelapse/&amp;text=Hackthebox Writeup Timelapse - Marss" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/HTBMeta/">Hackthebox Writeup Meta</a><li><a href="/posts/HTBPhotobomb/">Hackthebox Writeup Photobomb</a><li><a href="/posts/HTBZipping/">Zipping Report</a><li><a href="/posts/HTBJupiter/">Jupiter Report</a><li><a href="/posts/HTBSau/">Sau Notes</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python-scripting/">Python Scripting</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/bash-scripting/">Bash Scripting</a> <a class="post-tag" href="/tags/information-leakage/">Information Leakage</a> <a class="post-tag" href="/tags/hard/">Hard</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/rce/">RCE</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTBManager/"><div class="card-body"> <em class="timeago small" data-ts="1698858000" > 2023-11-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Manager Report</h3><div class="text-muted small"><p> Information gathering Scope: 10.10.11.236/32 (Windows (AD)) TCP Nmap scan: 65,535 ports Open ports: 53/dns: manager.htb 80/http: ...</p></div></div></a></div><div class="card"> <a href="/posts/HTBPaper/"><div class="card-body"> <em class="timeago small" data-ts="1648192921" > 2022-03-25 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Writeup Paper</h3><div class="text-muted small"><p> Empezando con la enumeración encontramos servicios web en Wordpress con un hostanme oculto en la cabezera X-Backend-Server. Luego encontramos una vulnerabilidad en la versión actual de Wordpress qu...</p></div></div></a></div><div class="card"> <a href="/posts/HTBUndetected/"><div class="card-body"> <em class="timeago small" data-ts="1650704859" > 2022-04-23 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Writeup Undetected</h3><div class="text-muted small"><p> Máquina Linux donde enumeramos por TCP para hallar un subdominio que al aplicar Directory Fuzzing encontramos una ruta vulnerable del framework PHPUnit que nos permitía Remote Code Execution (RCE) ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HTBPaper/" class="btn btn-outline-primary" prompt="Older"><p>Hackthebox Writeup Paper</p></a> <a href="/posts/HTBUndetected/" class="btn btn-outline-primary" prompt="Newer"><p>Hackthebox Writeup Undetected</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">Marsello Guillén</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python-scripting/">Python Scripting</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/bash-scripting/">Bash Scripting</a> <a class="post-tag" href="/tags/information-leakage/">Information Leakage</a> <a class="post-tag" href="/tags/hard/">Hard</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/rce/">RCE</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
